var AppStoreRedirectCtrl,appStoreRedirectApp;AppStoreRedirectCtrl=function(){function AppStoreRedirectCtrl(log,appConfig,deviceUtils){this.log=log,this.appConfig=appConfig,this.deviceUtils=deviceUtils,this.deviceUtils.isIos()&&(window.location=this.appConfig.appStoreUrls.ios),this.deviceUtils.isAndroid()&&(window.location=this.appConfig.appStoreUrls.android)}return AppStoreRedirectCtrl.$inject=["$log","appConfig","deviceUtils"],AppStoreRedirectCtrl}(),appStoreRedirectApp=angular.module("appStoreRedirectApp",["appConfig","mtnUtils","partials"]),appStoreRedirectApp.controller("AppStoreRedirectCtrl",AppStoreRedirectCtrl);var CalendarConnectCtrl,InitPushNotificationsCtrl,ProfileImageUploadCtrl,SignInBaseCtrl,SignInCountryCodeCtrl,SignInIndexCtrl,SignInPinCtrl,SignUpCtrl,SignUpPinCtrl,signInApp,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;SignInBaseCtrl=function(){function SignInBaseCtrl(scope,rootScope,log,location,window,timeout,appConfig,SessionRestangular,LocalDataRestangular,sessionService,currentUserService,errorHandlerService,navigationBarService,suggestionService,calendarService,materialService,notificationService,javascriptUtils,deviceUtils,viewParams,uncacheableUrl,splashscreen,deviceready,connectivity,mtnURL,segment,sentry,appleWatchService,contactService){this.scope=scope,this.rootScope=rootScope,this.log=log,this.location=location,this.window=window,this.timeout=timeout,this.appConfig=appConfig,this.SessionRestangular=SessionRestangular,this.LocalDataRestangular=LocalDataRestangular,this.sessionService=sessionService,this.currentUserService=currentUserService,this.errorHandlerService=errorHandlerService,this.navigationBarService=navigationBarService,this.suggestionService=suggestionService,this.calendarService=calendarService,this.materialService=materialService,this.notificationService=notificationService,this.javascriptUtils=javascriptUtils,this.deviceUtils=deviceUtils,this.viewParams=viewParams,this.uncacheableUrl=uncacheableUrl,this.splashscreen=splashscreen,this.deviceready=deviceready,this.connectivity=connectivity,this.mtnURL=mtnURL,this.segment=segment,this.sentry=sentry,this.appleWatchService=appleWatchService,this.contactService=contactService,this.isDeveloperMenuVisible=this.appConfig.isDevelopmentMode,this.navigationBarService.hideMenu()}return SignInBaseCtrl.$inject=["$scope","$rootScope","$log","$location","$window","$timeout","appConfig","SessionRestangular","LocalDataRestangular","sessionService","currentUserService","errorHandlerService","navigationBarService","suggestionService","calendarService","materialService","notificationService","javascriptUtils","deviceUtils","viewParams","uncacheableUrl","splashscreen","deviceready","connectivity","mtnURL","segment","sentry","appleWatchService","contactService"],SignInBaseCtrl.prototype._reloadUser=function(){return this.currentUserService.reload({image_size:this.appConfig.thumbnail.large}).then(function(_this){return function(user){return _this.user=user,user}}(this),function(_this){return function(failure){return _this.log.error("Failed to load user data"),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SignInBaseCtrl.prototype._fetchSuggestionSources=function(){return this.currentUserService.getRoute().all("suggestion_sources").getList().then(function(_this){return function(data){return _this.suggestionSources=_this.suggestionService.selectEnabledSources(data,_this.user.source_settings),_this.sources=_.values(_(_this.suggestionSources).sortBy(function(source){return source.name.toLowerCase()}).groupBy(function(source){return source.container_id}).value()),_this.suggestionSources}}(this),function(_this){return function(failure){return _this.log.error("fetching suggestion sources failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SignInBaseCtrl.prototype._signInSuccess=function(){return this.SessionRestangular.refreshDefaultHeaders(),this._reloadUser().then(function(_this){return function(){return _this._checkCalendarConnection()}}(this)).then(function(_this){return function(calendarStatus){var notificationPermissionAsked;return notificationPermissionAsked=_this.notificationService.getPermissionAsked(),_this.currentUserService.isNewUser(_this.user)?"/signup":"web"!==_this.deviceUtils.platform()&&(null==_this.user.image||""===_this.user.image)&&_this.signInStep<3?"/signup/profileimage":!notificationPermissionAsked&&_this.signInStep<4?"/signup/initPushNotifications":"not connected"===calendarStatus&&_this.signInStep<5?"/signup/calendarConnect":"/signin"}}(this)).then(function(_this){return function(path){return _this.location.search({}).path(path)}}(this))},SignInBaseCtrl.prototype._checkCalendarConnection=function(){return this._fetchSuggestionSources().then(function(_this){return function(suggestionSources){return"web"===_this.deviceUtils.platform()||_this.suggestionService.isCurrentDeviceCalendarConnected(suggestionSources)||_this.sessionService.getBypassCalendarConnectForUser()?(_this.log.debug("Calendar connected or bypassed, closing initialView"),"connected"):(_this.log.debug("Calendar not connected, go to calendar connect view"),"not connected")}}(this))},SignInBaseCtrl.prototype._initPushNotifications=function(){return this.notificationService.initPushNotifications()},SignInBaseCtrl.prototype.handleError=function(){return this.error=null},SignInBaseCtrl}(),SignInIndexCtrl=function(superClass){function SignInIndexCtrl(){SignInIndexCtrl.__super__.constructor.apply(this,arguments),this.signInStep=1,this.isFirstAppLaunch=this.sessionService.getFirstAppLaunch(),this.deviceready.then(function(_this){return function(){return _this._init(),_this._setLayout()}}(this))}return extend(SignInIndexCtrl,superClass),SignInIndexCtrl.prototype._setLayout=function(){return this.feelGoodImageIsVisible?this.navigationBarService.hide():this.navigationBarService.show(),this.navigationBarService.update({title:this.isPinRequest?"Enter PIN":this.appConfig.appName,buttons:{left:this.isPinRequest?this.navigationBarService.defaultBackButton():null}}),this.navigationBarService.hideMenu()},SignInIndexCtrl.prototype._init=function(){return this.signedIn=this.sessionService.isSignedIn(),this.signedIn?this._signIn():(this.feelGoodImageIsVisible=!0,this.splashscreen.hide())},SignInIndexCtrl.prototype._signIn=function(){var currentUserTimeFormat,ongoingScheduling,path;return this.sessionService.setFirstAppLaunch(!1),ongoingScheduling=this.currentUserService.get().ongoing_scheduling,this.segment.identify(),this.sentry.init(),currentUserTimeFormat=this.currentUserService.get().time_display,moment.locale(currentUserTimeFormat),this.notificationService.fetchAll(),this.notificationService.pollForNewNotifications(),this._initAppleWatch(),this._initPushNotifications(),path="web"!==this.deviceUtils.platform()&&this.appConfig.appBrand!==this.appConfig.appBrands.MEETINGS?"/scheduling":"/timeline",this.suggestionService.getCalendarSuggestionsEnabled()&&this._initCalendar(),this.isFirstAppLaunch&&null!=ongoingScheduling&&(this.sessionService.setShowCarousel(!1),this.viewParams.set({menuVisible:!0}),path="/timeline/meeting/"+ongoingScheduling.meeting_id+"/scheduling/"+ongoingScheduling.id),this.navigationBarService.showMenu(),this.location.path(path)},SignInIndexCtrl.prototype._initAppleWatch=function(){return this.appleWatchService.init().then(function(_this){return function(){return _this.appleWatchService.signIn(_this.sessionService.getUserId(),_this.sessionService.getToken())}}(this),function(_this){return function(failure){return _this.log.debug("Apple watch initialization failed",failure)}}(this))},SignInIndexCtrl.prototype._initCalendar=function(){return this.calendarService.init().then(function(_this){return function(){return _this.log.debug("Calendar initialized!"),_this.suggestionService.syncCalendars(),"ios"===_this.deviceUtils.platform()?_this.suggestionService.pollForSuggestions():void 0}}(this))},SignInIndexCtrl.prototype.hideFeelGoodImage=function(){return this.feelGoodImageIsVisible=!1,this._setLayout()},SignInIndexCtrl.prototype.showFeelGoodImage=function(){return this.feelGoodImageIsVisible=!0,this._setLayout()},SignInIndexCtrl.prototype.checkPhone=function(phone){return this.formattedPhone=this.contactService.formatPhone(phone,"null"),this.formattedPhone.valid?this.createPinRequest():(this.viewParams.set({phone:this.formattedPhone.e164}),this.location.path("/signin/country"))},SignInIndexCtrl.prototype.createPinRequest=function(){return this.btnWorking="pinRequest",this.sessionService.requestPinWithPhonenumber(this.formattedPhone.e164).then(function(_this){return function(){return _this.viewParams.set({phone:_this.formattedPhone.e164}),_this.location.path("/signin/pin")}}(this),function(_this){return function(failure){return _this.log.warn("Error requesting PIN: ",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},SignInIndexCtrl.prototype.devSignIn=function(email,pin){return this.sessionService.signIn(email,pin).then(function(_this){return function(){return _this.location.search("devSignIn","foo"),_this._signInSuccess()}}(this),function(_this){return function(failure){return _this.log.warn("Error signing in: ",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SignInIndexCtrl.prototype.clearLoginCheck=function(){return localStorage.clear(),alert("Login check data removed")},SignInIndexCtrl}(SignInBaseCtrl),SignInCountryCodeCtrl=function(superClass){function SignInCountryCodeCtrl(){SignInCountryCodeCtrl.__super__.constructor.apply(this,arguments),this.signInStep=1,this.phone=this.viewParams.get("phone"),this.formattedPhone=this.contactService.formatPhone(this.phone,"null"),null==this.phone&&this.location.path("/signin"),this._fetchCountryCodes(),this._setLayout()}return extend(SignInCountryCodeCtrl,superClass),SignInCountryCodeCtrl.prototype._setLayout=function(){return this.navigationBarService.show(),this.navigationBarService.update({title:"Check your number",buttons:{left:this.navigationBarService.defaultBackButton()}}),this.navigationBarService.hideMenu()},SignInCountryCodeCtrl.prototype._fetchCountryCodes=function(){return this.LocalDataRestangular.all("countrycodes").getList().then(function(_this){return function(data){return _this.countryCodes=data}}(this))},SignInCountryCodeCtrl.prototype.validatePhone=function(){return this.formattedPhone=this.contactService.formatPhone(this.phone,this.countryCode.id)},SignInCountryCodeCtrl.prototype.createPinRequest=function(){return this.btnWorking="pinRequest",this.sessionService.requestPinWithPhonenumber(this.formattedPhone.e164).then(function(_this){return function(){return _this.viewParams.set({phone:_this.formattedPhone.e164}),_this.location.path("/signin/pin")}}(this),function(_this){return function(failure){return _this.log.warn("Error requesting PIN: ",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},SignInCountryCodeCtrl}(SignInBaseCtrl),SignInPinCtrl=function(superClass){function SignInPinCtrl(){var countryId,e164;SignInPinCtrl.__super__.constructor.apply(this,arguments),this.signInStep=1,this.phone=this.viewParams.get("phone"),null==this.phone&&this.location.path("/signin"),e164=formatE164("null",this.phone),countryId=countryForE164Number(e164),this.internationalFormat=formatInternational(countryId,this.phone),this._setLayout()}return extend(SignInPinCtrl,superClass),SignInPinCtrl.prototype._setLayout=function(){return this.navigationBarService.show(),this.navigationBarService.update({title:"Enter PIN",buttons:{left:this.navigationBarService.defaultBackButton()}}),this.navigationBarService.hideMenu()},SignInPinCtrl.prototype.resendPin=function(){return this.sessionService.requestPinWithPhonenumber(this.phone).then(function(_this){return function(){return _this.log.debug("PIN request sent"),_this.pinReRequested=!0}}(this),function(_this){return function(failure){return _this.log.warn("Error requesting PIN: ",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SignInPinCtrl.prototype.signIn=function(){return this.btnWorking="signIn",this.sessionService.signInWithPhonenumber(this.phone,this.pin).then(function(_this){return function(){return _this._signInSuccess()}}(this),function(_this){return function(failure){return _this.log.warn("Error signing in: ",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},SignInPinCtrl}(SignInBaseCtrl),SignUpCtrl=function(superClass){function SignUpCtrl(){SignUpCtrl.__super__.constructor.apply(this,arguments),this.signInStep=2,this.splashscreen.hide(),this.TOSVisible=!1,this.meetingId=this.viewParams.get("meetingId"),this.schedulingId=this.viewParams.get("schedulingId"),this.msgId=this.viewParams.get("msgId"),this.user=this.currentUserService.get(),this._setLayout()}return extend(SignUpCtrl,superClass),SignUpCtrl.prototype._setLayout=function(){var cancelButton;return cancelButton={title:"Cancel",onClick:function(_this){return function(){return _this.sessionService.signOut()}}(this)},this.navigationBarService.update({title:"Your profile",buttons:{left:null!=this.meetingId?this.navigationBarService.defaultBackButton():cancelButton}}),this.navigationBarService.hideMenu()},SignUpCtrl.prototype._confirmEmail=function(email){return this.currentUserService.confirmEmail(email).then(function(_this){return function(){return _this._signInSuccess()}}(this),function(_this){return function(failure){var ref;return 1===(null!=failure&&null!=(ref=failure.error)?ref.code:void 0)?(_this.log.debug("Existing email given, PIN code sent to email",failure),_this.viewParams.set({email:_this.user.primary_email}),_this.location.path("/signup/pin")):(_this.log.warn("Failed email confirm: ",failure),_this.error=_this.errorHandlerService.handle(failure))}}(this))},SignUpCtrl.prototype._returnToScheduling=function(){return this.SessionRestangular.refreshDefaultHeaders(),this._reloadUser().then(function(_this){return function(){return _this.location.search({}).path("/timeline/meeting/"+_this.meetingId+"/scheduling/"+_this.schedulingId+"/thanks/"+_this.msgId)}}(this),function(_this){return function(failure){return _this.log.debug("Failed to update user",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SignUpCtrl.prototype.disableSignUpButton=function(){return!this.registrationForm.$valid||this.btnWorking},SignUpCtrl.prototype.toggleTOS=function(){return this.TOSVisible=!this.TOSVisible},SignUpCtrl.prototype.signUp=function(){return this.user.tos_accepted=1,this.btnWorking="signUp",this.currentUserService.update(this.user).then(function(_this){return function(data){return _this.log.debug("Updated user success, got data:",data),null!=_this.meetingId?_this._returnToScheduling():_this._signInSuccess()}}(this),function(_this){return function(failure){var ref;return 503===(null!=failure&&null!=(ref=failure.error)?ref.code:void 0)?(_this.log.warn("User already exists: ",failure),_this._confirmEmail(_this.user.primary_email)):(_this.log.warn("Registration failed: ",failure),_this.error=_this.errorHandlerService.handle(failure))}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},SignUpCtrl}(SignInBaseCtrl),SignUpPinCtrl=function(superClass){function SignUpPinCtrl(){SignUpPinCtrl.__super__.constructor.apply(this,arguments),this.signInStep=2,this.email=this.viewParams.get("email"),this._setLayout()}return extend(SignUpPinCtrl,superClass),SignUpPinCtrl.prototype._setLayout=function(){var cancelButton;return cancelButton={title:"Cancel",onClick:function(_this){return function(){return _this.sessionService.signOut()}}(this)},this.navigationBarService.update({title:"Enter PIN",buttons:{left:this.navigationBarService.defaultBackButton()}}),this.navigationBarService.hideMenu()},SignUpPinCtrl.prototype.verifyPin=function(){return this.btnWorking="signUp",this.sessionService.signIn(this.email,this.pin).then(function(_this){return function(){return _this._signInSuccess()}}(this),function(_this){return function(failure){return _this.log.warn("Error signing in: ",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},SignUpPinCtrl.prototype.resendPin=function(){return this.currentUserService.confirmEmail(this.email).then(function(_this){return function(){return _this.log.debug("No existing user found")}}(this),function(_this){return function(failure){var ref;return 1===(null!=failure&&null!=(ref=failure.error)?ref.code:void 0)?(_this.log.debug("Existing email given, PIN code sent to email",failure),_this.pinReRequested=!0):void 0}}(this))},SignUpPinCtrl}(SignInBaseCtrl),ProfileImageUploadCtrl=function(superClass){function ProfileImageUploadCtrl(){ProfileImageUploadCtrl.__super__.constructor.apply(this,arguments),this.signInStep=3,this.splashscreen.hide(),this.user=this.currentUserService.get(),this.profileImageUrl=this.uncacheableUrl(this.user.image),this._setLayout()}return extend(ProfileImageUploadCtrl,superClass),ProfileImageUploadCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"Your photo",buttons:{left:null}}),this.navigationBarService.hideMenu()},ProfileImageUploadCtrl.prototype.addPhoto=function(){return null==this.uploadProgress&&"web"!==this.deviceUtils.platform()?(this.btnWorking="uploading",this.materialService.addPhoto(this.appConfig.thumbnail.large).then(function(_this){return function(data){return _this.log.debug("Profile picture successfully uploaded"),_this.user.upload_id=data.result.upload_id,_this.profileImageUrl=_this.uncacheableUrl(data.result.upload_thumbnail_url),_this.currentUserService.update(_this.user).then(function(data){return _this.log.debug("Updated user success, got data:",data),_this._signInSuccess()},function(failure){return _this.log.error("Updating user profile failed",failure),_this.error=_this.errorHandlerService.handle(failure)})}}(this),function(_this){return function(failure){return _this.log.error("Failed to upload profile picture",failure),_this.error=_this.errorHandlerService.handle(failure),failure}}(this),function(_this){return function(progress){return _this.uploadProgress=progress}}(this))["finally"](function(_this){return function(){return _this.uploadProgress=null,_this.btnWorking=null}}(this))):void 0},ProfileImageUploadCtrl.prototype.skip=function(){return this._signInSuccess()},ProfileImageUploadCtrl}(SignInBaseCtrl),CalendarConnectCtrl=function(superClass){function CalendarConnectCtrl(){CalendarConnectCtrl.__super__.constructor.apply(this,arguments),this.signInStep=5,this.splashscreen.hide(),this.connectionStep=this.calendarService.getPermissionAsked()?"calendarConnect":"askPermission",this.user=this.currentUserService.get(),this._setLayout()}return extend(CalendarConnectCtrl,superClass),CalendarConnectCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"Connect your calendar",buttons:{left:null}}),this.navigationBarService.hideMenu()},CalendarConnectCtrl.prototype.initCalendarPlugin=function(){return this.calendarService.init().then(function(_this){return function(){return _this.log.debug("Calendar initialized!"),_this.calendarService.setPermissionAsked(!0),_this.connectionStep="calendarConnect"}}(this),function(_this){return function(failure){return _this.log.error("Calendar connection failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},CalendarConnectCtrl.prototype.connectDeviceCalendar=function(){var skipTimeout;return this.btnWorking="fetchingSources",skipTimeout=this.timeout(function(_this){return function(){return _this.skip(),_this.scope.$apply()}}(this),2e4),this.initCalendarPlugin().then(function(_this){return function(){return _this.suggestionService.syncCalendars()}}(this)).then(function(_this){return function(data){return _this.log.debug("Calendar connected successfully",data),_this.sessionService.addUserToBypassCalendarConnectList(),_this._fetchSuggestionSources()}}(this)).then(function(_this){return function(){return _this.navigationBarService.show("Calendars"),_this.timeout.cancel(skipTimeout),_this.connectionStep="sourceSelection"}}(this),function(_this){return function(failure){return _this.log.error("Calendar connection failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},CalendarConnectCtrl.prototype.suggestionSourcesSelected=function(){return this._signInSuccess()},CalendarConnectCtrl.prototype.toggleSourceValue=function(type,source){return this.sources[type][source].selected_by_default=!this.sources[type][source].selected_by_default,this.sources[type][source].saving=!0,this.suggestionService.updateSources(this.user,this.suggestionSources).then(function(_this){return function(data){return _this.log.debug("Updated source_settings successfully, got data:",data)}}(this),function(_this){return function(failure){return _this.log.debug("Failed updating source_settings",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.sources[type][source].saving=!1}}(this))},CalendarConnectCtrl.prototype.setSourceValue=function(type,source,value){return this.sources[type][source].selected_by_default=value,this.sources[type][source].saving=!0,this.suggestionService.updateSources(this.user,this.suggestionSources).then(function(_this){return function(data){return _this.log.debug("Updated source_settings successfully, got data:",data)}}(this),function(_this){return function(failure){return _this.log.debug("Failed updating source_settings",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.sources[type][source].saving=!1}}(this))},CalendarConnectCtrl.prototype.skip=function(){return this.sessionService.addUserToBypassCalendarConnectList(),this._signInSuccess()},CalendarConnectCtrl}(SignInBaseCtrl),InitPushNotificationsCtrl=function(superClass){function InitPushNotificationsCtrl(){InitPushNotificationsCtrl.__super__.constructor.apply(this,arguments),this.signInStep=4,this.splashscreen.hide(),this._setLayout()}return extend(InitPushNotificationsCtrl,superClass),InitPushNotificationsCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"Allow push notifications",buttons:{left:null}}),this.navigationBarService.hideMenu()},InitPushNotificationsCtrl.prototype.initPushNotifications=function(){return this.btnWorking="initPushNotifications",this.notificationService.setPermissionAsked(!0),this._initPushNotifications(),this.btnWorking=null,this._signInSuccess()},InitPushNotificationsCtrl.prototype.skip=function(){return this.notificationService.setPermissionAsked(!1),this._signInSuccess()},InitPushNotificationsCtrl}(SignInBaseCtrl),signInApp=angular.module("signInApp",["SPARouteConfig","appConfig","mtnUtils","splashscreen","SessionModel","sessionModule","currentUserModule","errorHandler","suggestionModule","notifications","calendarModule","mtnCheckbox","mtnFloatLabel","connectivity","mtnURL","mtnA","mtnDisableScroll","appleWatchModule","contactModule"]),signInApp.controller("SignInIndexCtrl",SignInIndexCtrl),signInApp.controller("SignInCountryCodeCtrl",SignInCountryCodeCtrl),signInApp.controller("SignInPinCtrl",SignInPinCtrl),signInApp.controller("SignUpCtrl",SignUpCtrl),signInApp.controller("SignUpPinCtrl",SignUpPinCtrl),signInApp.controller("ProfileImageUploadCtrl",ProfileImageUploadCtrl),signInApp.controller("CalendarConnectCtrl",CalendarConnectCtrl),signInApp.controller("InitPushNotificationsCtrl",InitPushNotificationsCtrl);var MainCtrl,mainApp,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};MainCtrl=function(){function MainCtrl(scope,log,appConfig,sessionService1,suggestionService,calendarService,deviceUtils1,navigationBarService,notificationService,jsonMsgChannel,segment1,pusherService,appleWatchService){this.scope=scope,this.log=log,this.appConfig=appConfig,this.sessionService=sessionService1,this.suggestionService=suggestionService,this.calendarService=calendarService,this.deviceUtils=deviceUtils1,this.navigationBarService=navigationBarService,this.notificationService=notificationService,this.jsonMsgChannel=jsonMsgChannel,this.segment=segment1,this.pusherService=pusherService,this.appleWatchService=appleWatchService,this._onSignOut=bind(this._onSignOut,this),this.sessionService.initEventListener(this._onSignOut),this._initWatchers(),this._initMessageListener(),this.sessionService.isSignedIn()&&(this._initNotifications(),this._initAppleWatch()),this.sessionService.isSignedIn()&&this.suggestionService.getCalendarSuggestionsEnabled()&&this._initCalendar()}return MainCtrl.$inject=["$scope","$log","appConfig","sessionService","suggestionService","calendarService","deviceUtils","navigationBarService","notificationService","jsonMsgChannel","segment","pusherService","appleWatchService"],MainCtrl.prototype._onSignOut=function(){return this.log.debug("signing out"),this.suggestionService.stopPollingForSuggestions(),this.notificationService.stopPollingForNewNotifications(),this.notificationService.unregisterPushNotications(),this.appleWatchService.signOut(),this.segment.reset(),this.pusherService.destroy()},MainCtrl.prototype._initMessageListener=function(){return this.scope.$on("$destroy",function(_this){return function(){return _this.log.debug("[navigation] destroyed, unsubscribing MsgChannel"),_this.jsonMsgChannel.unsubscribe(_this.msgChannel)}}(this)),this.msgChannel=this.jsonMsgChannel.subscribe(function(_this){return function(data){return _this.log.debug("[navigation] received postmessage: ",null!=data?data.event:void 0,data),"fetchNotifications"===(null!=data?data.event:void 0)?_this.notificationService.fetchAll():void 0}}(this))},MainCtrl.prototype._initWatchers=function(){return this.scope.$watch(function(_this){return function(){return _this.navigationBarService.title}}(this),function(_this){return function(title){return _this.pageTitle=title}}(this))},MainCtrl.prototype._initNotifications=function(){return this.notificationService.fetchAll(),this.notificationService.pollForNewNotifications(),this.notificationService.initPushNotifications()},MainCtrl.prototype._initAppleWatch=function(){return this.appleWatchService.init().then(function(_this){return function(){return _this.appleWatchService.signIn(_this.sessionService.getUserId(),_this.sessionService.getToken())}}(this),function(_this){return function(failure){return _this.log.debug("Apple watch initialization failed",failure)}}(this))},MainCtrl.prototype._initCalendar=function(){return this.calendarService.init().then(function(_this){return function(){return _this.log.debug("Calendar initialized!"),_this.suggestionService.syncCalendars(),"ios"===_this.deviceUtils.platform()?_this.suggestionService.pollForSuggestions():void 0}}(this))},MainCtrl}(),mainApp=angular.module("mainApp",["ngRoute","ngAnimate","appConfig","SPARouteConfig","signInApp","navigationApp","meetingApp","participantApp","materialApp","notificationApp","appStoreRedirectApp","menuApp","profileApp","schedulingApp","swipeToMeetApp","redirectModule","suggestionModule","calendarModule","mtnUtils","pusherModule","appleWatchModule"]),mainApp.controller("MainCtrl",MainCtrl),mainApp.run(function($log,$rootScope,$location,redirectService,sessionService,currentUserService,deviceUtils,segment,sentry,cacheService,dateHelper){var currentUserTimeFormat;return window.handleOpenURL=function(url){var queryParams,queryStrings,urlQueryString;return _.contains(url,"?")?(urlQueryString=url.split("?")[1],queryStrings=urlQueryString.split("&"),queryParams={},_.forEach(queryStrings,function(queryString){var qs;return qs=queryString.split("="),queryParams[qs[0]]=qs[1]}),redirectService.handleQueryParams(queryParams),$rootScope.$apply()):void 0},redirectService.handleQueryParams(),window.addEventListener("load",function(){return FastClick.attach(document.body)},!1),cacheService.init("SwipeToMeet"),segment.init(),sentry.init(),dateHelper.initCustomLocales(),currentUserTimeFormat=null!=currentUserService.get()?currentUserService.get().time_display:"24h",moment.locale(currentUserTimeFormat),sessionService.checkLogin(),$rootScope.$on("$locationChangeSuccess",function(){var currentUser,locationWithoutTab,path,regex;return currentUser=currentUserService.get(),null!=currentUser?(regex=new RegExp(/\/meeting\/\d+\/scheduling\/\d+.*/),path=$location.path(),locationWithoutTab=path.substr(path.substr(1).indexOf("/")),!regex.test(locationWithoutTab)&&sessionService.isSignedIn()&&0===currentUser.tos_accepted?($log.error("TOS is not accepted"),$location.path("/signup")):void 0):void 0})});var MaterialBaseCtrl,MaterialShowCtrl,materialApp,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;MaterialBaseCtrl=function(){function MaterialBaseCtrl(scope,rootScope,location,log,q,window1,timeout,analytics,appConfig,SessionRestangular,errorHandlerService,sessionService,meetingService,navigationBarService,breadcrumb,materialService,participantService,differenceFilter,viewParams,dateHelper,stringUtils,mtnURL,deviceUtils){this.scope=scope,this.rootScope=rootScope,this.location=location,this.log=log,this.q=q,this.window=window1,this.timeout=timeout,this.analytics=analytics,this.appConfig=appConfig,this.SessionRestangular=SessionRestangular,this.errorHandlerService=errorHandlerService,this.sessionService=sessionService,this.meetingService=meetingService,this.navigationBarService=navigationBarService,this.breadcrumb=breadcrumb,this.materialService=materialService,this.participantService=participantService,this.differenceFilter=differenceFilter,this.viewParams=viewParams,this.dateHelper=dateHelper,this.stringUtils=stringUtils,this.mtnURL=mtnURL,this.deviceUtils=deviceUtils,this.tab=this.viewParams.get("tab"),this.breadcrumb.set(this.viewParams.get("breadcrumb"),this.viewParams.get("breadcrumbClickable"))}return MaterialBaseCtrl.$inject=["$scope","$rootScope","$location","$log","$q","$window","$timeout","$analytics","appConfig","SessionRestangular","errorHandlerService","sessionService","meetingService","navigationBarService","breadcrumb","materialService","participantService","differenceFilter","viewParams","dateHelper","stringUtils","mtnURL","deviceUtils"],MaterialBaseCtrl}(),MaterialShowCtrl=function(superClass){function MaterialShowCtrl(){MaterialShowCtrl.__super__.constructor.apply(this,arguments),this.meeting=this.meetingService.getMeeting(),this.meetingId=this.viewParams.get("meetingId"),this.materialId=this.viewParams.get("materialId"),this.materialClass=this.viewParams.get("materialClass"),this.overrideBackButton=this.viewParams.get("overrideBackButton"),this.isEditable="agenda"===this.materialClass||"action_points"===this.materialClass,this.showComments="scheduling"!==this.tab,this.removedComments=[],this.wasEdited=!1,this._initPlaceholder(),null!=this.materialId?this._initMaterial():this._initEmptyMaterial(),this._initMessageListener(),this._setLayout()}return extend(MaterialShowCtrl,superClass),MaterialShowCtrl.prototype._setTitle=function(){var title;return title="Material","agenda"===this.materialClass&&(title="Agenda"),"action_points"===this.materialClass&&(title="Action points"),this.navigationBarService.show(title)
},MaterialShowCtrl.prototype._setLayout=function(){var cancelButton,saveButton;return this._setTitle(),cancelButton={title:"Cancel",onClick:function(_this){return function(){return _this.confirmCancel()}}(this)},saveButton={title:"Done",onClick:function(_this){return function(){return _this.done()}}(this)},this.navigationBarService.update({buttons:{left:cancelButton,right:"ios"===this.deviceUtils.platform()?saveButton:null}})},MaterialShowCtrl.prototype._closeMaterial=function(){return this.window.history.back()},MaterialShowCtrl.prototype._initMessageListener=function(){return this.scope.$on("$destroy",function(_this){return function(){return _this.log.debug("[Material] destroyed, removing material lock"),window.onbeforeunload=null,null!=_this.editData?_this.cancelEdit():void 0}}(this))},MaterialShowCtrl.prototype._fetchMaterial=function(){return this.materialService.fetchMaterial(this.materialId)},MaterialShowCtrl.prototype._fetchComments=function(){return this.materialService.fetchComments(this.materialId)},MaterialShowCtrl.prototype._fetchMeeting=function(){return this.meetingService.fetchMeeting(this.meetingId)},MaterialShowCtrl.prototype._initMaterial=function(){return this.loading=!0,this.q.all([this._fetchMaterial(),this._fetchComments(),this._fetchMeeting()]).then(function(_this){return function(data){return _this.log.debug("Init material success",data),_this.material=data[0],_this.typeClass=_this.material.type_class,_this.materialClass=_this.material.material_class,_this.isEditable="editabledocument"===_this.typeClass,_this.isEditable&&(_this.material.content=_this.stringUtils.stripHtml(_this.material.content),_this.originalContent=_this.material.content,0===_this.material.content.length&&_this.editMaterial()),_this.comments=data[1],_this.meeting=data[2],_this._initPlaceholder(),_this._setLayout()}}(this),function(_this){return function(failure){return _this.log.error("Error initializing material view",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},MaterialShowCtrl.prototype._initEmptyMaterial=function(){return this.timeout(function(_this){return function(){return _this.material={content:_this.stringUtils.stripHtml(_this.meeting.initial_agenda)},_this.originalContent=_this.material.content,_this.isEditable=!0,_this.scope.$apply()}}(this)),this.timeout(function(_this){return function(){return _this.editMaterial(),_this.scope.$apply()}}(this),300)},MaterialShowCtrl.prototype._initPlaceholder=function(){switch(this.materialClass){case"agenda":return this.materialPlaceholder="Why are you meeting? Type in the agenda to share it with others.";case"action_points":return this.materialPlaceholder="Let others know what was the outcome of the meeting.";default:return this.materialPlaceholder="Type in your custom notes."}},MaterialShowCtrl.prototype._updateScheduling=function(){return this.meeting.initial_agenda=this.material.content,this.meetingService.setMeeting(this.meeting)},MaterialShowCtrl.prototype._editStartSuccess=function(data){return this.editData=data},MaterialShowCtrl.prototype._continueEdit=function(){return this.materialService.continueMaterialEdit(this.materialId).then(function(_this){return function(data){return _this.log.debug("Continued editing succesfully",data),_this._editStartSuccess(data)}}(this),function(_this){return function(failure){return _this.log.error("Failed to continue interrupted editing",failure),_this.error=_this.errorHandlerService.handle(failure),_this.rootScope.$broadcast("blurInput")}}(this))},MaterialShowCtrl.prototype._openInExternal=function(){return this.confirmDialog=null,this.mtnURL.open(this.material.open_url,null,"_blank")},MaterialShowCtrl.prototype.openMeeting=function(){return this.meetingService.setMeeting(this.meeting),this.location.path("/"+this.tab+"/meeting/"+this.meeting.id)},MaterialShowCtrl.prototype.confirmCancel=function(){return this.wasEdited?this.confirmDialog={title:"Discard changes?",message:"Changes will be lost if you continue.",buttonConfirmCallback:function(_this){return function(){return _this.cancel()}}(this),buttonConfirmCaption:"Continue",buttonCancelCallback:function(_this){return function(){return _this.confirmDialog=null}}(this),buttonCancelCaption:"Cancel"}:this.cancel()},MaterialShowCtrl.prototype.confirmOpen=function(){return this.confirmDialog={title:"Open material?",message:"This material will be opened in your devices default browser.",buttonConfirmCallback:function(_this){return function(){return _this._openInExternal()}}(this),buttonConfirmCaption:"Ok",buttonCancelCallback:function(_this){return function(){return _this.confirmDialog=null}}(this),buttonCancelCaption:"Cancel"}},MaterialShowCtrl.prototype.done=function(){return this.rootScope.$broadcast("blurInput"),this._updateScheduling(),null!=this.editData?this.updateMaterial().then(function(_this){return function(){return _this._closeMaterial()}}(this)):this._closeMaterial()},MaterialShowCtrl.prototype.cancel=function(){return this.rootScope.$broadcast("blurInput"),null!=this.editData?this.cancelEdit().then(function(_this){return function(){return _this._closeMaterial()}}(this)):this._closeMaterial()},MaterialShowCtrl.prototype.cancelEdit=function(){return this.materialService.cancelEditing(this.editData.id).then(function(_this){return function(data){return _this.log.debug("Material lock removed",data),_this.editData=null}}(this))},MaterialShowCtrl.prototype.materialChanged=function(){return this.loading&&this.material.content!==this.originalContent?void 0:(this.wasEdited=!0,window.onbeforeunload=function(){return"Changes will be lost if you continue."})},MaterialShowCtrl.prototype.editMaterial=function(){return this.rootScope.$broadcast("focusInput"),null!=this.materialId&&null==this.editData?(this.loading=!0,this.materialService.getMaterialEditLock(this.materialId).then(function(_this){return function(data){return _this.log.debug("Material lock received",data),_this._editStartSuccess(data)}}(this),function(_this){return function(failure){return _this.log.error("Material locking failed, attempting to continue interrupted editing",failure),_this._continueEdit()}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))):void 0},MaterialShowCtrl.prototype.updateMaterial=function(){var content;return this.loading=!0,this.isEditable?(content=this.stringUtils.stripHtml(this.material.content),content=this.stringUtils.lineBreakToBr(this.material.content)):content=this.material.content,this.materialService.updateMaterial(this.materialId,this.editData,content).then(function(_this){return function(data){return _this.log.debug("Material update success",data),_this.editData=null}}(this),function(_this){return function(failure){return _this.log.error("Error updating material",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},MaterialShowCtrl.prototype.createComment=function(comment){return this.commentBtnWorking=!0,this.materialService.addComment(this.materialId,{content:comment}).then(function(_this){return function(data){return _this.log.debug("Created comment, result",data),_this.comments.push(data),_this.newComment=null,_this.analytics.eventTrack("Posted comment",{Category:"Comments",id:data.id})}}(this),function(_this){return function(failure){return _this.log.error("Error creating comment",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.commentBtnWorking=!1}}(this))},MaterialShowCtrl.prototype.removeComment=function(comment){return this.removedComments.push(comment),this.comments=this.differenceFilter(this.comments,this.removedComments),this.materialService.removeComment(this.materialId,comment.id).then(function(_this){return function(data){return _this.log.debug("Comment removed successfully",data),_this.setSelectedIndex(null),_this.analytics.eventTrack("Removed comment",{Category:"Comments",id:comment.id})}}(this),function(_this){return function(failure){return _this.log.error("Comment remove failed",failure),_this.error=_this.errorHandlerService.handle(failure),_this.removedComments.pop(),_this.comments=_this.differenceFilter(_this.comments,_this.removedComments)}}(this))},MaterialShowCtrl.prototype.removeCommentAllowed=function(comment){return comment.user_id===this.sessionService.getUserId()||this.isManager},MaterialShowCtrl.prototype.setSelectedIndex=function(index){return this.selectedIndex=index},MaterialShowCtrl.prototype.handleError=function(){return this.reload()},MaterialShowCtrl.prototype.reload=function(){return this.error=null,this.accessDenied?void this.window.history.back():null!=this.materialId?this._initMaterial():this._initEmptyMaterial()},MaterialShowCtrl}(MaterialBaseCtrl),materialApp=angular.module("materialApp",["appConfig","participantModule","meetingModule","ngAnimate","nativeUi","mtnSwipeToReveal","mtnListFilters","dateHelper","contenteditable","mtnMoveCursorToEnd","mtnUtils","autoGrow","mtnURL"]),materialApp.controller("MaterialShowCtrl",MaterialShowCtrl);var MeetingBaseCtrl,MeetingControlsCtrl,MeetingEditCtrl,MeetingIndexCtrl,MeetingShowCtrl,meetingApp,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;MeetingBaseCtrl=function(){function MeetingBaseCtrl(scope,rootScope,log,q,location,window1,timeout,jsonMsgChannel,meetingGroupUtils,appConfig,SessionRestangular,sessionService,currentUserService,errorHandlerService,meetingService,materialService,participantService,calendarService,suggestionService,pusherService,navigationBarService,dateHelper,removeTinyMCE,viewParams,deviceUtils,connectivity,mtnURL){this.scope=scope,this.rootScope=rootScope,this.log=log,this.q=q,this.location=location,this.window=window1,this.timeout=timeout,this.jsonMsgChannel=jsonMsgChannel,this.meetingGroupUtils=meetingGroupUtils,this.appConfig=appConfig,this.SessionRestangular=SessionRestangular,this.sessionService=sessionService,this.currentUserService=currentUserService,this.errorHandlerService=errorHandlerService,this.meetingService=meetingService,this.materialService=materialService,this.participantService=participantService,this.calendarService=calendarService,this.suggestionService=suggestionService,this.pusherService=pusherService,this.navigationBarService=navigationBarService,this.dateHelper=dateHelper,this.removeTinyMCE=removeTinyMCE,this.viewParams=viewParams,this.deviceUtils=deviceUtils,this.connectivity=connectivity,this.mtnURL=mtnURL,this.tab=this.viewParams.get("tab"),this._initVariables(),this._initUser(),this.navigationBarService.showMenu()}return MeetingBaseCtrl.$inject=["$scope","$rootScope","$log","$q","$location","$window","$timeout","jsonMsgChannel","meetingGroupUtils","appConfig","SessionRestangular","sessionService","currentUserService","errorHandlerService","meetingService","materialService","participantService","calendarService","suggestionService","pusherService","navigationBarService","dateHelper","removeTinyMCE","viewParams","deviceUtils","connectivity","mtnURL"],MeetingBaseCtrl.prototype._initVariables=function(){return this.loading=!1,this.error=null,this.isDevelopmentMode=this.appConfig.isDevelopmentMode,this.participantMaxCountBeforeSummary=this.appConfig.meeting.participants.maxCountBeforeSummary},MeetingBaseCtrl.prototype._initUser=function(){return this.userRoute=this.currentUserService.getRoute(),this.user=this.currentUserService.get()},MeetingBaseCtrl}(),MeetingIndexCtrl=function(superClass){function MeetingIndexCtrl(){this.confirmHideSuggested=bind(this.confirmHideSuggested,this),this.switchTab=bind(this.switchTab,this),this.openOrSuggest=bind(this.openOrSuggest,this),this.createSuggested=bind(this.createSuggested,this),MeetingIndexCtrl.__super__.constructor.apply(this,arguments),this.timelineLoaded=!1,this.ungroupedMeetings={},this.meetings=null,this.showUpcoming=null==this.location.search().tab||"upcoming"===this.location.search().tab,this.newSuggestionsButtonVisible=!1,this._initMeetings(),this._initMessageListener(),this._initPusher(),this._setLayout()}return extend(MeetingIndexCtrl,superClass),MeetingIndexCtrl.prototype._setLayout=function(){var addButton;return this.navigationBarService.show("Timeline"),addButton={imagePath:"images/add@2x.png",onClick:function(_this){return function(){return _this._addNewMeeting()}}(this)},this.navigationBarService.update({buttons:{right:addButton}})},MeetingIndexCtrl.prototype._initMessageListener=function(){return this.scope.$on("$routeUpdate",function(_this){return function(){return _this.showUpcoming=null==_this.location.search().tab||"upcoming"===_this.location.search().tab}}(this)),this.scope.$on("$destroy",function(_this){return function(){return _this.log.debug("[timeline] destroyed, unsubscribing MsgChannel"),_this.jsonMsgChannel.unsubscribe(_this.msgChannel)}}(this)),this.msgChannel=this.jsonMsgChannel.subscribe(function(_this){return function(data){return _this.log.debug("[timeline] received postmessage:",null!=data?data.event:void 0,data),"reloadTimeline"===(null!=data?data.event:void 0)&&_this.reload(),"removeTimelineMeeting"===(null!=data?data.event:void 0)&&_this._removeMeetingWithId(data.id),"calendarConnected"===(null!=data?data.event:void 0)&&_this._calendarConnected(),"calendarDisconnected"===(null!=data?data.event:void 0)&&_this._calendarDisconnected(),"addMeeting"===(null!=data?data.event:void 0)&&_this._addNewMeeting(),"fetchMoreMeetings"===(null!=data?data.event:void 0)?_this._fetchMoreMeetings():void 0}}(this))},MeetingIndexCtrl.prototype._initPusher=function(){var channelName,eventName,pusherCallback;return channelName=this.appConfig.pusher.channelName+this.sessionService.getUserId(),eventName="new_suggestions",pusherCallback=function(_this){return function(){return _this._fetchNewSuggestions()}}(this),this.pusherService.subscribeAndBind(channelName,eventName,pusherCallback),this.scope.$on("$destroy",function(_this){return function(){return _this.pusherService.unbind(channelName,eventName,pusherCallback)}}(this))},MeetingIndexCtrl.prototype._addNewMeeting=function(){return this.loading=!0,this.suggestionBtnWorking="new",this.SessionRestangular.all("meetings").post().then(function(_this){return function(data){return _this.log.debug("created meeting, received meeting data: ",data),_this.open(data),_this._addMeeting(data)}}(this))["finally"](function(_this){return function(){return _this.loading=!1,_this.suggestionBtnWorking=null}}(this))},MeetingIndexCtrl.prototype._addMeeting=function(meeting){return this.ungroupedMeetings.push(meeting),this.meetings=this.meetingGroupUtils.groupMeetings(this.ungroupedMeetings)},MeetingIndexCtrl.prototype._replaceMeeting=function(oldMeeting,newMeeting){return this.ungroupedMeetings=_.without(this.ungroupedMeetings,oldMeeting),this.ungroupedMeetings.push(newMeeting),this.meetings=this.meetingGroupUtils.groupMeetings(this.ungroupedMeetings)},MeetingIndexCtrl.prototype._removeMeeting=function(meeting){return this.ungroupedMeetings=_.without(this.ungroupedMeetings,meeting),this.meetings=this.meetingGroupUtils.groupMeetings(this.ungroupedMeetings)},MeetingIndexCtrl.prototype._removeMeetingWithId=function(meetingId){return this.scope.$apply(function(_this){return function(){return _this.ungroupedMeetings=_.remove(_this.ungroupedMeetings,function(meeting){return meeting.id!==meetingId}),_this.meetings=_this.meetingGroupUtils.groupMeetings(_this.ungroupedMeetings)}}(this))},MeetingIndexCtrl.prototype._resetInfiniteScrollVariables=function(){return this.fetchingMore=!1,this.pastLimit=this.appConfig.timeline.fetchMoreMeetingsLimit,this.pastOffset=0,this.upcomingLimit=this.appConfig.timeline.fetchMoreMeetingsLimit,this.upcomingOffset=0,this.suggestedOffset=0,this.upcomingInfiniteSrcollEnabled=!0,this.pastInfiniteSrcollEnabled=!0,this.suggestionMaxDate=this.dateHelper.thisWeekEndEpoch()},MeetingIndexCtrl.prototype._initMeetings=function(){return this._resetInfiniteScrollVariables(),this.meetings=this.meetingService.getCache(),null==this.meetings?(this.loading=!0,this._fetchAll()):(this.timelineLoaded=!0,this.timeout(function(_this){return function(){return _this._fetchAll()}}(this),1e3))},MeetingIndexCtrl.prototype._fetchAll=function(){var initialPastLimit,initialUpcomingLimit;return initialUpcomingLimit=this.appConfig.timeline.initialMeetingsLimit,initialPastLimit=this.appConfig.timeline.initialMeetingsLimit,this.error=null,this.q.all([this.meetingService.fetchScheduled(this.userRoute,{sort:"asc",include_draft:1,start_min:this.dateHelper.todayEpoch(),limit:initialUpcomingLimit,image_size:this.appConfig.thumbnail.small}),this.meetingService.fetchScheduled(this.userRoute,{sort:"desc",include_draft:1,start_max:this.dateHelper.todayEpoch(),limit:initialPastLimit,offset:this.pastOffset,image_size:this.appConfig.thumbnail.small}),this.meetingService.fetchSuggested(this.userRoute,{sort:"asc",include_draft:1,start_min:this.dateHelper.todayEpoch(),limit:initialUpcomingLimit,image_size:this.appConfig.thumbnail.small}),this.meetingService.fetchUnscheduled(this.userRoute)]).then(function(_this){return function(meetingData){var scheduledPast,scheduledUpcomingSpliced,suggested,unscheduled,upcoming;return upcoming=meetingData[0],scheduledPast=meetingData[1],suggested=meetingData[2],unscheduled=meetingData[3],_this.upcomingOffset=upcoming.length,_this.suggestedOffset=suggested.length,_this.pastOffset=scheduledPast.length,_this.scheduledUpcoming=_(upcoming).union(suggested).sortBy(function(meeting){return parseInt(meeting.begin_epoch)}).value(),scheduledUpcomingSpliced=_this.scheduledUpcoming.splice(0,initialUpcomingLimit),_this.ungroupedMeetings=_(scheduledUpcomingSpliced).union(scheduledPast,unscheduled).sortBy(function(meeting){return parseInt(meeting.begin_epoch)}).value(),_this.meetings=_this.meetingGroupUtils.groupMeetings(_this.ungroupedMeetings),_this.meetingService.setCache(_this.meetings),scheduledUpcomingSpliced.length&&(_this.suggestionMaxDate=_.max(scheduledUpcomingSpliced,function(meeting){return parseInt(meeting.begin_epoch)}).begin_epoch),_this.timelineLoaded=!0}}(this),function(_this){return function(failure){return _this.log.error("[timeline] load error:",failure),_this.connectivity.isOnline()||null==_this.meetings?_this.error=_this.errorHandlerService.handle(failure):void 0}}(this))["finally"](function(_this){return function(){return _this.loading=!1,_this.jsonMsgChannel.publishTo("PullToRefresh",JSON.stringify({event:"didFecthAll"}))}}(this))},MeetingIndexCtrl.prototype._fetchNextUpcoming=function(){return this.fetchingMore=!0,this.q.all([this.meetingService.fetchScheduled(this.userRoute,{sort:"asc",include_draft:1,start_min:this.dateHelper.todayEpoch(),limit:this.upcomingLimit,offset:this.upcomingOffset,image_size:this.appConfig.thumbnail.small}),this.meetingService.fetchSuggested(this.userRoute,{sort:"asc",start_min:this.dateHelper.todayEpoch(),limit:this.upcomingLimit,offset:this.suggestedOffset,image_size:this.appConfig.thumbnail.small})]).then(function(_this){return function(meetingData){var scheduledUpcomingSpliced,suggested,upcoming;return upcoming=meetingData[0],suggested=meetingData[1],_this.upcomingOffset+=upcoming.length,_this.suggestedOffset+=suggested.length,_this.scheduledUpcoming=_(_this.scheduledUpcoming).union(upcoming,suggested).sortBy(function(meeting){return parseInt(meeting.begin_epoch)}).value(),scheduledUpcomingSpliced=_this.scheduledUpcoming.splice(0,_this.upcomingLimit),_this.ungroupedMeetings=_(_this.ungroupedMeetings).union(scheduledUpcomingSpliced).sortBy(function(meeting){return parseInt(meeting.begin_epoch)}).value(),_this.meetings=_this.meetingGroupUtils.groupMeetings(_this.ungroupedMeetings),scheduledUpcomingSpliced.length&&(_this.suggestionMaxDate=_.max(scheduledUpcomingSpliced,function(meeting){return parseInt(meeting.begin_epoch)}).begin_epoch),0===meetingData[0].length&&0===meetingData[1].length?_this.upcomingInfiniteSrcollEnabled=!1:void 0}}(this),function(_this){return function(failure){return _this.log.error("[timeline] error:",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.fetchingMore=!1}}(this))},MeetingIndexCtrl.prototype._fetchNextPast=function(){return this.fetchingMore=!0,this.meetingService.fetchScheduled(this.userRoute,{sort:"desc",include_draft:1,start_max:this.dateHelper.todayEpoch(),limit:this.pastLimit,offset:this.pastOffset}).then(function(_this){return function(meetingData){var scheduledPast;return scheduledPast=meetingData,_this.pastOffset+=scheduledPast.length,_this.ungroupedMeetings=_.union(_this.ungroupedMeetings,scheduledPast),_this.meetings=_this.meetingGroupUtils.groupMeetings(_this.ungroupedMeetings),0===meetingData.length?_this.pastInfiniteSrcollEnabled=!1:void 0}}(this),function(_this){return function(failure){return _this.log.error("[timeline] error:",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.fetchingMore=!1}}(this))},MeetingIndexCtrl.prototype._fetchNewSuggestions=function(){return this.meetingService.fetchSuggested(this.userRoute,{sort:"asc",start_min:this.dateHelper.todayEpoch(),start_max:this.suggestionMaxDate,image_size:this.appConfig.thumbnail.small}).then(function(_this){return function(meetingData){var updateInstantly;return _this.log.debug("[timeline] New suggestions loaded successfully",meetingData),0===meetingData.length?(_this.log.debug("No suggestions found, remove old suggestions from timeline"),_.remove(_this.ungroupedMeetings,"is_suggested_meeting"),void(_this.newSuggestionsButtonVisible=!0)):(updateInstantly=!1,_.each(_this.ungroupedMeetings,function(meeting,index,list){var existingMeeting;return meeting.is_suggested_meeting?(existingMeeting=_.where(meetingData,{id:meeting.id})[0],null==existingMeeting?(_this.log.debug("Suggestion not found in new suggestions, remove old suggestion from timeline"),list[index]={removed:1},updateInstantly=!1,!0):null!=existingMeeting&&_.isEqual(meeting.originalElement,existingMeeting.originalElement)?(updateInstantly=!0,!0):null!=existingMeeting&&window.innerHeight-document.querySelector("#timeline_list_item_"+existingMeeting.id).getBoundingClientRect().top<0?(_this.log.debug("first element is below viewport bottom, update everything"),existingMeeting=null,updateInstantly=!0,!1):(_this.log.debug("first element is above viewport bottom, wait for user to update"),existingMeeting=null,updateInstantly=!1,!1)):!0}),_.remove(_this.ungroupedMeetings,"removed"),_this.ungroupedMeetings=_(meetingData).union(_this.ungroupedMeetings).uniq("id").value(),updateInstantly?_this.meetings=_this.meetingGroupUtils.groupMeetings(_this.ungroupedMeetings):_this.newSuggestionsButtonVisible=!0)}}(this),function(_this){return function(failure){return _this.log.error("[timeline] New suggestions failed loading, failing silently",failure)}}(this))},MeetingIndexCtrl.prototype._isUpcomingInfiniteSrcollEnabled=function(){return!this.fetchingMore&&this.upcomingInfiniteSrcollEnabled&&this.hasUpcomingMeetings()},MeetingIndexCtrl.prototype._isPastInfiniteSrcollEnabled=function(){return!this.fetchingMore&&this.pastInfiniteSrcollEnabled&&this.hasPastMeetings()},MeetingIndexCtrl.prototype.handleError=function(){return this.reload()},MeetingIndexCtrl.prototype.reload=function(){return this.error=null,this.connectivity.isOnline()?this._initMeetings():void 0},MeetingIndexCtrl.prototype.ptrCallback=function(){return this._fetchAll()},MeetingIndexCtrl.prototype.fetchMoreMeetings=function(){return this.timelineLoaded&&(this.showUpcoming&&this._isUpcomingInfiniteSrcollEnabled()&&this._fetchNextUpcoming(),!this.showUpcoming&&this._isPastInfiniteSrcollEnabled())?this._fetchNextPast():void 0},MeetingIndexCtrl.prototype.hasUpcomingMeetings=function(){return this.hasMeetings(this.meetings.today)||this.hasMeetings(this.meetings.unscheduled)||this.hasMeetings(this.meetings.thisWeekUpcoming)||this.hasMeetings(this.meetings.nextWeek)||this.hasMeetings(this.meetings.furtherInFuture)},MeetingIndexCtrl.prototype.hasPastMeetings=function(){return this.hasMeetings(this.meetings.yesterday)||this.hasMeetings(this.meetings.thisWeekBefore)||this.hasMeetings(this.meetings.lastWeek)||this.hasMeetings(this.meetings.furtherInPast)},MeetingIndexCtrl.prototype.hasMeetings=function(list){return!_.isEmpty(list)},MeetingIndexCtrl.prototype.createSuggested=function(meeting){return this.meetingService.createSuggested(meeting.id).then(function(_this){return function(data){return _this.log.debug("created suggestion, received meeting data: ",data),_this.log.debug("meeting.id: "+meeting.id+" -- data.id: "+data.id),_this.open(data),_this._replaceMeeting(meeting,data)}}(this),function(_this){return function(failure){return _this.log.warn("Failed creating a suggested meeting",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},MeetingIndexCtrl.prototype.hideSuggested=function(meeting){return this.confirmDialog=null,this.meetingService.hideSuggested(meeting.id).then(function(_this){return function(data){return _this.log.debug("Removing suggested meeting from timeline with data",meeting,data),_this._removeMeeting(meeting)}}(this),function(_this){return function(failure){return _this.log.warn("Failed hiding a suggested meeting",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},MeetingIndexCtrl.prototype.openOrSuggest=function(meeting){return meeting.is_suggested_meeting?this.suggest(meeting):this.open(meeting)},MeetingIndexCtrl.prototype.open=function(meeting){return this.meetingService.setMeeting(meeting),this.location.path("/timeline/meeting/"+meeting.id)},MeetingIndexCtrl.prototype.suggest=function(meeting){var suggestEvent;return suggestEvent=new CustomEvent("suggestMeeting",{detail:{meetingId:meeting.id},bubbles:!1}),window.dispatchEvent(suggestEvent)},MeetingIndexCtrl.prototype.groupMeetings=function(){return this.meetings=this.meetingGroupUtils.groupMeetings(this.ungroupedMeetings),this.newSuggestionsButtonVisible=!1},MeetingIndexCtrl.prototype.switchTab=function(tab){return this.showUpcoming="upcoming"===tab,this.location.search("tab",tab)},MeetingIndexCtrl.prototype.confirmHideSuggested=function(meeting,onConfirm,onCancel){return this.confirmDialog={title:"Hide this event?",message:"This meeting will be permanently hidden from your timeline.",buttonConfirmCallback:function(_this){return function(){return _this.hideSuggested(meeting),null!=onConfirm?onConfirm():void 0}}(this),buttonConfirmCaption:"Hide",buttonCancelCallback:function(_this){return function(){return _this.confirmDialog=null,null!=onCancel?onCancel():void 0}}(this),buttonCancelCaption:"Cancel"}},MeetingIndexCtrl}(MeetingBaseCtrl),MeetingShowCtrl=function(superClass){function MeetingShowCtrl(){MeetingShowCtrl.__super__.constructor.apply(this,arguments),this.meetingId=this.viewParams.get("meetingId"),this.meeting=this.meetingService.getMeeting(),this.uploadProgress=null,this.participant=null,this.isManager=!1,this.isRsvpRequired=!1,this.meetingDataNotAvailable=!0,this.removedMaterials=[],this._loadShowView(this.meeting),this._initMessageListener(),this._setLayout()}return extend(MeetingShowCtrl,superClass),MeetingShowCtrl.prototype._initMessageListener=function(){return this.scope.$on("$routeUpdate",function(_this){return function(){return _this.meeting=_this.meetingService.getMeeting()}}(this))},MeetingShowCtrl.prototype._initMeetmeRequest=function(meeting){return this.meetmeState=0===meeting.matchmaking_accepted?"initial":null},MeetingShowCtrl.prototype._initParticipant=function(meeting){return this.participant=this.participantService.getParticipant(this.userRoute.id,meeting.participants),this.isManager=this.participantService.isManager(this.participant),this.isRsvpRequired=this.participantService.isRsvpRequired(this.participant),this.hasLeftScheduling=this.participantService.hasLeftScheduling(this.participant)},MeetingShowCtrl.prototype._initInvitationButtonVisibility=function(){var ref;return this.sendInvitationsButtonVisible=(null!=(ref=this.meeting.participants)?ref.length:void 0)>1&&this.meeting.is_draft&&this.isManager},MeetingShowCtrl.prototype._initParticipantListRsvpPropertyName=function(){return this.rsvpPropertyName=this.schedulingStarted?"has_answered_current_scheduling":"rsvp_status"},MeetingShowCtrl.prototype._setMeeting=function(meeting){return this.meeting=meeting,this.schedulingStarted=this.meetingService.isSchedulingStarted(this.meeting),this.schedulingFailed=this.meetingService.isSchedulingFailed(this.meeting),this._initParticipant(this.meeting),this._initInvitationButtonVisibility(),this._initParticipantListRsvpPropertyName(),this.meetingService.setMeeting(this.meeting)},MeetingShowCtrl.prototype._unsetMeeting=function(){return this.meeting=null},MeetingShowCtrl.prototype._loadShowView=function(meeting){return this.meetingLoaded=!1,this._initMeetmeRequest(meeting),this._setMeeting(meeting),this._reloadMeeting(meeting)},MeetingShowCtrl.prototype._reloadMeeting=function(){return this.loading=!0,this.delayedSpinner=!0,this.setSelectedIndex(null),this.meetingService.fetchMeeting(this.meetingId,{image_size:this.appConfig.thumbnail.small}).then(function(_this){return function(data){return _this._setMeeting(data),_this.meetingLoaded=!0,_this._setLayout()}}(this),function(_this){return function(failure){var ref;return _this.log.error("[meeting#show] Load error:",failure),_this.error=_this.errorHandlerService.handle(failure),_this.reloadRequired=!0,_this.accessDenied=403===(null!=failure&&null!=(ref=failure.error)?ref.code:void 0)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},MeetingShowCtrl.prototype._updateParticipantList=function(){return this.participantService.fetchParticipantList(this.meeting.id,{image_size:this.appConfig.thumbnail.small}).then(function(_this){return function(data){return _this.log.debug("participant list updated",data),_this.meeting.participants=data}}(this),function(_this){return function(failure){return _this.log.warn("participant update failed",failure),_this.reloadRequired=!1,_this.error=_this.errorHandlerService.handle(failure)}}(this))},MeetingShowCtrl.prototype._saveMeetmeConfimation=function(){return this.meeting.put().then(function(_this){return function(data){return _this._setLayout(),_this.meetmeState=null,_this._setMeeting(data)}}(this),function(_this){return function(failure){return _this.log.warn("Error accepting meet me request",failure),_this.reloadRequired=!1,_this.error=_this.errorHandlerService.handle(failure)}}(this))},MeetingShowCtrl.prototype._sendInvitations=function(requireRsvp){return this.confirmDialog=null,this.btnWorking="sendInvitations",this.participantService.sendInvitationsToDraftParticipants(this.meetingId,{require_rsvp:requireRsvp}).then(function(_this){return function(data){return _this.log.debug("Draft participants invited successfully",data),_this._reloadMeeting()}}(this),function(_this){return function(failure){return _this.log.error("Failed to send invites",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},MeetingShowCtrl.prototype._setLayout=function(){var openControls,title;return title="Meeting",this.meetingService.isRemoved(this.meeting)&&(title="Meeting removed"),!this.meetingService.isRemoved(this.meeting)&&this.meetingLoaded&&(openControls={imagePath:"images/more_13x13.svg",onClick:function(_this){return function(){return _this._openMeetingControls()}}(this)}),this.navigationBarService.update({title:title,buttons:{left:"web"!==this.deviceUtils.platform()?this.navigationBarService.buttonToPath("/"+this.tab):null,right:openControls}})
},MeetingShowCtrl.prototype._setMeetMeButtons=function(){var backButton;return backButton={title:"Back",onClick:function(_this){return function(){return _this.rootScope.$broadcast("blurInput"),_this.scope.$apply(function(){return _this.meetmeState="initial"}),_this._setLayout()}}(this)},this.navigationBarService.update({buttons:{left:backButton}})},MeetingShowCtrl.prototype._openEdit=function(target){return this.viewParams.set({fromReview:null}),this.location.path("/"+this.tab+"/meeting/"+this.meeting.id+"/edit/"+target)},MeetingShowCtrl.prototype._openMeetingControls=function(){return this.location.path("/"+this.tab+"/meeting/"+this.meeting.id+"/controls")},MeetingShowCtrl.prototype.getBackgroundImageUrl=function(meeting){return this.meetingService.getBackgroundImageUrl(meeting)},MeetingShowCtrl.prototype.isUpcoming=function(){return this.dateHelper.isEpochInFuture(this.meeting.begin_epoch)},MeetingShowCtrl.prototype.isMaterialEmpty=function(materialClass){return 0===this.meeting[materialClass+"_html"].length},MeetingShowCtrl.prototype.openParticipants=function(){var breadcrumb,isDraft;return breadcrumb=encodeURIComponent(this.meeting.title_value),isDraft=1===this.meeting.is_draft,this.viewParams.set({breadcrumb:breadcrumb}),this.location.path("/"+this.tab+"/meeting/"+this.meeting.id+"/participants")},MeetingShowCtrl.prototype.openMaterial=function(material){var breadcrumb;return breadcrumb=encodeURIComponent(this.meeting.title_value),this.viewParams.set({breadcrumb:breadcrumb,materialClass:material.material_class}),this.location.path("/"+this.tab+"/meeting/"+this.meeting.id+"/material/"+material.id)},MeetingShowCtrl.prototype.sendInvitations=function(){return this.isUpcoming()?this.confirmDialog={title:"Require rsvp?",message:"Do you wish to request rsvp from participants?",buttonConfirmCallback:function(_this){return function(){return _this._sendInvitations(!0)}}(this),buttonConfirmCaption:"Yes",buttonCancelCallback:function(_this){return function(){return _this._sendInvitations(!1)}}(this),buttonCancelCaption:"No"}:this._sendInvitations(!1)},MeetingShowCtrl.prototype.openScheduling=function(){return this.location.path("/timeline/meeting/"+this.meeting.id+"/scheduling")},MeetingShowCtrl.prototype.openSwipeToMeet=function(){return this.viewParams.set({menuVisible:!0}),this.location.path("/"+this.tab+"/meeting/"+this.meeting.id+"/scheduling/"+this.meeting.current_scheduling_id)},MeetingShowCtrl.prototype.openSchedulingLog=function(){return this.viewParams.set({showCloseButton:!1,showProvideAvailabilityButton:this.meeting.current_scheduling.organizer_swiping_required}),this.location.path("/"+this.tab+"/meeting/"+this.meeting.id+"/scheduling/"+this.meeting.current_scheduling_id+"/log")},MeetingShowCtrl.prototype.handleError=function(){return this.error=null,this.accessDenied?void this.window.history.back():this.reloadRequired?(this._setLayout(),this._reloadMeeting(this.meeting)):void 0},MeetingShowCtrl.prototype.edit=function(target){return this.isManager?"date"===target&&0!==this.meeting.current_scheduling_id?this.openSchedulingLog():this._openEdit(target):void 0},MeetingShowCtrl.prototype.updateRsvpStatus=function(rsvpStatus){return this.rsvpBtnWorking=rsvpStatus,this.participantService.updateRsvpStatus(this.participant.id,rsvpStatus).then(function(_this){return function(){return _this._updateParticipantList(),_this.isRsvpRequired=!1,_this.rsvpBtnWorking=null}}(this),function(_this){return function(failure){return _this.log.warn(failure),_this.reloadRequired=!1,_this.error=_this.errorHandlerService.handle(failure),_this.rsvpBtnWorking=null}}(this))},MeetingShowCtrl.prototype.openUrl=function(url,type){var appErrorCode;return appErrorCode="skype"===type?this.errorHandlerService.SKYPE_OPEN_FAILED:this.errorHandlerService.APP_OPEN_FAILED,this.mtnURL.open(url,null,"_blank").then(function(_this){return function(){return _this.log.debug("URL opened successfully")}}(this),function(_this){return function(){return _this.error=_this.errorHandlerService.handleAppError(appErrorCode)}}(this))},MeetingShowCtrl.prototype.acceptMeetmeRequest=function(){return this.log.debug("accept meet me"),this.meetmeState="accept",this._setMeetMeButtons()},MeetingShowCtrl.prototype.declineMeetmerequest=function(){return this.log.debug("decline meet me"),this.meetmeState="decline",this._setMeetMeButtons()},MeetingShowCtrl.prototype.editMeetmeRequest=function(){return this.meetMeBtnWorking="edit",this.meeting.matchmaking_accepted=1,this._saveMeetmeConfimation()["finally"](function(_this){return function(){return _this.meetMeBtnWorking=null}}(this))},MeetingShowCtrl.prototype.sendMeetmeConfirmation=function(){return this.meetMeBtnWorking="send",this.meeting.matchmaking_accepted=1,this._saveMeetmeConfimation().then(function(_this){return function(){return _this.sendInvitations()}}(this))["finally"](function(_this){return function(){return _this.meetMeBtnWorking=null}}(this))},MeetingShowCtrl.prototype.sendMeetmeDeclination=function(){return this.meetMeBtnWorking="decline",this.meeting.post("matchmaking_decline",{decline_message:this.meetmeDeclination}).then(function(_this){return function(){return _this.meetmeDeclination=null,_this.jsonMsgChannel.publish(JSON.stringify({event:"removeTimelineMeeting",id:_this.meeting.id})),_this.window.history.back()}}(this),function(_this){return function(failure){return _this.log.warn("Error declining",failure),_this.reloadRequired=!1,_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.meetMeBtnWorking=null}}(this))},MeetingShowCtrl.prototype.removeMaterial=function(material){return this.removedMaterials.push(material),this.materialService.removeMaterial(material.id).then(function(_this){return function(data){return _this.log.debug("Material removed successfully",data),_this.setSelectedIndex(null)}}(this),function(_this){return function(failure){return _this.log.error("Material remove failed",failure),_this.error=_this.errorHandlerService.handle(failure),_this.removedMaterials.pop()}}(this))},MeetingShowCtrl.prototype.removeMaterialEnabled=function(material){return material.creator_id===this.sessionService.getUserId()||this.isManager},MeetingShowCtrl.prototype.setSelectedIndex=function(index){return this.selectedIndex=index},MeetingShowCtrl}(MeetingBaseCtrl),MeetingEditCtrl=function(superClass){function MeetingEditCtrl(){MeetingEditCtrl.__super__.constructor.apply(this,arguments),this.editing=this.viewParams.get("editing"),this.fromReview=this.viewParams.get("fromReview"),this.tinymceConf={plugins:["autolink textcolor"],menubar:!1,toolbar:!1,statusbar:!1},this.meeting=this.meetingService.getMeeting(),this._setMeeting(),this._setEditButtons()}return extend(MeetingEditCtrl,superClass),MeetingEditCtrl.prototype._setEditButtons=function(){var cancelButton,saveButton;return this.navigationBarService.update({title:"Meeting"}),cancelButton={title:"Cancel",onClick:function(_this){return function(){return _this.rootScope.$broadcast("blurInput"),_this.cancelEdit()}}(this)},saveButton={title:"Done",onClick:function(_this){return function(){return _this.rootScope.$broadcast("blurInput"),_this.confirmEdit(),_this.scope.$$phase?void 0:_this.scope.$apply()}}(this)},this.navigationBarService.update({buttons:{left:cancelButton,right:"ios"===this.deviceUtils.platform()?saveButton:void 0}}),this.fromReview?this.navigationBarService.hideMenu():void 0},MeetingEditCtrl.prototype._setEditCommunicationToolButtons=function(){var backButton;return backButton={title:"Back",onClick:function(_this){return function(){return _this.selectCommunicationToolType(_this.meeting.online_conferencing_option)}}(this)},this.navigationBarService.update({SPAButtonHidden:!0,buttons:{left:backButton}}),this.fromReview?this.navigationBarService.hideMenu():void 0},MeetingEditCtrl.prototype._setPristine=function(){return this.meetingPristine=angular.copy(this.meeting)},MeetingEditCtrl.prototype._revert=function(){return this.meetingService.setMeeting(this.meetingPristine),this.meetingPristine=null},MeetingEditCtrl.prototype._setMeeting=function(){return this.dateUnset=this.dateHelper.isEpochUnset(this.meeting.begin_epoch),this._setPristine(),this._setDefaultEpoch(),"communicationtool"!==this.editing||null!=this.meeting.online_conferencing_option&&""!==this.meeting.online_conferencing_option?void 0:(this.log.debug("communication tool not set"),this.toolSelectVisible=!0)},MeetingEditCtrl.prototype._update=function(){return null!=this.meeting.id?(this.loading=!0,this.delayedSpinner=!1,this.meeting.put().then(function(_this){return function(data){return _this.log.debug("Success updating",data),"communicationtool"===_this.editing&&"lync"===_this.meeting.online_conferencing_option&&_this.removeTinyMCE("lync_copypaste"),_this.meetingService.setMeeting(data),_this.editing=null,_this.window.history.back()}}(this),function(_this){return function(failure){return _this.log.warn("Error updating",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))):(this.meetingService.setMeeting(this.meeting),this.window.history.back())},MeetingEditCtrl.prototype._setDefaultEpoch=function(){return"date"===this.editing&&this.dateHelper.isEpochUnset(this.meeting.begin_epoch)?(this.meeting.begin_epoch=this.dateHelper.defaultNewMeetingBeginDate(),this.meeting.end_epoch=this.dateHelper.defaultNewMeetingEndDate(this.meeting.begin_epoch)):void 0},MeetingEditCtrl.prototype.handleError=function(){return this.error=null},MeetingEditCtrl.prototype.isPro=function(){return this.currentUserService.isPro(this.user)},MeetingEditCtrl.prototype.isUpcoming=function(){return this.dateHelper.isEpochInFuture(this.meeting.begin_epoch)},MeetingEditCtrl.prototype.openStartTrialModal=function(){return this.location.path("/"+this.tab+"/starttrial")},MeetingEditCtrl.prototype.openScheduling=function(){return this.location.path("/timeline/meeting/"+this.meeting.id+"/scheduling")},MeetingEditCtrl.prototype.cancelEdit=function(){return this._revert(),this.window.history.back()},MeetingEditCtrl.prototype.editCommunicationToolType=function(){return"lync"===this.meeting.online_conferencing_option&&this.removeTinyMCE("lync_copypaste"),this.toolSelectVisible=!0,this._setEditCommunicationToolButtons()},MeetingEditCtrl.prototype.selectCommunicationToolType=function(tool){var ref;return this.isPro()||"hangout"!==tool&&"lync"!==tool&&"custom"!==tool?""===tool?(this.meeting.online_conferencing_option=tool,this._update()):("skype"!==tool||null!=(null!=(ref=this.meeting.online_conferencing_data)?ref.skype_account:void 0)&&""!==this.meeting.online_conferencing_data.skype_account||(null==this.meeting.online_conferencing_data&&(this.meeting.online_conferencing_data={}),this.meeting.online_conferencing_data.skype_account=this.user.skype),this._setEditButtons(),this.toolSelectVisible=!1,this.meeting.online_conferencing_option=tool):this.openStartTrialModal()},MeetingEditCtrl.prototype.confirmEdit=function(){var ref;if("communicationtool"===this.editing&&"lync"===this.meeting.online_conferencing_option){if("sip"===this.meeting.online_conferencing_data.lync_mode&&!this.communicationtool.$valid)return void(this.error=this.errorHandlerService.handleAppError(this.errorHandlerService.INVALID_FORM));this.meeting.online_conferencing_data.lync_copypaste=tinyMCE.get("lync_copypaste").getContent()}return"date"===this.editing&&this.isUpcoming()&&(null!=(ref=this.meeting.participants)?ref.length:void 0)>1&&!this.meeting.is_draft?this.confirmDialog={title:"Meeting time changed",message:"Ask participants to RSVP again?",buttonConfirmCallback:function(_this){return function(){return _this.onDateEditConfirm(!0)}}(this),buttonConfirmCaption:"Yes",buttonCancelCallback:function(_this){return function(){return _this.onDateEditConfirm(!1)}}(this),buttonCancelCaption:"No"}:this._update()},MeetingEditCtrl.prototype.onDateEditConfirm=function(requireRsvpAgain){return requireRsvpAgain&&(this.meeting.require_rsvp_again=1),this.confirmDialog=null,this._update()},MeetingEditCtrl.prototype.openSchedulingWebDiagram=function(id){var OpenWindow;return OpenWindow=window.open("wsd.html","mywin",""),this.meeting.one("schedulings",id).one("flow").get().then(function(){return function(data){var output;return output=data,OpenWindow.dataFromParent=output,OpenWindow.init()}}(this))},MeetingEditCtrl}(MeetingBaseCtrl),MeetingControlsCtrl=function(superClass){function MeetingControlsCtrl(){MeetingControlsCtrl.__super__.constructor.apply(this,arguments),this.meetingId=this.viewParams.get("meetingId"),this.meeting=this.meetingService.getMeeting(),this.wisdom=this.meeting.created_epoch%7,this.meeting.meetingDataNotAvailable?this._fetchMeeting():this._setMeeting(this.meeting),this._setLayout()}return extend(MeetingControlsCtrl,superClass),MeetingControlsCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"Meeting controls",buttons:{left:"web"!==this.deviceUtils.platform()?this.navigationBarService.defaultBackButton():null}})},MeetingControlsCtrl.prototype._setUploadButtons=function(){var cancelButton;return cancelButton={title:"Cancel upload",onClick:function(_this){return function(){return _this._cancelUpload()}}(this)},this.navigationBarService.update({buttons:{right:cancelButton}}),"android"===this.deviceUtils.platform()?this.navigationBarService.hideMenu():void 0},MeetingControlsCtrl.prototype._fetchMeeting=function(){return this.loading=!0,this.delayedSpinner=!0,this.meetingService.fetchMeeting(this.meetingId,{image_size:this.appConfig.thumbnail.small}).then(function(_this){return function(data){return _this._setMeeting(data)}}(this),function(_this){return function(failure){return _this.log.error("[meeting#show] Load error:",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},MeetingControlsCtrl.prototype._setMeeting=function(meeting){return this.meeting=meeting,this.schedulingStarted=this.meetingService.isSchedulingStarted(this.meeting),this.schedulingFailed=this.meetingService.isSchedulingFailed(this.meeting),this._initParticipant(this.meeting)},MeetingControlsCtrl.prototype._initParticipant=function(meeting){return this.participant=this.participantService.getParticipant(this.user.id,meeting.participants),this.isManager=this.participantService.isManager(this.participant),this.hasLeftScheduling=this.participantService.hasLeftScheduling(this.participant)},MeetingControlsCtrl.prototype._cancelUpload=function(){return this.materialService.abortAddPhoto(),this._setLayout()},MeetingControlsCtrl.prototype._removeMeeting=function(){return this.btnWorking="removingMeeting",this.confirmDialog=null,this.meeting.remove().then(function(_this){return function(){return _this.jsonMsgChannel.publish(JSON.stringify({event:"removeTimelineMeeting",id:_this.meeting.id})),_this.location.path("/"+_this.tab).replace()}}(this),function(_this){return function(failure){return _this.log.debug("Removing meeting failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},MeetingControlsCtrl.prototype._leaveMeeting=function(){return this.btnWorking="removingParticipant",this.participantService.removeParticipant(this.participant.id).then(function(_this){return function(data){return _this.log.debug("Participant removed successfully",data),_this.location.path("/"+_this.tab).replace()}}(this),function(_this){return function(failure){return _this.log.error("Participant remove failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},MeetingControlsCtrl.prototype.leaveScheduling=function(){return this.viewParams.set({menuVisible:!0}),this.location.path("/"+this.tab+"/meeting/"+this.meetingId+"/scheduling/"+this.meeting.current_scheduling_id+"/leave/confirm")},MeetingControlsCtrl.prototype.confirmRemoveMeeting=function(){return this.confirmDialog={title:"Remove meeting?",message:"This meeting will be removed permanently. Are you sure?",buttonConfirmCallback:function(_this){return function(){return _this._removeMeeting()}}(this),buttonConfirmCaption:"Remove",buttonCancelCallback:function(_this){return function(){return _this.confirmDialog=null}}(this),buttonCancelCaption:"Cancel"}},MeetingControlsCtrl.prototype.confirmLeaveMeeting=function(){return this.confirmDialog={title:"Leave meeting?",message:"Are you sure you want to remove yourself from this meeting? You need to be invited to access it again.",buttonConfirmCallback:function(_this){return function(){return _this._leaveMeeting()}}(this),buttonConfirmCaption:"Ok",buttonCancelCallback:function(_this){return function(){return _this.confirmDialog=null}}(this),buttonCancelCaption:"Cancel"}},MeetingControlsCtrl.prototype.addPhoto=function(){return this._setUploadButtons(),this.materialService.addPhoto(this.appConfig.thumbnail.small).then(function(_this){return function(data){return _this.log.debug("Converting photo to material",data),_this.meeting.post("materials",{upload_id:data.result.upload_id,material_name:"Uploaded photo"})}}(this)).then(function(_this){return function(material){return _this.log.debug("material successfully converted",material),_this.window.history.back()}}(this),function(_this){return function(failure){return _this.log.error("Failed to upload or convert photo into a meeting material",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this),function(_this){return function(progress){return _this.uploadProgress=progress}}(this))["finally"](function(_this){return function(){return _this.uploadProgress=null,_this._setLayout()}}(this))},MeetingControlsCtrl.prototype.handleError=function(){return this.error=null},MeetingControlsCtrl}(MeetingBaseCtrl),meetingApp=angular.module("meetingApp",["appConfig","meetingModule","currentUserModule","participantModule","calendarModule","suggestionModule","pusherModule","animations","materialFilters","meetingGroupUtils","nativeUi","partials","dateHelper","mtnProgress","mtnFloatLabel","mtnSwipeToReveal","mtnMoveCursorToEnd","mtnListFilters","ngAnimate","ui.tinymce","react","meetingComponents","mtnUtils","connectivity","mtnURL"]),meetingApp.controller("MeetingIndexCtrl",MeetingIndexCtrl),meetingApp.controller("MeetingShowCtrl",MeetingShowCtrl),meetingApp.controller("MeetingEditCtrl",MeetingEditCtrl),meetingApp.controller("MeetingControlsCtrl",MeetingControlsCtrl);var MenuBaseCtrl,MenuCalendarIntegrationCtrl,MenuDefaultCalendarsCtrl,MenuEmailNotificationCtrl,MenuIndexCtrl,MenuNotificationCtrl,MenuNotificationSettingsCtrl,MenuPushNotificationCtrl,MenuRegionalSettingsCtrl,menuApp,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;MenuBaseCtrl=function(){function MenuBaseCtrl(scope,location,window1,log,q,appConfig,SessionRestangular,sessionService,currentUserService,errorHandlerService,calendarService,suggestionService,navigationBarService,accountService,notificationService,pushNotificationService,viewParams,deviceUtils,stringUtils,deviceready,jsonMsgChannel,dateHelper){this.scope=scope,this.location=location,this.window=window1,this.log=log,this.q=q,this.appConfig=appConfig,this.SessionRestangular=SessionRestangular,this.sessionService=sessionService,this.currentUserService=currentUserService,this.errorHandlerService=errorHandlerService,this.calendarService=calendarService,this.suggestionService=suggestionService,this.navigationBarService=navigationBarService,this.accountService=accountService,this.notificationService=notificationService,this.pushNotificationService=pushNotificationService,this.viewParams=viewParams,this.deviceUtils=deviceUtils,this.stringUtils=stringUtils,this.deviceready=deviceready,this.jsonMsgChannel=jsonMsgChannel,this.dateHelper=dateHelper}return MenuBaseCtrl.$inject=["$scope","$location","$window","$log","$q","appConfig","SessionRestangular","sessionService","currentUserService","errorHandlerService","calendarService","suggestionService","navigationBarService","accountService","notificationService","pushNotificationService","viewParams","deviceUtils","stringUtils","deviceready","jsonMsgChannel","dateHelper"],MenuBaseCtrl.prototype.openAppSettings=function(){return window.OpenSettings.open()},MenuBaseCtrl}(),MenuIndexCtrl=function(superClass){function MenuIndexCtrl(){MenuIndexCtrl.__super__.constructor.apply(this,arguments),this.isDeveloperMenuVisible=this.appConfig.isDevelopmentMode,this.appEnvironment=this.appConfig.environment,this.appVersion=this.appConfig.version,this.deviceready.then(function(_this){return function(){return _this.openAppSettingsVisible="ios"===_this.deviceUtils.platform()&&_this.deviceUtils.version()>=8}}(this)),this._setLayout()}return extend(MenuIndexCtrl,superClass),MenuIndexCtrl.prototype._setLayout=function(){var title;return title="Settings",this.navigationBarService.update({title:title})},MenuIndexCtrl.prototype.signOut=function(){return this.sessionService.signOut()},MenuIndexCtrl.prototype.openProfile=function(){return this.location.path("/settings/profile/")},MenuIndexCtrl.prototype.openNotificationSettings=function(){return this.location.path("/settings/notifications")},MenuIndexCtrl.prototype.openCalendarSettings=function(){return this.location.path("/settings/timeline")},MenuIndexCtrl.prototype.openAccountSettings=function(){return this.location.path("/settings/calendars")},MenuIndexCtrl.prototype.openRegionalSettings=function(){return this.location.path("/settings/regional")},MenuIndexCtrl.prototype.openStyleguide=function(){return this.location.path("/styleguide")},MenuIndexCtrl.prototype.handleError=function(){return this.error=null},MenuIndexCtrl}(MenuBaseCtrl),MenuNotificationSettingsCtrl=function(superClass){function MenuNotificationSettingsCtrl(){MenuNotificationSettingsCtrl.__super__.constructor.apply(this,arguments),this._setLayout()}return extend(MenuNotificationSettingsCtrl,superClass),MenuNotificationSettingsCtrl.prototype._setLayout=function(){return this.navigationBarService.show("Notifications"),this.navigationBarService.update({buttons:{left:"web"!==this.deviceUtils.platform()?this.navigationBarService.defaultBackButton():null}})},MenuNotificationSettingsCtrl.prototype.openPushNotificationMenu=function(){return this.location.path("/settings/notifications/push")},MenuNotificationSettingsCtrl.prototype.openEmailNotificationMenu=function(){return this.location.path("/settings/notifications/email")},MenuNotificationSettingsCtrl.prototype.handleError=function(){return this.error=null},MenuNotificationSettingsCtrl}(MenuBaseCtrl),MenuNotificationCtrl=function(superClass){function MenuNotificationCtrl(){MenuNotificationCtrl.__super__.constructor.apply(this,arguments)}return extend(MenuNotificationCtrl,superClass),MenuNotificationCtrl.prototype._fetchNotifcationSettings=function(){return this.loading=!0,this.currentUserService.getRoute().all("notification_settings").getList().then(function(_this){return function(data){return _this.log.debug("fetching settings succesful",data),data=_.filter(data,function(setting){return setting.type===_this.type}),_.each(data,function(setting){setting.value=1===setting.value}),_this.settings=_.values(_.groupBy(data,function(setting){return setting.header}))}}(this),function(_this){return function(failure){return _this.log.error("fetching settings failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},MenuNotificationCtrl.prototype._update=function(type,notification){return this.settings[type][notification].saving=!0,this.settings[type][notification].put().then(function(_this){return function(data){return _this.log.debug("saving setting succesful",data),_this.settings[type][notification].saving=!1}}(this),function(_this){return function(failure){return _this.log.error("saving setting failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},MenuNotificationCtrl.prototype._setLayout=function(title){return null==title&&(title="Other"),this.navigationBarService.update({title:title,buttons:{left:"web"!==this.deviceUtils.platform()?this.navigationBarService.defaultBackButton():null}})},MenuNotificationCtrl.prototype.toggleNotificationValue=function(type,notification){return this.settings[type][notification].value=!this.settings[type][notification].value,this._update(type,notification,this.settings[type][notification].value)},MenuNotificationCtrl.prototype.setNotificationValue=function(type,notification,value){return this.settings[type][notification].value=value,this._update(type,notification,this.settings[type][notification].value)},MenuNotificationCtrl.prototype.handleError=function(){return this.reload()},MenuNotificationCtrl.prototype.reload=function(){return this.error=null,this._fetchNotifcationSettings()},MenuNotificationCtrl}(MenuBaseCtrl),MenuEmailNotificationCtrl=function(superClass){function MenuEmailNotificationCtrl(){MenuEmailNotificationCtrl.__super__.constructor.apply(this,arguments),this.type="email",this.visibleSettings="notificationSettings",this._fetchNotifcationSettings(),this._setLayout(this.type)}return extend(MenuEmailNotificationCtrl,superClass),MenuEmailNotificationCtrl}(MenuNotificationCtrl),MenuPushNotificationCtrl=function(superClass){function MenuPushNotificationCtrl(){var notificationPermissionAsked;MenuPushNotificationCtrl.__super__.constructor.apply(this,arguments),notificationPermissionAsked=this.notificationService.getPermissionAsked(),this.pushTestButtonVisible=!0,this.pushNotificationsEnabled=this.pushNotificationService.pushNotificationStatus,this.type="push",this.visibleSettings=notificationPermissionAsked?"notificationSettings":"askPermission",this.deviceready.then(function(_this){return function(){return _this.openAppSettingsVisible="ios"===_this.deviceUtils.platform()&&_this.deviceUtils.version()>=8}}(this)),this._fetchNotifcationSettings(),this._initMessageListener(),this._setLayout(this.type)}return extend(MenuPushNotificationCtrl,superClass),MenuPushNotificationCtrl.prototype._initMessageListener=function(){return this.scope.$on("$destroy",function(_this){return function(){return _this.log.debug("[settings] destroyed, unsubscribing MsgChannel"),_this.jsonMsgChannel.unsubscribe(_this.msgChannel)}}(this)),this.msgChannel=this.jsonMsgChannel.subscribe(function(_this){return function(data){return _this.log.debug("[settings] received postmessage: ",null!=data?data.event:void 0,data),"UAregistrationSuccess"===(null!=data?data.event:void 0)&&_this._registrationSuccess(),"pushNotificationStatusChanged"===(null!=data?data.event:void 0)?_this._pushNotificationStatusChanged(data.status):void 0}}(this))},MenuPushNotificationCtrl.prototype._registrationSuccess=function(){return this.btnWorking=null,this.visibleSettings="notificationSettings",this.scope.$apply()},MenuPushNotificationCtrl.prototype._pushNotificationStatusChanged=function(status){return this.log.debug("Push notification status changed",status),this.btnWorking=null,this.pushNotificationsEnabled=status},MenuPushNotificationCtrl.prototype.initPushNotifications=function(){return this.btnWorking="initPushNotifications",this.notificationService.setPermissionAsked(!0),this.notificationService.initPushNotifications()},MenuPushNotificationCtrl.prototype.testPushNotifications=function(){return this.btnWorking="testPushNotifications",this.pushNotificationService.testPushNotifications()},MenuPushNotificationCtrl}(MenuNotificationCtrl),MenuDefaultCalendarsCtrl=function(superClass){function MenuDefaultCalendarsCtrl(){MenuDefaultCalendarsCtrl.__super__.constructor.apply(this,arguments),this.delayedSpinner=!0,this.deviceId=this.deviceUtils.uuid(),this._fetchSuggestionSources(),this._setLayout()}return extend(MenuDefaultCalendarsCtrl,superClass),MenuDefaultCalendarsCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"Default calendars",buttons:{left:"web"!==this.deviceUtils.platform()?this.navigationBarService.defaultBackButton():null}})},MenuDefaultCalendarsCtrl.prototype._fetchSuggestionSources=function(){return this.loading=!0,this.q.all([this.currentUserService.reload(),this.currentUserService.getRoute().all("suggestion_sources").getList()]).then(function(_this){return function(data){var userSourceSettings;return _this.user=data[0],userSourceSettings=_this.user.source_settings,_this.suggestionSources=_this.suggestionService.selectEnabledSources(data[1],userSourceSettings),_this.sources=_.values(_(_this.suggestionSources).sortBy(function(source){return source.name.toLowerCase()}).groupBy(function(source){return source.container_id}).value())}}(this),function(_this){return function(failure){return _this.log.error("fetching suggestion sources failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},MenuDefaultCalendarsCtrl.prototype.openAccountSettings=function(){return this.location.path("/settings/calendars")},MenuDefaultCalendarsCtrl.prototype.toggleSourceValue=function(type,source){return this.log.debug("attrs: ",type,source),this.sources[type][source].selected_by_default=!this.sources[type][source].selected_by_default,this.sources[type][source].saving=!0,this.suggestionService.updateSources(this.user,this.suggestionSources).then(function(_this){return function(data){return _this.log.debug("Updated source_settings successfully, got data:",data)}}(this),function(_this){return function(failure){return _this.log.debug("Failed updating source_settings",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.sources[type][source].saving=!1}}(this))},MenuDefaultCalendarsCtrl.prototype.setSourceValue=function(type,source){return this.log.debug("attrs: ",type,source,value),this.sources[type][source].selected_by_default=value,this.sources[type][source].saving=!0,this.suggestionService.updateSources(this.user,this.suggestionSources).then(function(_this){return function(data){return _this.log.debug("Updated source_settings successfully, got data:",data)}}(this),function(_this){return function(failure){return _this.log.debug("Failed updating source_settings",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.sources[type][source].saving=!1}}(this))},MenuDefaultCalendarsCtrl.prototype.handleError=function(){return this.reload()},MenuDefaultCalendarsCtrl.prototype.reload=function(){return this.error=null,this.delayedSpinner=!0,this._fetchSuggestionSources()},MenuDefaultCalendarsCtrl}(MenuBaseCtrl),MenuCalendarIntegrationCtrl=function(superClass){function MenuCalendarIntegrationCtrl(){MenuCalendarIntegrationCtrl.__super__.constructor.apply(this,arguments),this.loading=!0,this.connectCalendarButtonVisible=!0,this.emailSubmitted=this.currentUserService.getEmailSubmitted(),this.deviceId=this.deviceUtils.uuid(),this._fetchSuggestionSources(),this._setLayout()}return extend(MenuCalendarIntegrationCtrl,superClass),MenuCalendarIntegrationCtrl.prototype._setLayout=function(){return this.navigationBarService.show("Calendar integration"),this.navigationBarService.update({buttons:{left:"web"!==this.deviceUtils.platform()?this.navigationBarService.defaultBackButton():null}})},MenuCalendarIntegrationCtrl.prototype._fetchSuggestionSources=function(){return this.q.all([this.currentUserService.reload(),this.currentUserService.getRoute().all("suggestion_sources").getList()]).then(function(_this){return function(data){var groupedSources,lastUpdateEpoch;
return _this.user=data[0],_this.suggestionSources=data[1],_this.connectGoogleAccountButtonVisible=0===_this.user.google_connected,groupedSources=_.groupBy(_this.suggestionSources,function(source){return source.container_id}),_this.currentDeviceSource=groupedSources[_this.deviceId],null!=_this.currentDeviceSource?(_this.currentDeviceContainerName=_this.currentDeviceSource[0].container_name,_this.currentDeviceContainerId=_this.currentDeviceSource[0].container_id,delete groupedSources[_this.deviceId],_this.connectCalendarButtonVisible=!1,lastUpdateEpoch=_this.currentDeviceSource[0].last_update_epoch,_this.lastSyncOnCurrentDevice=_this._formatSyncTime(lastUpdateEpoch)):_this.connectCalendarButtonVisible=!0,_this.sources=_.values(groupedSources)}}(this),function(_this){return function(failure){return _this.log.error("fetching suggestion sources failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1,_this.btnWorking=null}}(this))},MenuCalendarIntegrationCtrl.prototype._disconnectDeviceCalendar=function(containerName,containerId,isCurrentDevice){return this.confirmDialog=null,this.btnWorking=containerName,this.suggestionService.disconnectDeviceCalendar(containerName,containerId,isCurrentDevice,this.deviceUtils.platform()).then(function(_this){return function(){var groupedSources;return _this.log.debug("Phone sources removed"),_.remove(_this.suggestionSources,{container_id:containerId}),groupedSources=_.groupBy(_this.suggestionSources,function(source){return source.container_id}),delete groupedSources[_this.deviceId],_this.sources=_.values(groupedSources),_this.suggestionService.updateSources(_this.user,_this.suggestionSources)}}(this),function(_this){return function(failure){return _this.log.debug("Phone source removal failed",failure)}}(this)).then(function(_this){return function(data){return _this.log.debug("Updated source_settings successfully, got data:",data)}}(this),function(_this){return function(failure){return _this.log.debug("Failed updating source_settings",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return isCurrentDevice&&(_this.connectCalendarButtonVisible=!0),_this.btnWorking=null}}(this))},MenuCalendarIntegrationCtrl.prototype._disconnectGoogleAccount=function(){return this.confirmDialog=null,this.btnWorking="Google Calendar",this.currentUserService.getRoute().one("service_accounts","google").post("disconnect").then(function(_this){return function(data){var groupedSources;return _this.log.debug("Google account disconnected",data),groupedSources=_.groupBy(_this.suggestionSources,function(source){return source.container_id}),delete groupedSources.google,_this.sources=_.values(groupedSources),_this.connectGoogleAccountButtonVisible=!0}}(this),function(_this){return function(failure){return _this.log.debug("Failed to disconnect Google account",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},MenuCalendarIntegrationCtrl.prototype._formatSyncTime=function(syncTime){var rightNowEpoch;return 0===syncTime?"Unknown":(rightNowEpoch=parseInt(moment().format("X")),moment.duration(syncTime-rightNowEpoch,"seconds").humanize(!0))},MenuCalendarIntegrationCtrl.prototype.confirmCalendarDisconnect=function(containerName,containerId,isCurrentDevice){var message;return message=isCurrentDevice?"Disconnect the calendar on this device from "+this.appConfig.appName+"?":"Disconnected devices can only be reconnected using that device.",this.confirmDialog={title:"Please confirm",message:message,buttonConfirmCallback:function(_this){return function(){return _this._disconnectDeviceCalendar(containerName,containerId,isCurrentDevice)}}(this),buttonConfirmCaption:"Disconnect",buttonCancelCallback:function(_this){return function(){return _this.confirmDialog=null}}(this),buttonCancelCaption:"Cancel"}},MenuCalendarIntegrationCtrl.prototype.confirmGoogleDisconnect=function(){var message;return message="You are about to disconnect your Google account. You will no longer be able to log in using it or see your events and contacts in Meetin.gs",this.confirmDialog={title:"Please confirm",message:message,buttonConfirmCallback:function(_this){return function(){return _this._disconnectGoogleAccount()}}(this),buttonConfirmCaption:"Disconnect",buttonCancelCallback:function(_this){return function(){return _this.confirmDialog=null}}(this),buttonCancelCaption:"Cancel"}},MenuCalendarIntegrationCtrl.prototype.connectGoogleAccount=function(){var redirectUrl,sessionString,state;return sessionString=this.stringUtils.generateRandomString(10),this.sessionService.setGoogleSignInSessionString(sessionString),redirectUrl=this.location.absUrl(),state={to:redirectUrl,session:sessionString},this.window.location=this.accountService.generateGoogleAuthUrl(state)},MenuCalendarIntegrationCtrl.prototype.connectOffice365Account=function(){return alert("Not implemented")},MenuCalendarIntegrationCtrl.prototype.initCalendarPlugin=function(){return this.calendarService.init().then(function(_this){return function(){return _this.log.debug("Calendar initialized!"),_this.calendarService.setPermissionAsked(!0)}}(this),function(_this){return function(failure){return _this.btnWorking=null,_this.log.error("Calendar connection failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},MenuCalendarIntegrationCtrl.prototype.syncCalendars=function(btnWorking){return this.btnWorking=btnWorking,this.initCalendarPlugin().then(function(_this){return function(){return _this.suggestionService.syncCalendars()}}(this)).then(function(_this){return function(data){return _this.log.debug("Calendars synced, fetch sources"),_this._fetchSuggestionSources(),data}}(this),function(_this){return function(failure){return _this.log.error("Connecting calendar failed",failure),_this.error=_this.errorHandlerService.handle(failure),failure}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},MenuCalendarIntegrationCtrl.prototype.connectDeviceCalendar=function(){return this.syncCalendars("connect").then(function(_this){return function(){return _this.log.debug("Connect succesful, update sources"),_this.suggestionService.updateSources(_this.user,_this.suggestionSources)}}(this)).then(function(_this){return function(data){return _this.log.debug("Updated source_settings successfully, got data:",data)}}(this),function(_this){return function(failure){return _this.log.debug("Failed updating source_settings",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},MenuCalendarIntegrationCtrl.prototype.removeSync=function(sources){var containerId,containerName,containerType;return containerType=sources[0].container_type,containerName=sources[0].container_name,containerId=sources[0].container_id,"phone"===containerType?this.confirmCalendarDisconnect(containerName,containerId,!1):"google"===containerType?this.confirmGoogleDisconnect():alert("Not implemented")},MenuCalendarIntegrationCtrl.prototype.getLastSync=function(containerId){var container,lastUpdateEpoch;return container=_.where(this.suggestionSources,{container_id:containerId})[0],lastUpdateEpoch=container.last_update_epoch,this._formatSyncTime(lastUpdateEpoch)},MenuCalendarIntegrationCtrl.prototype.handleError=function(){return this.reload()},MenuCalendarIntegrationCtrl.prototype.reload=function(){return this.error=null},MenuCalendarIntegrationCtrl}(MenuBaseCtrl),MenuRegionalSettingsCtrl=function(superClass){function MenuRegionalSettingsCtrl(){MenuRegionalSettingsCtrl.__super__.constructor.apply(this,arguments),this.timeFormatExample=moment().format(this.dateHelper.formatTimeDayDate),this._fetchUser(),this._setLayout()}return extend(MenuRegionalSettingsCtrl,superClass),MenuRegionalSettingsCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"Regional settings",buttons:{left:"web"!==this.deviceUtils.platform()?this.navigationBarService.defaultBackButton():null}})},MenuRegionalSettingsCtrl.prototype._fetchUser=function(){return this.loading=!0,this.currentUserService.reload().then(function(_this){return function(data){return _this.log.debug("User reloaded successfully",data),_this.user=data,_this.using24hTime="24h"===_this.user.time_display}}(this),function(_this){return function(failure){return _this.log.error("Reloading user failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},MenuRegionalSettingsCtrl.prototype._update=function(type){return this.saving=type,this.currentUserService.update(this.user).then(function(_this){return function(data){return _this.log.debug("saving setting succesful",data),_this.user=data,_this.using24hTime="24h"===_this.user.time_display,moment.locale(_this.user.time_display),_this.timeFormatExample=moment().format(_this.dateHelper.formatTimeDayDate)}}(this),function(_this){return function(failure){return _this.log.error("saving setting failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.saving=null}}(this))},MenuRegionalSettingsCtrl.prototype.toggle24hValue=function(){return this.user.time_display=this.using24hTime?"12h":"24h",this._update("timeDisplay")},MenuRegionalSettingsCtrl.prototype.set24hValue=function(value){return this.user.time_display=value,this._update("timeDisplay")},MenuRegionalSettingsCtrl.prototype.handleError=function(){return this.error=null,this._fetchUser()},MenuRegionalSettingsCtrl}(MenuBaseCtrl),menuApp=angular.module("menuApp",["appConfig","mtnUtils","mtnCheckbox","calendarModule","suggestionModule","accountModule","notifications","pushNotificationModule","mtnFloatLabel","mtnA","dateHelper"]),menuApp.controller("MenuIndexCtrl",MenuIndexCtrl),menuApp.controller("MenuNotificationSettingsCtrl",MenuNotificationSettingsCtrl),menuApp.controller("MenuNotificationCtrl",MenuNotificationCtrl),menuApp.controller("MenuDefaultCalendarsCtrl",MenuDefaultCalendarsCtrl),menuApp.controller("MenuCalendarIntegrationCtrl",MenuCalendarIntegrationCtrl),menuApp.controller("MenuRegionalSettingsCtrl",MenuRegionalSettingsCtrl);var NavigationCtrl,navigationApp;NavigationCtrl=function(){function NavigationCtrl(scope,rootScope,log,location,window,appConfig,deviceUtils,sessionService,currentUserService,notificationService,msgChannel,navigationBarService,deviceready){this.scope=scope,this.rootScope=rootScope,this.log=log,this.location=location,this.window=window,this.appConfig=appConfig,this.deviceUtils=deviceUtils,this.sessionService=sessionService,this.currentUserService=currentUserService,this.notificationService=notificationService,this.msgChannel=msgChannel,this.navigationBarService=navigationBarService,this.deviceready=deviceready,this.menuVisible=!0,this.leftButtonVisible=!1,this.rightButtonVisible=!1,this.platform=this.deviceUtils.platform(),this._initPathWatcher(),this._initUserWatcher(),this._initNotificationBadgeWatcher(),this._initNavigationBarWatchers(),this._initOffCanvas()}return NavigationCtrl.$inject=["$scope","$rootScope","$log","$location","$window","appConfig","deviceUtils","sessionService","currentUserService","notificationService","jsonMsgChannel","navigationBarService","deviceready"],NavigationCtrl.prototype._initPathWatcher=function(){return this.rootScope.$watch(function(_this){return function(){return _this.location.path()}}(this),function(_this){return function(path){return _this.activeTab=path.replace(/^(\/[^\/]*).*$/,"$1")}}(this))},NavigationCtrl.prototype._initUserWatcher=function(){return this.scope.$watch(function(_this){return function(){return _this.currentUserService.user}}(this),function(_this){return function(user){return _this.user=user}}(this))},NavigationCtrl.prototype._initNotificationBadgeWatcher=function(){return this.scope.$watch(function(_this){return function(){return _this.notificationService.badge}}(this),function(_this){return function(value){return _this.notificationBadge=value}}(this))},NavigationCtrl.prototype._initNavigationBarWatchers=function(){return this.scope.$watch(function(_this){return function(){return _this.navigationBarService.menuVisible}}(this),function(_this){return function(menuVisible){return null!=menuVisible?_this.menuVisible=menuVisible:void 0}}(this)),this.scope.$watch(function(_this){return function(){return _this.navigationBarService.navBarVisible}}(this),function(_this){return function(navBarVisible){return null!=navBarVisible?_this.navBarVisible=navBarVisible:void 0}}(this)),this.scope.$watch(function(_this){return function(){return _this.navigationBarService.rightButton}}(this),function(_this){return function(rightButton){return null!=rightButton?(_this.rightButtonVisible=!0,_this.rightButton=rightButton):_this.rightButtonVisible=!1}}(this)),this.scope.$watch(function(_this){return function(){return _this.navigationBarService.leftButton}}(this),function(_this){return function(leftButton){return null!=leftButton?(_this.leftButtonVisible=!0,_this.leftButton=leftButton):_this.leftButtonVisible=!1}}(this))},NavigationCtrl.prototype._initOffCanvas=function(){return $(document).foundation({offcanvas:{close_on_click:!0,open_method:"overlap"}}),$(document).on("open.fndtn.offcanvas","[data-offcanvas]",function(_this){return function(){var ref;return null==(null!=(ref=_this.window.history.state)?ref.menu:void 0)?_this.window.history.pushState({menu:"open"},null,null):void 0}}(this)),this.window.onpopstate=function(){return function(){return $(".off-canvas-wrap").foundation("offcanvas","hide","offcanvas-overlap")}}(this)},NavigationCtrl.prototype.toggleOffcanvas=function(){return $(".off-canvas-wrap").foundation("offcanvas","toggle","offcanvas-overlap"),!1},NavigationCtrl.prototype.closeNav=function(){return this.window.history.back()},NavigationCtrl.prototype.path=function(path){return this.toggleOffcanvas(),this.location.path(path)},NavigationCtrl.prototype.signOut=function(){return this.sessionService.signOut()},NavigationCtrl}(),navigationApp=angular.module("navigationApp",["appConfig","mtnFullHeight","mtnDisableScroll"]),navigationApp.controller("NavigationCtrl",NavigationCtrl);var NotificationBaseCtrl,NotificationCustomCtrl,NotificationIndexCtrl,notificationApp,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;NotificationBaseCtrl=function(){function NotificationBaseCtrl(scope,location,log,timeout,appConfig,SessionRestangular,sessionService,currentUserService,notificationService,errorHandlerService,meetingService,navigationBarService,viewParams,dateHelper,connectivity,jsonMsgChannel,deviceUtils){this.scope=scope,this.location=location,this.log=log,this.timeout=timeout,this.appConfig=appConfig,this.SessionRestangular=SessionRestangular,this.sessionService=sessionService,this.currentUserService=currentUserService,this.notificationService=notificationService,this.errorHandlerService=errorHandlerService,this.meetingService=meetingService,this.navigationBarService=navigationBarService,this.viewParams=viewParams,this.dateHelper=dateHelper,this.connectivity=connectivity,this.jsonMsgChannel=jsonMsgChannel,this.deviceUtils=deviceUtils,this.navigationBarService.showMenu()}return NotificationBaseCtrl.$inject=["$scope","$location","$log","$timeout","appConfig","SessionRestangular","sessionService","currentUserService","notificationService","errorHandlerService","meetingService","navigationBarService","viewParams","dateHelper","connectivity","jsonMsgChannel","deviceUtils"],NotificationBaseCtrl}(),NotificationIndexCtrl=function(superClass){function NotificationIndexCtrl(){this.open=bind(this.open,this),this._markNotificationsSeen=bind(this._markNotificationsSeen,this);var nid;NotificationIndexCtrl.__super__.constructor.apply(this,arguments),this._initNotificationWatcher(),nid=this.viewParams.get("fetchAndOpenNotification"),null!=nid?(this.viewParams.remove("fetchAndOpenNotification"),this._fetchAndOpen(nid,"push")):this._initNotifications(),this._initMessageListener(),this._setLayout()}return extend(NotificationIndexCtrl,superClass),NotificationIndexCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"Notifications"})},NotificationIndexCtrl.prototype._initMessageListener=function(){return this.scope.$on("$destroy",function(_this){return function(){return _this.log.debug("[notification] destroyed, unsubscribing MsgChannel"),_this.jsonMsgChannel.unsubscribe(_this.msgChannel)}}(this)),this.msgChannel=this.jsonMsgChannel.subscribe(function(_this){return function(data){return _this.log.debug("[notification] received postmessage: ",null!=data?data.event:void 0,data),"openNotification"===(null!=data?data.event:void 0)?_this._fetchAndOpen(data.notification.additionalData.nid,"push"):void 0}}(this))},NotificationIndexCtrl.prototype._markNotificationsSeen=function(){return this.log.debug("[badges] Reset tab and app badges regardless of whether the API call is performed"),this.notificationService.resetBadges(),this.notificationService.hasUnseenNotifications(this.notifications)?this.notificationService.markAllSeen(this.notifications).then(function(_this){return function(data){return _this.log.debug("All notifications marked as seen",data)}}(this),function(_this){return function(failure){return _this.log.debug("Failed marking all notifications as seen (non-important, not displaying error)",failure)}}(this)):void 0},NotificationIndexCtrl.prototype._initNotificationWatcher=function(){return this.scope.$watch(function(_this){return function(){return _this.notificationService.notifications}}(this),function(_this){return function(notifications){return _this.notifications=notifications,"visible"!==document.visibilityState||document.hidden?void 0:_this._markNotificationsSeen()}}(this))},NotificationIndexCtrl.prototype._initNotifications=function(){return this.notificationService.notifications=this.notificationService.getCache(),null==this.notificationService.notifications?(this.loading=!0,this._fetchAll()):this.timeout(function(_this){return function(){return _this._fetchAll()}}(this),1e3)},NotificationIndexCtrl.prototype._fetchAll=function(){return this.notificationService.fetchAll().then(function(_this){return function(){return _this.log.debug("[notifications] notifications fetched successfully")}}(this),function(_this){return function(failure){return _this.log.error("[notifications] fetching failed",failure),_this.connectivity.isOnline()||null==_this.notificationService.notifications?_this.error=_this.errorHandlerService.handle(failure):void 0}}(this))["finally"](function(_this){return function(){return _this.loading=!1,_this.jsonMsgChannel.publishTo("PullToRefresh",JSON.stringify({event:"didFecthAll"}))}}(this))},NotificationIndexCtrl.prototype._fetchAndOpen=function(nid,utmSource){return this.loading=!0,this.notificationService.fetchNotification(nid).then(function(_this){return function(data){return _this.log.debug("[notification] received:",{data:data}),_this._markNotificationsSeen(),_this.open(data,utmSource),_this._fetchAll()}}(this),function(_this){return function(failure){return _this.log.error("[notification] fetching failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},NotificationIndexCtrl.prototype._openMaterial=function(notification){var breadcrumb,parentMeeting;return parentMeeting=notification.meeting,breadcrumb=encodeURIComponent(notification.meeting.title_value),this.viewParams.set({breadcrumb:breadcrumb,breadcrumbClickable:!0}),this.location.path("/notifications/meeting/"+parentMeeting.id+"/material/"+notification.material.id)},NotificationIndexCtrl.prototype._openSwipeToMeet=function(notification,utmSource){return this.viewParams.set({menuVisible:!0}),this.location.search("utm_source",utmSource).path("/notifications/meeting/"+notification.meeting_id+"/scheduling/"+notification.scheduling_id)},NotificationIndexCtrl.prototype._openSchedulingProgress=function(notification){return this.location.path("/notifications/meeting/"+notification.meeting_id+"/scheduling/"+notification.scheduling_id+"/log")},NotificationIndexCtrl.prototype._openMeeting=function(meeting){return this.meetingService.setMeeting(meeting),this.location.path("/notifications/meeting/"+meeting.id)},NotificationIndexCtrl.prototype._openCustomNotification=function(notification){return this.viewParams.set({notification:notification}),this.location.path("/notifications/"+notification.id)},NotificationIndexCtrl.prototype._updateNotification=function(replacement){var index;return index=_.findIndex(this.notifications,function(original){return original.id===replacement.id}),-1!==index?(this.notifications[index].is_seen=replacement.is_seen,this.notifications[index].is_read=replacement.is_read):void 0},NotificationIndexCtrl.prototype.handleError=function(){return this.reload()},NotificationIndexCtrl.prototype.reload=function(){return this.error=null,this.connectivity.isOnline()?this._initNotifications():void 0},NotificationIndexCtrl.prototype.ptrCallback=function(){return this._fetchAll()},NotificationIndexCtrl.prototype.open=function(notification,utmSource){switch(null==utmSource&&(utmSource="web"===this.deviceUtils.platform()?"web":"app"),notification.action_type){case"material":this._openMaterial(notification.data);break;case"scheduling_landing":this._openSwipeToMeet(notification.data,utmSource);break;case"scheduling_log":this._openSchedulingProgress(notification.data);break;case"meeting":this._openMeeting(notification.data.meeting);break;default:this._openCustomNotification(notification)}return this.notificationService.markRead(notification).then(function(_this){return function(data){return _this.log.debug("Notification marked as read",data),_this._updateNotification(data)}}(this),function(_this){return function(failure){return _this.log.debug("Failed marking notification as read (non-important, not displaying error)",failure)}}(this))},NotificationIndexCtrl}(NotificationBaseCtrl),NotificationCustomCtrl=function(superClass){function NotificationCustomCtrl(){NotificationCustomCtrl.__super__.constructor.apply(this,arguments),this.notificationId=this.viewParams.get("notificationId"),this.notification=this.viewParams.get("notification"),null==this.notification&&this._fetchNotification(this.notificationId),this._setLayout()}return extend(NotificationCustomCtrl,superClass),NotificationCustomCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"Notification",buttons:{left:"web"!==this.deviceUtils.platform()?this.navigationBarService.defaultBackButton():null}})},NotificationCustomCtrl.prototype._fetchNotification=function(nid){return this.loading=!0,this.notificationService.fetchNotification(nid).then(function(_this){return function(data){return _this.log.debug("[notification] received:",{data:data}),_this.notification=data}}(this),function(_this){return function(failure){return _this.log.error("[notification] fetching failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},NotificationCustomCtrl}(NotificationBaseCtrl),notificationApp=angular.module("notificationApp",["appConfig","currentUserModule","notifications","meetingModule","mtnHideParent","dateHelper","react","notificationComponents","connectivity","mtnUtils"]),notificationApp.controller("NotificationIndexCtrl",NotificationIndexCtrl),notificationApp.controller("NotificationCustomCtrl",NotificationCustomCtrl);var ParticipantBaseCtrl,ParticipantIndexCtrl,ParticipantNewCtrl,ParticipantShowCtrl,participantApp,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;participantApp=angular.module("participantApp",["sessionModule"]),ParticipantBaseCtrl=function(){function ParticipantBaseCtrl(scope,rootScope,log,q,location,window,timeout,appConfig,SessionRestangular,sessionService,errorHandlerService,participantService,navigationBarService,schedulingLogService,meetingService,dateHelper,breadcrumb1,differenceFilter,viewParams,pusherService,deviceUtils,contactService,currentUserService){this.scope=scope,this.rootScope=rootScope,this.log=log,this.q=q,this.location=location,this.window=window,this.timeout=timeout,this.appConfig=appConfig,this.SessionRestangular=SessionRestangular,this.sessionService=sessionService,this.errorHandlerService=errorHandlerService,this.participantService=participantService,this.navigationBarService=navigationBarService,this.schedulingLogService=schedulingLogService,this.meetingService=meetingService,this.dateHelper=dateHelper,this.breadcrumb=breadcrumb1,this.differenceFilter=differenceFilter,this.viewParams=viewParams,this.pusherService=pusherService,this.deviceUtils=deviceUtils,this.contactService=contactService,this.currentUserService=currentUserService,this.tab=this.viewParams.get("tab"),this.breadcrumb.set(this.viewParams.get("breadcrumb"),this.viewParams.get("breadcrumbClickable")),this.overrideBackButton=this.viewParams.get("overrideBackButton"),this.meetingId=this.viewParams.get("meetingId")}return ParticipantBaseCtrl.$inject=["$scope","$rootScope","$log","$q","$location","$window","$timeout","appConfig","SessionRestangular","sessionService","errorHandlerService","participantService","navigationBarService","schedulingLogService","meetingService","dateHelper","breadcrumb","differenceFilter","viewParams","pusherService","deviceUtils","contactService","currentUserService"],ParticipantBaseCtrl.prototype._isUpcoming=function(meeting){return this.dateHelper.isEpochInFuture(meeting.begin_epoch)},ParticipantBaseCtrl.prototype._isManager=function(participants){var participant,userId;return userId=this.sessionService.getUserId(),participant=this.participantService.getParticipant(userId,participants),this.participantService.isManager(participant)},ParticipantBaseCtrl.prototype._fetchMeeting=function(){return this.meetingService.fetchMeeting(this.meetingId).then(function(_this){return function(data){return _this._setMeeting(data),data}}(this),function(_this){return function(failure){return _this.log.error("Fetching meeting failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},ParticipantBaseCtrl.prototype._setMeeting=function(meeting){return this.meeting=meeting,this.isUpcoming=this._isUpcoming(meeting),this.isDraft=1===meeting.is_draft,this.schedulingId=meeting.current_scheduling_id,this.isSchedulingActive=null!=this.schedulingId&&0!==this.schedulingId},ParticipantBaseCtrl.prototype._resetError=function(){return this.error=null},ParticipantBaseCtrl.prototype.toggleRsvpRequired=function(){return this.rsvpRequired=!this.rsvpRequired},ParticipantBaseCtrl.prototype.setRsvpRequired=function(rsvpRequired){return this.rsvpRequired=rsvpRequired},ParticipantBaseCtrl}(),ParticipantIndexCtrl=function(superClass){function ParticipantIndexCtrl(){ParticipantIndexCtrl.__super__.constructor.apply(this,arguments),this._init(),this._setLayout()}return extend(ParticipantIndexCtrl,superClass),ParticipantIndexCtrl.prototype._setLayout=function(){var addButton;return addButton={imagePath:"images/add@2x.png",onClick:function(_this){return function(){return _this._openNewPartcipant()}}(this)},this.navigationBarService.update({title:"Participants",buttons:{left:"web"!==this.deviceUtils.platform()?this.navigationBarService.defaultBackButton():null,right:addButton}})},ParticipantIndexCtrl.prototype._openNewPartcipant=function(){var breadcrumb;return breadcrumb=encodeURIComponent(this.breadcrumb.title),this.viewParams.set({breadcrumb:breadcrumb}),this.location.path("/"+this.tab+"/meeting/"+this.meetingId+"/participants/add")},ParticipantIndexCtrl.prototype._init=function(){var initPromises;return this.loading=!0,this.participants=[],this.removedParticipants=[],this.setSelectedIndex(null),initPromises=[this._fetchParticipantList(),this._fetchMeeting()],this.q.all(initPromises).then(function(_this){return function(data){return _this.participants=data[0],_this.sendInvitationsVisible=_this.participants.length>1&&_this.isDraft,_this.isManager=_this._isManager(_this.participants)}}(this),function(_this){return function(failure){return _this.log.error("Failed loading participants",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},ParticipantIndexCtrl.prototype._fetchParticipantList=function(){return this.participantService.fetchParticipantList(this.meetingId,{image_size:this.appConfig.thumbnail.medium})},ParticipantIndexCtrl.prototype._sendInvitations=function(requireRsvp){return this.confirmDialog=null,this.btnWorking="sendInvitations",this.participantService.sendInvitationsToDraftParticipants(this.meetingId,{require_rsvp:requireRsvp}).then(function(_this){return function(data){return _this.log.debug("Draft participants invited successfully",data),_this.meeting.is_draft=0,_this.meetingService.setMeeting(_this.meeting),_this.window.history.back()}}(this),function(_this){return function(failure){return _this.log.error("Failed to send invites",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},ParticipantIndexCtrl.prototype.openParticipant=function(participantId){var breadcrumb;return breadcrumb=encodeURIComponent(this.breadcrumb.title),this.viewParams.set({breadcrumb:breadcrumb,overrideBackButton:this.overrideBackButton}),this.location.path("/"+this.tab+"/meeting/"+this.meetingId+"/participants/"+participantId)},ParticipantIndexCtrl.prototype.sendInvitations=function(){return this.isUpcoming?this.confirmDialog={title:"Require rsvp?",message:"Do you wish to request rsvp from participants?",buttonConfirmCallback:function(_this){return function(){return _this._sendInvitations(!0)}}(this),buttonConfirmCaption:"Yes",buttonCancelCallback:function(_this){return function(){return _this._sendInvitations(!1)}}(this),buttonCancelCaption:"No"}:this._sendInvitations(!1)},ParticipantIndexCtrl.prototype.handleError=function(){return this.reload()},ParticipantIndexCtrl.prototype.reload=function(){return this._resetError(),this._init()},ParticipantIndexCtrl.prototype.removeParticipant=function(participant){return this.removedParticipants.push(participant),this.participants=this.differenceFilter(this.participants,this.removedParticipants),this.sendInvitationsVisible=this.participants.length>1&&this.isDraft,this.participantService.removeParticipant(participant.id).then(function(_this){return function(data){return _this.log.debug("Participant removed successfully",data),_this.setSelectedIndex(null),_this.sendInvitationsVisible=_this.participants.length>1&&_this.isDraft}}(this),function(_this){return function(failure){return _this.log.error("Participant remove failed",failure),_this.error=_this.errorHandlerService.handle(failure),_this.removedParticipants.pop(),_this.participants=_this.differenceFilter(_this.participants,_this.removedParticipants),_this.sendInvitationsVisible=_this.participants.length>1&&_this.isDraft}}(this))},ParticipantIndexCtrl.prototype.removeParticipantEnabled=function(){return this.isManager},ParticipantIndexCtrl.prototype.removeParticipantAllowed=function(participant){return participant.user_id!==this.sessionService.getUserId()
},ParticipantIndexCtrl.prototype.setSelectedIndex=function(index){return this.selectedIndex=index},ParticipantIndexCtrl}(ParticipantBaseCtrl),ParticipantShowCtrl=function(superClass){function ParticipantShowCtrl(){ParticipantShowCtrl.__super__.constructor.apply(this,arguments),this.participantId=this.viewParams.get("participantId"),this.schedulingId=this.viewParams.get("schedulingId"),this.fullLog=!1,this.logData=[],this._init(),this._setLayout()}return extend(ParticipantShowCtrl,superClass),ParticipantShowCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"Participant",buttons:{left:"web"!==this.deviceUtils.platform()?this.navigationBarService.defaultBackButton():null}})},ParticipantShowCtrl.prototype._initPusher=function(){var channelName,pusherNewLogEntryCallback;return channelName=this.appConfig.pusher.channelName+this.sessionService.getUserId(),pusherNewLogEntryCallback=function(_this){return function(data){return parseInt(data.scheduling_id)===parseInt(_this.schedulingId)&&(0===_this.logData.length||data.entry_id>=_(_this.logData).pluck("id").last())?_this.scope.$apply(function(){return _this._fetchSchedulingLogWithMinEpoch()}):void 0}}(this),this.pusherService.subscribeAndBind(channelName,"new_scheduling_log_entries",pusherNewLogEntryCallback),this.scope.$on("$destroy",function(_this){return function(){return _this.pusherService.unbind(channelName,"new_scheduling_log_entries",pusherNewLogEntryCallback)}}(this))},ParticipantShowCtrl.prototype._init=function(){var initPromises;return this.loading=!0,initPromises=[this._fetchParticipant(),this._fetchMeeting()],this.q.all(initPromises).then(function(_this){return function(data){return _this.log.debug("[Participant] Fetching participant success",data),_this.participant=data[0],_this.schedulingEnabled=0===_this.participant.scheduling_disabled,_this.isParticipantCurrentUser=_this.participant.user_id===_this.sessionService.getUserId(),_this.isParticipantManager=_this.participantService.isManager(_this.participant),_this.isManager=_this._isManager(_this.meeting.participants),_this.isSchedulingActive?(_this._initPusher(),_this._fetchSchedulingLog()):void 0}}(this),function(_this){return function(failure){return _this.log.error("[Participant] Fetching participant failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},ParticipantShowCtrl.prototype._fetchParticipant=function(){return this.participantService.fetchParticipant(this.participantId,{image_size:this.appConfig.thumbnail.large})},ParticipantShowCtrl.prototype._fetchSchedulingLogWithMinEpoch=function(){var latestCreatedEpoch;return latestCreatedEpoch=_(this.logData).pluck("created_epoch").max(),this._fetchSchedulingLog({min_created_epoch:latestCreatedEpoch-10})},ParticipantShowCtrl.prototype._fetchSchedulingLog=function(params){return params=params||{},params.image_size=this.appConfig.thumbnail.medium,this.schedulingLogService.fetchAll(this.meetingId,this.schedulingId,params).then(function(_this){return function(data){return _this.logData=_this.logData.concat(data),_this.logData=_.uniq(_this.logData,"id"),_this._handleLogEvents(_this.logData)}}(this),function(_this){return function(failure){return _this.log.error("Failed to load meeting",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},ParticipantShowCtrl.prototype._handleLogEvents=function(logData){var logMessages;return logMessages=_.filter(logData,function(_this){return function(entry){return"user_state_changed"!==entry.entry_type&&"instruction_changed"!==entry.entry_type&&(entry.data.user_id===_this.participant.user_id||entry.author_id===_this.participant.user_id)}}(this)),this.eventLog=this.schedulingLogService.formatLogMessages(logMessages)},ParticipantShowCtrl.prototype._enableScheduling=function(){return this.btnWorking="enableScheduling",this.participant.scheduling_disabled=0,this.schedulingEnabled=!0,this.participantService.enableScheduling(this.participant).then(function(_this){return function(data){return _this.log.debug("Participant added to scheduling",data)}}(this),function(_this){return function(failure){return _this.log.error("Failed to add participant to scheduling",failure),_this.error=_this.errorHandlerService.handle(failure),_this.participant.scheduling_disabled=1,_this.schedulingEnabled=!1}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},ParticipantShowCtrl.prototype.toggleLogSize=function(){return this.fullLog=!this.fullLog},ParticipantShowCtrl.prototype.resendSchedulingInvitation=function(){return this.btnWorking="resendingInvitation",this.participantService.resendSchedulingInvitation(this.participant).then(function(_this){return function(data){return _this.log.debug("Invitation sent successfully",data),_this.invitationSent=!0}}(this),function(_this){return function(failure){return _this.log.error("Resending invitation failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},ParticipantShowCtrl.prototype.disableScheduling=function(){return this.btnWorking="disableScheduling",this.participant.scheduling_disabled=1,this.schedulingEnabled=!1,this.participantService.disableScheduling(this.participant).then(function(_this){return function(data){return _this.log.debug("Participant removed from scheduling",data),_this.participant.scheduling_disabled_by_user_id=_this.sessionService.getUserId()}}(this),function(_this){return function(failure){return _this.log.error("Failed to remove participant from scheduling",failure),_this.error=_this.errorHandlerService.handle(failure),_this.participant.scheduling_disabled=0,_this.schedulingEnabled=!0}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},ParticipantShowCtrl.prototype.enableScheduling=function(){return this.participant.scheduling_disabled_by_user_id===this.sessionService.getUserId()?void this._enableScheduling():this.confirmDialog={title:"Are you sure?",message:this.participant.name+" decided not to participate in this scheduling. Are you sure you want to reactivate the scheduling for "+this.participant.name+"?",buttonConfirmCallback:function(_this){return function(){return _this._enableScheduling(),_this.confirmDialog=null}}(this),buttonConfirmCaption:"Activate",buttonCancelCallback:function(_this){return function(){return _this.schedulingEnabled=!1,_this.confirmDialog=null}}(this),buttonCancelCaption:"Cancel"}},ParticipantShowCtrl.prototype.removeParticipant=function(){return this.btnWorking="removingParticipant",this.participantService.removeParticipant(this.participant.id).then(function(_this){return function(data){return _this.log.debug("Participant removed successfully",data),_this.window.history.back()}}(this),function(_this){return function(failure){return _this.log.error("Participant remove failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},ParticipantShowCtrl.prototype.toggleSchedulingEnabled=function(){return this.schedulingEnabled?this.disableScheduling():this.enableScheduling()},ParticipantShowCtrl.prototype.setSchedulingEnabled=function(){return this.schedulingEnabled?this.disableScheduling():this.enableScheduling()},ParticipantShowCtrl.prototype.handleError=function(){return this.reload()},ParticipantShowCtrl.prototype.reload=function(){return this._resetError(),this._init()},ParticipantShowCtrl}(ParticipantBaseCtrl),ParticipantNewCtrl=function(superClass){function ParticipantNewCtrl(){ParticipantNewCtrl.__super__.constructor.apply(this,arguments),this.contactPermissionTextVisible=!this.contactService.getPermissionAsked(),this.participants=[],this.user=this.currentUserService.get(),this.userCountryId=this.currentUserService.getUserPhoneCountryId(this.user),this.delayedSpinner=!1,this._fetchMeeting(),this._getLatestContacts(),this._initParticipantListWatcher(),this._setLayout()}return extend(ParticipantNewCtrl,superClass),ParticipantNewCtrl.prototype._setLayout=function(){var saveButton;return saveButton={title:"Done",disabled:!this.participants.length,onClick:function(_this){return function(){return _this.addParticipants()}}(this)},this.navigationBarService.update({title:"Invite",buttons:{left:"web"!==this.deviceUtils.platform()?this.navigationBarService.defaultBackButton():null,right:saveButton}})},ParticipantNewCtrl.prototype._initParticipantListWatcher=function(){return this.scope.$watch(function(_this){return function(){return _this.participants}}(this),function(_this){return function(){return _this._participantListChanged()}}(this),!0)},ParticipantNewCtrl.prototype._addParticipants=function(requireRsvp){var addParticipantPromises;return this.loading=!0,addParticipantPromises=[],_.each(this.participants,function(_this){return function(participant){return participant.require_rsvp=requireRsvp,addParticipantPromises.push(_this.participantService.addParticipant(_this.meetingId,participant))}}(this)),this.q.all(addParticipantPromises).then(function(_this){return function(data){return _this.log.debug("Participants added successfully",data),_this._saveLatestContacts(),_this.window.history.back()}}(this),function(_this){return function(failure){return _this.log.error("Participant adding failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},ParticipantNewCtrl.prototype._participantListChanged=function(){return this._setLayout()},ParticipantNewCtrl.prototype._saveLatestContacts=function(){return this.contactService.setLatestContactsForUser(this.user.id,this.participants)},ParticipantNewCtrl.prototype._getLatestContacts=function(){var ref;return this.latestContacts=null!=(ref=this.contactService.getLatestContacts())?ref[this.user.id]:void 0},ParticipantNewCtrl.prototype.onAddParticipant=function(participant,type){var validatedParticipant;return this.log.debug(type+" participant added",participant),validatedParticipant=this.contactService.isValidParticipant(this.meeting.participants,participant,type,this.user,this.userCountryId),null!=(null!=validatedParticipant?validatedParticipant.existingParticipant:void 0)?this.error=this.errorHandlerService.handleAppError(this.errorHandlerService.PHONENUMBER_EXISTS):null!=(null!=validatedParticipant?validatedParticipant.error:void 0)?this.error=validatedParticipant.error:(this.meeting.participants.push(participant),this.participants.push(participant))},ParticipantNewCtrl.prototype.onRemoveParticipant=function(participant){return this.log.debug("participant removed",participant),_.remove(this.meeting.participants,participant),_.remove(this.participants,participant)},ParticipantNewCtrl.prototype.initContactPlugin=function(){return this.contactService.init().then(function(_this){return function(){return _this.contactService.setPermissionAsked(!0),_this.contactPermissionTextVisible=!1,_this._setLayout()}}(this),function(_this){return function(failure){return _this.log.error("Failed to initialize contact plugin",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},ParticipantNewCtrl.prototype.addParticipants=function(){return 0===this.participants.length?void(this.error=this.errorHandlerService.handleAppError(this.errorHandlerService.EMPTY_CONTACT_LIST)):this.isDraft||this.isSchedulingActive?this._addParticipants(!1):this.confirmDialog={title:"Require rsvp?",message:"Do you wish to request rsvp from participants?",buttonConfirmCallback:function(_this){return function(){return _this._addParticipants(!0)}}(this),buttonConfirmCaption:"Yes",buttonCancelCallback:function(_this){return function(){return _this._addParticipants(!1)}}(this),buttonCancelCaption:"No"}},ParticipantNewCtrl.prototype.handleError=function(){return this.error=null},ParticipantNewCtrl}(ParticipantBaseCtrl),participantApp=angular.module("participantApp",["appConfig","ngAnimate","partials","participantModule","schedulingLogModule","meetingModule","mtnFloatLabel","mtnCheckbox","nativeUi","ngTagsInput","mtnSwipeToReveal","mtnListFilters","mtnA","pusherModule","mtnUtils","mtnContactPicker","contactModule","currentUserModule"]),participantApp.controller("ParticipantIndexCtrl",ParticipantIndexCtrl),participantApp.controller("ParticipantShowCtrl",ParticipantShowCtrl),participantApp.controller("ParticipantNewCtrl",ParticipantNewCtrl);var ProfileBaseCtrl,ProfileEditCtrl,profileApp,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;ProfileBaseCtrl=function(){function ProfileBaseCtrl(scope,rootScope,location,window,log,appConfig,SessionRestangular,sessionService,currentUserService,errorHandlerService,materialService,navigationBarService,uncacheableUrl,deviceUtils){this.scope=scope,this.rootScope=rootScope,this.location=location,this.window=window,this.log=log,this.appConfig=appConfig,this.SessionRestangular=SessionRestangular,this.sessionService=sessionService,this.currentUserService=currentUserService,this.errorHandlerService=errorHandlerService,this.materialService=materialService,this.navigationBarService=navigationBarService,this.uncacheableUrl=uncacheableUrl,this.deviceUtils=deviceUtils,this.isDevelopmentMode=this.appConfig.isDevelopmentMode}return ProfileBaseCtrl.$inject=["$scope","$rootScope","$location","$window","$log","appConfig","SessionRestangular","sessionService","currentUserService","errorHandlerService","materialService","navigationBarService","uncacheableUrl","deviceUtils"],ProfileBaseCtrl}(),ProfileEditCtrl=function(superClass){function ProfileEditCtrl(){ProfileEditCtrl.__super__.constructor.apply(this,arguments),this._setLayout(),this._reloadUser()}return extend(ProfileEditCtrl,superClass),ProfileEditCtrl.prototype._setLayout=function(){var cancelButton,saveButton;return this.navigationBarService.show("Profile"),cancelButton={title:"Cancel",onClick:function(_this){return function(){return _this.cancelEdit()}}(this)},saveButton={title:"Done",onClick:function(_this){return function(){return _this.rootScope.$broadcast("blurInput"),_this.update()}}(this)},this.navigationBarService.update({buttons:{left:"web"!==this.deviceUtils.platform()?cancelButton:null,right:"ios"===this.deviceUtils.platform()?saveButton:null}})},ProfileEditCtrl.prototype._reloadUser=function(){return this.loading=!0,this.delayedSpinner=!0,this.currentUserService.reload({image_size:this.appConfig.thumbnail.large}).then(function(_this){return function(user){return _this.user=user,_this.profileImageUrl=_this.uncacheableUrl(user.image)}}(this),function(_this){return function(failure){return _this.log.error("Failed to load user data"),_this.reloadRequired=!0,_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},ProfileEditCtrl.prototype.cancelEdit=function(){return this.rootScope.$broadcast("blurInput"),this.window.history.back()},ProfileEditCtrl.prototype.update=function(){return this.scope.edit.profile.$valid?(this.loading=!0,this.delayedSpinner=!1,this.currentUserService.update(this.user).then(function(_this){return function(data){return _this.log.debug("Updated user success, got data:",data),_this.window.history.back()}}(this),function(_this){return function(failure){return _this.log.debug("Failed updating user",failure),_this.reloadRequired=!1,_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))):void(this.error=this.errorHandlerService.handleAppError(this.errorHandlerService.INVALID_LINKEDIN_URL))},ProfileEditCtrl.prototype.addPhoto=function(){return null==this.uploadProgress&&"web"!==this.deviceUtils.platform()?this.materialService.addPhoto(this.appConfig.thumbnail.large).then(function(_this){return function(data){return _this.log.debug("Profile picture successfully uploaded"),_this.user.upload_id=data.result.upload_id,_this.profileImageUrl=_this.uncacheableUrl(data.result.upload_thumbnail_url)}}(this),function(_this){return function(failure){return _this.log.error("Failed to upload profile picture",failure),_this.reloadRequired=!1,_this.error=_this.errorHandlerService.handle(failure)}}(this),function(_this){return function(progress){return _this.uploadProgress=progress}}(this))["finally"](function(_this){return function(){return _this.uploadProgress=null}}(this)):void 0},ProfileEditCtrl.prototype.removePhoto=function(){return this.user.upload_id=-1,this.update()},ProfileEditCtrl.prototype.handleError=function(){return this.error=null,this.reloadRequired?this._reloadUser():void 0},ProfileEditCtrl}(ProfileBaseCtrl),profileApp=angular.module("profileApp",["appConfig","nativeUi","currentUserModule","mtnProgress","mtnFloatLabel","mtnUtils"]),profileApp.controller("ProfileEditCtrl",ProfileEditCtrl);var SchedulingBaseCtrl,SchedulingDurationCtrl,SchedulingEditDurationCtrl,SchedulingEditLocationCtrl,SchedulingEditSourcesCtrl,SchedulingEditTimeCtrl,SchedulingEditTimespanCtrl,SchedulingIndexCtrl,SchedulingLocationCtrl,SchedulingLogCtrl,SchedulingParticipantsCtrl,SchedulingReviewCtrl,SchedulingStartCtrl,SchedulingTimeCtrl,schedulingApp,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;SchedulingBaseCtrl=function(){function SchedulingBaseCtrl(scope,rootScope,window,log,location,q,filter,http,timeout,appConfig,errorHandlerService,SessionRestangular,sessionService,schedulingService,matchmakerService,meetingService,currentUserService,participantService,suggestionService,contactService,schedulingLogService,navigationBarService,pusherService,dateHelper,viewParams,splashscreen,cssClassUtils,deviceUtils,connectivity){this.scope=scope,this.rootScope=rootScope,this.window=window,this.log=log,this.location=location,this.q=q,this.filter=filter,this.http=http,this.timeout=timeout,this.appConfig=appConfig,this.errorHandlerService=errorHandlerService,this.SessionRestangular=SessionRestangular,this.sessionService=sessionService,this.schedulingService=schedulingService,this.matchmakerService=matchmakerService,this.meetingService=meetingService,this.currentUserService=currentUserService,this.participantService=participantService,this.suggestionService=suggestionService,this.contactService=contactService,this.schedulingLogService=schedulingLogService,this.navigationBarService=navigationBarService,this.pusherService=pusherService,this.dateHelper=dateHelper,this.viewParams=viewParams,this.splashscreen=splashscreen,this.cssClassUtils=cssClassUtils,this.deviceUtils=deviceUtils,this.connectivity=connectivity,this.splashscreen.hide(),this.tab=this.viewParams.get("tab")||"scheduling",this.isDeveloperMenuVisible=this.appConfig.isDevelopmentMode,this.participantMaxCountBeforeSummary=this.appConfig.meeting.participants.maxCountBeforeSummary,this.s2m=this.schedulingService.getScheduling(),this.meeting=this.meetingService.getMeeting(),this._setPristine(),_.isEmpty(this.s2m)&&null==this.meeting.id&&"/scheduling"!==this.location.path()&&this.location.path("/scheduling"),(null==this.s2m.participants||0===this.s2m.participants.length)&&(this.log.debug("cloning participants"),this.s2m.participants=angular.copy(this.meeting.participants))}return SchedulingBaseCtrl.$inject=["$scope","$rootScope","$window","$log","$location","$q","$filter","$http","$timeout","appConfig","errorHandlerService","SessionRestangular","sessionService","schedulingService","matchmakerService","meetingService","currentUserService","participantService","suggestionService","contactService","schedulingLogService","navigationBarService","pusherService","dateHelper","viewParams","splashscreen","cssClassUtils","deviceUtils","connectivity"],SchedulingBaseCtrl.prototype._path=function(path){return this.meetingService.setMeeting(this.meeting),this.schedulingService.setScheduling(this.s2m),this.location.path(path)},SchedulingBaseCtrl.prototype._back=function(){return this.meetingService.setMeeting(this.meeting),this.schedulingService.setScheduling(this.s2m),this.window.history.back()},SchedulingBaseCtrl.prototype._cancel=function(){return this._revert(),this.window.history.back()},SchedulingBaseCtrl.prototype._setPristine=function(){return this.s2mPristine=angular.copy(this.s2m),this.meetingPristine=angular.copy(this.meeting)},SchedulingBaseCtrl.prototype._revert=function(){return this.schedulingService.setScheduling(this.s2mPristine),this.meetingService.setMeeting(this.meetingPristine),this.s2mPristine=null,this.meetingPristine=null},SchedulingBaseCtrl.prototype._resetS2m=function(){return this.s2m={},this.schedulingService.setScheduling(this.s2m)},SchedulingBaseCtrl.prototype._resetMeeting=function(){return this.meeting=this.meetingService.getEmptyMeeting(),this.meetingService.setMeeting(this.meeting)},SchedulingBaseCtrl.prototype._setLayoutButtons=function(doneCallback){return{closeButton:{title:"Back",onClick:function(_this){return function(){return _this.rootScope.$broadcast("blurInput"),_this._cancel()}}(this)},doneButton:{title:this.viewParams.get("fromReview")?"Done":"Next",onClick:function(_this){return function(){return _this.rootScope.$broadcast("blurInput"),doneCallback()}}(this)}}},SchedulingBaseCtrl.prototype._fetchLunchScheduler=function(){return this.matchmakerService.fetchLunchScheduler()},SchedulingBaseCtrl.prototype._fetchMatchmakers=function(){return this.matchmakerService.fetchMatchmakers()},SchedulingBaseCtrl.prototype._getUser=function(){return this.currentUserService.get()},SchedulingBaseCtrl.prototype._fetchMeeting=function(){return this.meetingService.fetchMeeting(this.meeting.id,{image_size:this.appConfig.thumbnail.small})},SchedulingBaseCtrl.prototype._fetchSuggestionSources=function(){return this.currentUserService.getRoute().all("suggestion_sources").getList()},SchedulingBaseCtrl.prototype._setEnabledSuggestionSources=function(sourceSettings){var enabledSources;return enabledSources=this.suggestionService.selectEnabledSources(this.s2m.suggestionSources,sourceSettings),this.s2m.sources=_.values(_(enabledSources).sortBy(function(source){return source.name.toLowerCase()}).groupBy(function(source){return source.container_id}).value()),this.s2m.scheduling.source_settings=this.suggestionService.enableSelectedSources(enabledSources),this._setCalendarCounts(enabledSources)},SchedulingBaseCtrl.prototype._setCalendarCounts=function(enabledSources){return this.s2m.enabledCalendarsCount=_.where(enabledSources,{selected_by_default:!0}).length,this.s2m.totalCalendarsCount=enabledSources.length},SchedulingBaseCtrl.prototype.getBackgroundImageUrl=function(meeting){return this.meetingService.getBackgroundImageUrl(meeting)},SchedulingBaseCtrl.prototype.getTypeIconClass=function(meeting){return this.meetingService.getTypeIconClass(meeting)},SchedulingBaseCtrl.prototype.handleError=function(){return this.error=null,null!=this.errorHandlerCallback&&this.errorHandlerCallback(),this.errorHandlerCallback=null},SchedulingBaseCtrl}(),SchedulingIndexCtrl=function(superClass){function SchedulingIndexCtrl(){this.onCarouselComplete=bind(this.onCarouselComplete,this),SchedulingIndexCtrl.__super__.constructor.apply(this,arguments),this._resetS2m(),"/scheduling"===this.location.path()&&this._resetMeeting(),this._setPristine(),this.carouselVisible=this.sessionService.getShowCarousel(),this._setLayout(),this.user=this._getUser(),null!=this.meeting.current_scheduling_id&&0!==this.meeting.current_scheduling_id?this.startFromCurrentScheduling():this._initScheduling()}return extend(SchedulingIndexCtrl,superClass),SchedulingIndexCtrl.prototype._setLayout=function(){return this.carouselVisible?(this.navigationBarService.hide(),this.navigationBarService.hideMenu()):this.navigationBarService.update({title:"Find a suitable time",buttons:{left:"/scheduling"!==this.location.path()?this.navigationBarService.defaultBackButton():null}})},SchedulingIndexCtrl.prototype._initScheduling=function(){return this.matchmakers=this.matchmakerService.getCache(),this._fetchLunchScheduler().then(function(_this){return function(data){return _this.log.debug("Loaded lunch scheduler from local json"),_this.matchmakers=data,_this._fetchSchedulingData()}}(this))},SchedulingIndexCtrl.prototype._fetchSchedulingData=function(){var fetchList;return fetchList=[this._fetchSuggestionSources(),this._fetchMatchmakers()],null==this.matchmakers&&(this.loading=!0),null!=this.meeting.id&&this.meeting.meetingDataNotAvailable&&(fetchList.push(this._fetchMeeting()),this.loading=!0),this.q.all(fetchList).then(function(_this){return function(data){var matchmakers;return _this.log.debug("Loaded everything succesfully"),_this.s2m.suggestionSources=data[0],/@(meetin.gs|dicole.com)/.test(_this.user.email)&&(matchmakers=_this.matchmakerService.filterMatchmakers(data[1]),_this.matchmakers=_this.matchmakers.concat(matchmakers),_this.matchmakerService.setCache(_this.matchmakers)),data.length>2?(_this.meeting=data[2],_this.s2m.agenda=_.find(_this.meeting.materials,function(material){return"agenda"===material.material_class})):void 0}}(this),function(_this){return function(failure){return _this.log.error("Failed to load initial data",failure),_this.connectivity.isOnline()&&(_this.error=_this.errorHandlerService.handle(failure)),_this.errorHandlerCallback=_this._fetchSchedulingData}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},SchedulingIndexCtrl.prototype._initDefaultSlots=function(){var beginSecond,endSecond;return this.s2m.days=[!0,!0,!0,!0,!0,!1,!1],beginSecond=32400,endSecond=61200,this.s2m.scheduling.slots=this.schedulingService.formatSchedulingSlots(this.s2m.days,beginSecond,endSecond)},SchedulingIndexCtrl.prototype._initDefaultTimeSpans=function(){var startDate;return startDate=this.dateHelper.defaultNewSchedulingBeginDate(),this.s2m.availableTimespans={start:startDate,end:null},this.s2m.scheduling.available_timespans=[{start:startDate}]},SchedulingIndexCtrl.prototype.onCarouselComplete=function(){return this.navigationBarService.show("Find a suitable time"),this.navigationBarService.showMenu()},SchedulingIndexCtrl.prototype.startFromCurrentScheduling=function(){return this.s2m.scheduling=this.meeting.current_scheduling,this.s2m.scheduling.background_theme=this.meeting.background_theme,this.s2m.scheduling.is_scheduling_template=1,this.s2m.days=this.schedulingService.getSelectedDaysFromSlots(this.s2m.scheduling.slots),this.s2m.availableTimespans=_.cloneDeep(this.s2m.scheduling.available_timespans)[0],null!=this.s2m.availableTimespans.end&&(this.s2m.availableTimespans.end-=this.dateHelper.oneDayInSeconds),this.s2m.humanizedDuration=this.dateHelper.durationString(0,60*this.s2m.scheduling.duration),this.s2m.selectedDays=_(this.s2m.scheduling.slots).pluck("weekday").uniq(!0).value(),this._path("/"+this.tab+"/meeting/"+this.meeting.id+"/scheduling/review").replace()},SchedulingIndexCtrl.prototype.startNewScheduling=function(){return this.s2m.scheduling={is_scheduling_template:1,buffer:30,duration:60,time_zone:jstz.determine().name(),source_settings:this.user.source_settings,background_theme:13,meeting_type:15,organizer_swiping_required:1},this._initDefaultSlots(),this._initDefaultTimeSpans(),this._path("/scheduling/time")},SchedulingIndexCtrl.prototype.selectTemplate=function(template){var ref;return this.s2m.scheduling=template,this.meeting.initial_agenda=template.preset_agenda,(null==this.meeting.title_value||""===this.meeting.title_value)&&(this.meeting.title_value=template.name),this.s2m.days=this.schedulingService.getSelectedDaysFromSlots(this.s2m.scheduling.slots),(null!=(ref=this.s2m.scheduling.available_timespans)?ref.length:void 0)>0?this.s2m.availableTimespans=this.s2m.scheduling.available_timespans:this._initDefaultTimeSpans(),null==this.s2m.scheduling.source_settings&&(this.s2m.scheduling.source_settings=this.user.source_settings),null==this.s2m.scheduling.time_zone&&(this.s2m.scheduling.time_zone=jstz.determine().name()),this.s2m.humanizedDuration=this.dateHelper.durationString(0,60*this.s2m.scheduling.duration),this.s2m.selectedDays=_(this.s2m.scheduling.slots).pluck("weekday").uniq(!0).value(),this._path("/scheduling/participants")},SchedulingIndexCtrl}(SchedulingBaseCtrl),SchedulingTimeCtrl=function(superClass){function SchedulingTimeCtrl(){SchedulingTimeCtrl.__super__.constructor.apply(this,arguments),this._setLayout()}return extend(SchedulingTimeCtrl,superClass),SchedulingTimeCtrl.prototype._setLayout=function(){var buttons;return buttons=this._setLayoutButtons(),this.navigationBarService.update({title:"Time",buttons:{left:buttons.closeButton}}),this.navigationBarService.hideMenu()},SchedulingTimeCtrl.prototype._saveTime=function(selectedDays,beginSecond,endSecond,defaultTitle){return this.s2m.scheduling.slots=this.schedulingService.formatSchedulingSlots(selectedDays,beginSecond,endSecond),this.s2m.selectedDays=_(this.s2m.scheduling.slots).pluck("weekday").uniq(!0).value(),this.s2m.defaultTitle=defaultTitle},SchedulingTimeCtrl.prototype.selectTime=function(selectedDays,beginSecond,endSecond,defaultTitle){return this._saveTime(selectedDays,beginSecond,endSecond,defaultTitle),this._path("/scheduling/duration")},SchedulingTimeCtrl.prototype.openTimeEdit=function(){return this._path("/scheduling/customtime")},SchedulingTimeCtrl}(SchedulingBaseCtrl),SchedulingEditTimeCtrl=function(superClass){function SchedulingEditTimeCtrl(){this._timeEditDone=bind(this._timeEditDone,this),SchedulingEditTimeCtrl.__super__.constructor.apply(this,arguments),this._setLayout()}return extend(SchedulingEditTimeCtrl,superClass),SchedulingEditTimeCtrl.prototype._setLayout=function(){var buttons;return buttons=this._setLayoutButtons(this._timeEditDone),this.navigationBarService.update({title:"Time",buttons:{left:buttons.closeButton,right:buttons.doneButton}}),this.navigationBarService.hideMenu()},SchedulingEditTimeCtrl.prototype._timeEditDone=function(){var selectedDays;return selectedDays=this.schedulingService.formatSelectedDays(this.s2m.days),this._saveTime(selectedDays,this.s2m.scheduling.slots[0].begin_second,this.s2m.scheduling.slots[0].end_second),this.viewParams.get("fromReview")?(this.viewParams.set({fromReview:null}),this._back()):this._path("/scheduling/duration")},SchedulingEditTimeCtrl.prototype.formatTimezone=function(timezone){return this.dateHelper.formatTimezone(timezone)},SchedulingEditTimeCtrl.prototype.toggleDayValue=function(index){return this.s2m.days[index]=!this.s2m.days[index]},SchedulingEditTimeCtrl.prototype.setDayValue=function(index,value){return this.s2m.days[index]=value},SchedulingEditTimeCtrl}(SchedulingTimeCtrl),SchedulingDurationCtrl=function(superClass){function SchedulingDurationCtrl(){SchedulingDurationCtrl.__super__.constructor.apply(this,arguments),this._setLayout()}return extend(SchedulingDurationCtrl,superClass),SchedulingDurationCtrl.prototype._setLayout=function(){var buttons;return buttons=this._setLayoutButtons(),this.navigationBarService.update({title:"Duration",buttons:{left:buttons.closeButton}}),this.navigationBarService.hideMenu()},SchedulingDurationCtrl.prototype._saveDuration=function(duration){return this.s2m.scheduling.duration=duration,this.s2m.humanizedDuration=this.dateHelper.durationString(0,60*this.s2m.scheduling.duration)},SchedulingDurationCtrl.prototype.selectDuration=function(duration){return this._saveDuration(duration),this._path("/scheduling/location")},SchedulingDurationCtrl.prototype.openDurationEdit=function(){return this._path("/scheduling/customduration")
},SchedulingDurationCtrl}(SchedulingBaseCtrl),SchedulingEditDurationCtrl=function(superClass){function SchedulingEditDurationCtrl(){this._durationEditDone=bind(this._durationEditDone,this),SchedulingEditDurationCtrl.__super__.constructor.apply(this,arguments),this._initDurationDropdowns(),this._convertToHoursAndMinutes(),this._setLayout()}return extend(SchedulingEditDurationCtrl,superClass),SchedulingEditDurationCtrl.prototype._setLayout=function(){var buttons;return buttons=this._setLayoutButtons(this._durationEditDone),this.navigationBarService.update({title:"Duration",buttons:{left:buttons.closeButton,right:buttons.doneButton}}),this.navigationBarService.hideMenu()},SchedulingEditDurationCtrl.prototype._initDurationDropdowns=function(){return this.s2m.durationHourOptions=[{name:"0 hours",value:0},{name:"1 hour",value:1},{name:"2 hours",value:2},{name:"3 hours",value:3},{name:"4 hours",value:4},{name:"6 hours",value:6},{name:"8 hours",value:8}],this.s2m.durationMinuteOptions=[{name:"0 minutes",value:0},{name:"15 minutes",value:15},{name:"30 minutes",value:30},{name:"45 minutes",value:45}]},SchedulingEditDurationCtrl.prototype._convertToHoursAndMinutes=function(){var hours,minutes;return hours=parseInt(this.s2m.scheduling.duration/60),minutes=15*Math.round(this.s2m.scheduling.duration%60/15),60===minutes&&(minutes=0),this.s2m.durationHours=_.find(this.s2m.durationHourOptions,{value:hours}),this.s2m.durationMinutes=_.find(this.s2m.durationMinuteOptions,{value:minutes})},SchedulingEditDurationCtrl.prototype._durationEditDone=function(){var duration;return duration=60*this.s2m.durationHours.value+this.s2m.durationMinutes.value,this._saveDuration(duration),this.viewParams.get("fromReview")?(this.viewParams.set({fromReview:null}),this._back()):this._path("/scheduling/location")},SchedulingEditDurationCtrl.prototype.onDurationChange=function(){return 0===this.s2m.durationHours.value&&0===this.s2m.durationMinutes.value?this.s2m.durationMinutes=this.s2m.durationMinuteOptions[1]:void 0},SchedulingEditDurationCtrl}(SchedulingDurationCtrl),SchedulingLocationCtrl=function(superClass){function SchedulingLocationCtrl(){SchedulingLocationCtrl.__super__.constructor.apply(this,arguments),this._setLayout()}return extend(SchedulingLocationCtrl,superClass),SchedulingLocationCtrl.prototype._setLayout=function(){var buttons;return buttons=this._setLayoutButtons(),this.navigationBarService.update({title:"Location",buttons:{left:buttons.closeButton}}),this.navigationBarService.hideMenu()},SchedulingLocationCtrl.prototype.selectLocation=function(preset){var name;switch(preset){case 1:name=this._getUser().last_name||this._getUser().name,this.meeting.location_value="At "+name+"'s office";break;case 2:this.meeting.location_value="Online";break;default:this.meeting.location_value=null}return this._path("/scheduling/participants")},SchedulingLocationCtrl.prototype.openLocationEdit=function(){return this._path("/scheduling/customlocation")},SchedulingLocationCtrl}(SchedulingBaseCtrl),SchedulingEditLocationCtrl=function(superClass){function SchedulingEditLocationCtrl(){this._locationEditDone=bind(this._locationEditDone,this),SchedulingEditLocationCtrl.__super__.constructor.apply(this,arguments),this._setLayout()}return extend(SchedulingEditLocationCtrl,superClass),SchedulingEditLocationCtrl.prototype._setLayout=function(){var buttons;return buttons=this._setLayoutButtons(this._locationEditDone),this.navigationBarService.update({title:"Location",buttons:{left:buttons.closeButton,right:buttons.doneButton}}),this.navigationBarService.hideMenu()},SchedulingEditLocationCtrl.prototype._locationEditDone=function(){return this._path("/scheduling/participants")},SchedulingEditLocationCtrl}(SchedulingBaseCtrl),SchedulingParticipantsCtrl=function(superClass){function SchedulingParticipantsCtrl(){this._participantSelectDone=bind(this._participantSelectDone,this),SchedulingParticipantsCtrl.__super__.constructor.apply(this,arguments),this.contactPermissionTextVisible=!this.contactService.getPermissionAsked(),this.user=this._getUser(),this.userCountryId=this.currentUserService.getUserPhoneCountryId(this.user),null==this.s2m.participantActions&&(this.s2m.participantActions=[]),this._getLatestContacts(),this._removeUserFromParticipants(),this._initParticipantListWatcher(),this._setLayout()}return extend(SchedulingParticipantsCtrl,superClass),SchedulingParticipantsCtrl.prototype._setLayout=function(){var buttons;return buttons=this._setLayoutButtons(this._participantSelectDone),buttons.doneButton.disabled=this._isEnabledParticipantListEmpty(),this.navigationBarService.update({title:"Participants",buttons:{left:buttons.closeButton,right:this.contactPermissionTextVisible?null:buttons.doneButton}}),this.navigationBarService.hideMenu()},SchedulingParticipantsCtrl.prototype._initParticipantListWatcher=function(){return this.scope.$watch(function(_this){return function(){return _this.s2m.participants}}(this),function(_this){return function(){return _this._participantListChanged()}}(this),!0)},SchedulingParticipantsCtrl.prototype._participantListChanged=function(){return this._setLayout()},SchedulingParticipantsCtrl.prototype._participantSelectDone=function(){return this._isEnabledParticipantListEmpty()?void(this.error=this.errorHandlerService.handleAppError(this.errorHandlerService.EMPTY_CONTACT_LIST)):(this._saveLatestContacts(),this.viewParams.get("fromReview")?(this.viewParams.set({fromReview:null}),this._back()):this._path("/scheduling/review"))},SchedulingParticipantsCtrl.prototype._saveLatestContacts=function(){var user;return user=this._getUser(),this.contactService.setLatestContactsForUser(user.id,this.s2m.participants)},SchedulingParticipantsCtrl.prototype._getLatestContacts=function(){var ref,user;return user=this._getUser(),this.latestContacts=null!=(ref=this.contactService.getLatestContacts())?ref[user.id]:void 0},SchedulingParticipantsCtrl.prototype._removeUserFromParticipants=function(){var user;return user=this._getUser(),_.remove(this.s2m.participants,{phone:user.phone}),_.remove(this.s2m.participants,{email:user.email})},SchedulingParticipantsCtrl.prototype._isEnabledParticipantListEmpty=function(){return 0===_.filter(this.s2m.participants,function(participant){return!participant.scheduling_disabled}).length},SchedulingParticipantsCtrl.prototype._confirmParticipantReactivation=function(participant){return this.confirmDialog={title:"Are you sure?",message:participant.name+" decided not to participate in this scheduling. Are you sure you want to reactivate the scheduling for "+participant.name+"?",buttonConfirmCallback:function(_this){return function(){return participant.scheduling_disabled=0,_this.s2m.participantActions.push({type:"enableScheduling",participant:participant}),_this.confirmDialog=null}}(this),buttonConfirmCaption:"Activate",buttonCancelCallback:function(_this){return function(){return _this.confirmDialog=null}}(this),buttonCancelCaption:"Cancel"}},SchedulingParticipantsCtrl.prototype._participantExists=function(participant){participant.scheduling_disabled?null==participant.scheduling_disabled_by_user_id||participant.scheduling_disabled_by_user_id===this.user.id?(participant.scheduling_disabled=0,this.s2m.participantActions.push({type:"enableScheduling",participant:participant})):this._confirmParticipantReactivation(participant):this.error=this.errorHandlerService.handleAppError(this.errorHandlerService.PHONENUMBER_EXISTS)},SchedulingParticipantsCtrl.prototype.onAddParticipant=function(participant,type){var validatedParticipant;return this.log.debug(type+" participant added",participant),validatedParticipant=this.contactService.isValidParticipant(this.s2m.participants,participant,type,this.user,this.userCountryId),null!=(null!=validatedParticipant?validatedParticipant.existingParticipant:void 0)?this._participantExists(validatedParticipant.existingParticipant):null!=(null!=validatedParticipant?validatedParticipant.error:void 0)?this.error=validatedParticipant.error:(this.s2m.participants.push(participant),this.s2m.participantActions.push({type:"addParticipant",participant:participant}))},SchedulingParticipantsCtrl.prototype.onRemoveParticipant=function(participant){var oldParticipant;return this.log.debug("participant removed",participant),oldParticipant=_.find(this.meeting.participants,{id:participant.id}),null==oldParticipant?(this.log.debug("participant not found in meeting participants"),_.remove(this.s2m.participants,participant),_.remove(this.s2m.participantActions,{participant:participant})):(participant.scheduling_disabled_by_user_id=this.user.id,participant.scheduling_disabled=1,this.s2m.participantActions.push({type:"disableScheduling",participant:participant}))},SchedulingParticipantsCtrl.prototype.initContactPlugin=function(){return this.contactService.init().then(function(_this){return function(){return _this.contactService.setPermissionAsked(!0),_this.contactPermissionTextVisible=!1,_this._setLayout()}}(this),function(_this){return function(failure){return _this.log.error("Failed to initialize contact plugin",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SchedulingParticipantsCtrl}(SchedulingBaseCtrl),SchedulingEditTimespanCtrl=function(superClass){function SchedulingEditTimespanCtrl(){this._timespanEditDone=bind(this._timespanEditDone,this),SchedulingEditTimespanCtrl.__super__.constructor.apply(this,arguments),this._setLayout()}return extend(SchedulingEditTimespanCtrl,superClass),SchedulingEditTimespanCtrl.prototype._setLayout=function(){var buttons;return buttons=this._setLayoutButtons(this._timespanEditDone),this.navigationBarService.update({title:"Timespan",buttons:{left:buttons.closeButton,right:buttons.doneButton}}),this.navigationBarService.hideMenu()},SchedulingEditTimespanCtrl.prototype._timespanEditDone=function(){return this.s2m.scheduling.available_timespans[0][this.s2m.dateEditing]=parseInt(this.s2m.availableTimespans[this.s2m.dateEditing]),"end"===this.s2m.dateEditing&&(this.s2m.scheduling.available_timespans[0][this.s2m.dateEditing]+=this.dateHelper.oneDayInSeconds),this.s2m.dateEditing=null,this._back()},SchedulingEditTimespanCtrl}(SchedulingBaseCtrl),SchedulingEditSourcesCtrl=function(superClass){function SchedulingEditSourcesCtrl(){this._sourceEditDone=bind(this._sourceEditDone,this),SchedulingEditSourcesCtrl.__super__.constructor.apply(this,arguments),this._setLayout()}return extend(SchedulingEditSourcesCtrl,superClass),SchedulingEditSourcesCtrl.prototype._setLayout=function(){var buttons;return buttons=this._setLayoutButtons(this._sourceEditDone),this.navigationBarService.update({title:"Calendars",buttons:{left:buttons.closeButton,right:buttons.doneButton}}),this.navigationBarService.hideMenu()},SchedulingEditSourcesCtrl.prototype._sourceEditDone=function(){var enabledSources;return enabledSources=_.flatten(this.s2m.sources),this.s2m.scheduling.source_settings=this.suggestionService.enableSelectedSources(enabledSources),this._setCalendarCounts(enabledSources),this._back()},SchedulingEditSourcesCtrl.prototype.openAccountSettings=function(){return this.location.path("/settings/calendars")},SchedulingEditSourcesCtrl.prototype.toggleSuggestionSourceValue=function(type,source){return this.log.debug("attrs: ",type,source),this.s2m.sources[type][source].selected_by_default=!this.s2m.sources[type][source].selected_by_default},SchedulingEditSourcesCtrl.prototype.setSuggestionSourceValue=function(type,source){return this.log.debug("attrs: ",type,source,value),this.s2m.sources[type][source].selected_by_default=value},SchedulingEditSourcesCtrl}(SchedulingBaseCtrl),SchedulingReviewCtrl=function(superClass){function SchedulingReviewCtrl(){this._cancelScheduling=bind(this._cancelScheduling,this),SchedulingReviewCtrl.__super__.constructor.apply(this,arguments),this.s2m.schedulingStarted&&this.location.path("/scheduling"),this.showBackButton=_.contains(this.location.path(),"/meeting/"),this.user=this._getUser(),this._pushUserToParticipants(),this._fetchParticipantImages(),this._setMeetingTitle(),null==this.s2m.suggestionSources?this._initReview():(this._setEnabledSuggestionSources(this.s2m.scheduling.source_settings),this._setSuggestionsSourceCounts()),this._setLayout()}return extend(SchedulingReviewCtrl,superClass),SchedulingReviewCtrl.prototype._setLayout=function(){var cancelButton;return cancelButton={title:"Cancel",onClick:function(_this){return function(){return _this._confirmCancel()}}(this)},this.navigationBarService.update({title:"Review",buttons:{left:this.showBackButton?this.navigationBarService.defaultBackButton():cancelButton}}),this.navigationBarService.hideMenu()},SchedulingReviewCtrl.prototype._cancelScheduling=function(){return this.confirmDialog=null,this.location.path("/scheduling"),this.scope.$$phase?void 0:this.scope.$apply()},SchedulingReviewCtrl.prototype._confirmCancel=function(){return this.confirmDialog={title:"Cancel scheduling?",message:"All your selections will be lost. Are you sure you want to cancel the scheduling?",buttonConfirmCallback:this._cancelScheduling,buttonConfirmCaption:"Yes",buttonCancelCallback:function(_this){return function(){return _this.confirmDialog=null}}(this),buttonCancelCaption:"No"}},SchedulingReviewCtrl.prototype._initReview=function(){return this.loading=!0,this._fetchSuggestionSources().then(function(_this){return function(data){return _this.log.debug("Loaded suggestion sources succesfully"),_this.s2m.suggestionSources=data,_this._setEnabledSuggestionSources(_this.s2m.scheduling.source_settings),_this._setSuggestionsSourceCounts()}}(this),function(_this){return function(failure){return _this.log.error("Failed to load initial data",failure),_this.error=_this.errorHandlerService.handle(failure),_this.errorHandlerCallback=_this._initReview}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},SchedulingReviewCtrl.prototype._fetchUser=function(participant,type){var match,params;return match=new RegExp(/[^\d]/g),params={limit_fields:["id","name","initials","image",type]},params[type]=participant[type],this.participantService.fetchUser(params).then(function(_this){return function(data){return _this.log.debug("Found user",data),_.merge(participant,_.pick(data,_.identity))}}(this))},SchedulingReviewCtrl.prototype._fetchParticipantImages=function(){return _.each(this.s2m.participants,function(_this){return function(participant){return null==participant.image&&(participant.phone&&_this._fetchUser(participant,"phone"),participant.email)?_this._fetchUser(participant,"email"):void 0}}(this))},SchedulingReviewCtrl.prototype._pushUserToParticipants=function(){return this.user.rsvp_status="yes",null==_.find(this.s2m.participants,{phone:this.user.phone})&&null==_.find(this.s2m.participants,{email:this.user.email})?this.s2m.participants.unshift(this.user):void 0},SchedulingReviewCtrl.prototype._setMeetingTitle=function(){return null==this.meeting.title_value||""===this.meeting.title_value?this.meeting.title_value=this.meetingService.generateTitle(this.s2m.participants,this.s2m.defaultTitle):void 0},SchedulingReviewCtrl.prototype._setSuggestionsSourceCounts=function(){return this.s2m.enabledCalendarsCount=_.keys(this.s2m.scheduling.source_settings.enabled).length,this.s2m.totalCalendarsCount=this.s2m.enabledCalendarsCount+_.keys(this.s2m.scheduling.source_settings.disabled).length},SchedulingReviewCtrl.prototype._isValidScheduling=function(){return this.formError=this.schedulingService.isValidScheduling(this.s2m),""!==this.formError.msg?(this.error=this.errorHandlerService.handleAppError(this.errorHandlerService.INVALID_SCHEDULING,this.formError.msg),!1):0===_.filter(this.s2m.participants,function(_this){return function(participant){return!participant.scheduling_disabled&&participant.user_id!==_this.user.id}}(this)).length?(this.error=this.errorHandlerService.handleAppError(this.errorHandlerService.INVALID_SCHEDULING,"Please add at least one active participant to the scheduling"),!1):!0},SchedulingReviewCtrl.prototype._copyThemeToMeeting=function(){return this.meeting.background_theme=this.s2m.scheduling.background_theme,this.meeting.meeting_type=this.s2m.scheduling.meeting_type},SchedulingReviewCtrl.prototype.openMeetingEdit=function(target){return this.viewParams.set({fromReview:!0}),this._path("/scheduling/meeting/"+this.meeting.id+"/edit/"+target)},SchedulingReviewCtrl.prototype.openParticipants=function(){return this.viewParams.set({fromReview:!0}),this._path("/scheduling/participants")},SchedulingReviewCtrl.prototype.openAgenda=function(){var breadcrumb,materialId,ref;return breadcrumb=encodeURIComponent(this.meeting.title_value),materialId=null!=(ref=this.s2m.agenda)?ref.id:void 0,this.viewParams.set({breadcrumb:breadcrumb,isManager:!0,materialClass:"agenda"}),this._path(null!=materialId?"/scheduling/meeting/"+this.meeting.id+"/material/"+materialId:"/scheduling/material")},SchedulingReviewCtrl.prototype.openTimespanEdit=function(target){return this.s2m.dateEditing=target,null==this.s2m.availableTimespans[this.s2m.dateEditing]&&"end"===this.s2m.dateEditing&&(this.s2m.availableTimespans[this.s2m.dateEditing]=this.dateHelper.defaultNewSchedulingEndDate(this.s2m.availableTimespans.start)),this.viewParams.set({fromReview:!0}),this._path("/scheduling/timespan")},SchedulingReviewCtrl.prototype.openTimeEdit=function(){return this.viewParams.set({fromReview:!0}),this._path("/scheduling/customtime")},SchedulingReviewCtrl.prototype.openDurationEdit=function(){return this.viewParams.set({fromReview:!0}),this._path("/scheduling/customduration")},SchedulingReviewCtrl.prototype.openSourceEdit=function(){return this.viewParams.set({fromReview:!0}),this._path("/scheduling/calendars")},SchedulingReviewCtrl.prototype.toggleOrganizerSwipingRequired=function(){return this.s2m.scheduling.organizer_swiping_required=!this.s2m.scheduling.organizer_swiping_required},SchedulingReviewCtrl.prototype.setOrganizerSwipingRequired=function(value){return this.s2m.scheduling.organizer_swiping_required=value},SchedulingReviewCtrl.prototype.onScheduleMeeting=function(){return this._isValidScheduling()?(this._copyThemeToMeeting(),this.viewParams.set({fromReview:!0}),this._path("/scheduling/done")):void 0},SchedulingReviewCtrl}(SchedulingBaseCtrl),SchedulingStartCtrl=function(superClass){function SchedulingStartCtrl(){return SchedulingStartCtrl.__super__.constructor.apply(this,arguments),this.viewParams.get("fromReview")?(this.createNewMeeting=null==this.meeting.id,this._createScheduling(),this._setLayout(),void this.timeout(function(_this){return function(){return _this.animationFinished=!0,_this._redirectToLog(),_this.scope.$apply()}}(this),4e3)):(this.viewParams.set({fromReview:!1}),void this.location.path("/scheduling").replace())}return extend(SchedulingStartCtrl,superClass),SchedulingStartCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"Starting scheduling"}),this.navigationBarService.hideMenu()},SchedulingStartCtrl.prototype._createScheduling=function(){return this.schedulingReady=!1,this.createNewMeeting?this._createMeeting().then(function(_this){return function(){return _this._startScheduling()}}(this)):this._updateParticipants().then(function(_this){return function(){return _this._startScheduling()}}(this))},SchedulingStartCtrl.prototype._createMeeting=function(){return this.meeting.participants=angular.copy(this.s2m.participants),this.s2m.participantActions=null,this.SessionRestangular.all("meetings").post(this.meeting).then(function(_this){return function(data){return _this.log.debug("created meeting, received meeting data: ",data),_this.meeting=data,_this.meetingId=data.id,_this.meetingService.setMeeting(_this.meeting)}}(this),function(_this){return function(failure){return _this.log.error("Failed to create meeting",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SchedulingStartCtrl.prototype._updateParticipants=function(){var participantPromises;return participantPromises=[],_.each(this.s2m.participantActions,function(_this){return function(action){switch(action.type){case"addParticipant":return participantPromises.push(_this.participantService.addParticipant(_this.meeting.id,action.participant));case"enableScheduling":return participantPromises.push(_this.participantService.enableScheduling(action.participant));case"disableScheduling":return participantPromises.push(_this.participantService.disableScheduling(action.participant))}}}(this)),this.q.all(participantPromises).then(function(_this){return function(){return _this.s2m.participantActions=null}}(this))},SchedulingStartCtrl.prototype._startScheduling=function(){return this.schedulingService.startScheduling(this.meeting.id,this.s2m.scheduling).then(function(_this){return function(data){return _this.log.debug("Scheduling started",data),_this.schedulingId=data.id,_this._pollSchedulingReady(data.id)}}(this),function(_this){return function(failure){return _this.log.error("Failed to start scheduling",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SchedulingStartCtrl.prototype._pollSchedulingReady=function(schedulingId){return this.schedulingService.fetchScheduling(this.meeting.id,schedulingId).then(function(_this){return function(data){return 0!==parseInt(data.failed_epoch)?(_this.log.error("Failed to start scheduling"),_this.error=_this.errorHandlerService.handleAppError(_this.errorHandlerService.START_SCHEDULING_FAILED)):0===parseInt(data.started_epoch)?_this.timeout(function(){return _this._pollSchedulingReady(schedulingId)},_this.appConfig.scheduling.pollInterval):(_this.schedulingReady=!0,_this._redirectToLog())}}(this),function(_this){return function(failure){return _this.log.error("Failed to fetch scheduling",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SchedulingStartCtrl.prototype._redirectToLog=function(){return this.animationFinished&&this.schedulingReady?(this.viewParams.set({showCloseButton:this.createNewMeeting,showMeetingDetailsButton:!0,showProvideAvailabilityButton:this.s2m.scheduling.organizer_swiping_required}),this._path("/timeline/meeting/"+this.meeting.id+"/scheduling/"+this.schedulingId+"/log")):void 0},SchedulingStartCtrl.prototype.handleError=function(){return this.error=null,this.window.history.back()},SchedulingStartCtrl}(SchedulingBaseCtrl),SchedulingLogCtrl=function(superClass){function SchedulingLogCtrl(){SchedulingLogCtrl.__super__.constructor.apply(this,arguments),this.tab=this.viewParams.get("tab")||"timeline",this.meetingId=this.viewParams.get("meetingId"),this.schedulingId=this.viewParams.get("schedulingId"),this.showCloseButton=this.viewParams.get("showCloseButton"),this.showMeetingDetailsButton=this.viewParams.get("showMeetingDetailsButton"),this.showProvideAvailabilityButton="true"===this.viewParams.get("showProvideAvailabilityButton"),this.fullLog=!1,this.logData=[],this._initPusher(),this._fetchSchedulingLog(),this._setLayout()}return extend(SchedulingLogCtrl,superClass),SchedulingLogCtrl.prototype._setLayout=function(){var closeButton;return"true"===this.showCloseButton&&(closeButton={title:"Close",onClick:function(_this){return function(){return _this.location.path("/scheduling"),_this.scope.$$phase?void 0:_this.scope.$apply()}}(this)}),this.navigationBarService.update({title:"Scheduling started",buttons:{left:null==closeButton?this.navigationBarService.buttonToPath("/"+this.tab+"/meeting/"+this.meetingId):null,right:closeButton}}),null!=closeButton?this.navigationBarService.hideMenu():void 0},SchedulingLogCtrl.prototype._initPusher=function(){var channelName,pusherNewLogEntryCallback,pusherTimeFoundCallback;return channelName=this.appConfig.pusher.channelName+this.sessionService.getUserId(),pusherNewLogEntryCallback=function(_this){return function(data){return parseInt(data.scheduling_id)===parseInt(_this.schedulingId)&&(0===_this.logData.length||data.entry_id>=_(_this.logData).pluck("id").last())?_this.scope.$apply(function(){return _this._fetchSchedulingLogWithMinEpoch()}):void 0}}(this),this.pusherService.subscribeAndBind(channelName,"new_scheduling_log_entries",pusherNewLogEntryCallback),pusherTimeFoundCallback=function(_this){return function(data){return parseInt(data.scheduling_id)===parseInt(_this.schedulingId)?_this.scope.$apply(function(){return _this._redirectToThankYouPage()}):void 0}}(this),this.pusherService.subscribeAndBind(channelName,"scheduling_time_found",pusherTimeFoundCallback),this.scope.$on("$destroy",function(_this){return function(){return _this.pusherService.unbind(channelName,"new_scheduling_log_entries",pusherNewLogEntryCallback),_this.pusherService.unbind(channelName,"scheduling_time_found",pusherTimeFoundCallback)}}(this))},SchedulingLogCtrl.prototype._fetchSchedulingLogWithMinEpoch=function(){var latestCreatedEpoch;return latestCreatedEpoch=_(this.logData).pluck("created_epoch").max(),this._fetchSchedulingLog({min_created_epoch:latestCreatedEpoch-10})},SchedulingLogCtrl.prototype._fetchSchedulingLog=function(params){return params=params||{},params.image_size=this.appConfig.thumbnail.medium,this.schedulingLogService.fetchAll(this.meetingId,this.schedulingId,params).then(function(_this){return function(data){return _this.logData=_this.logData.concat(data),_this.logData=_.uniq(_this.logData,"id"),_this._handleLogEvents(_this.logData)}}(this),function(_this){return function(failure){return _this.log.error("Failed to load meeting",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SchedulingLogCtrl.prototype._handleLogEvents=function(logData){var instructionChanges,logMessages,userStateChanges;return userStateChanges=_.where(logData,{entry_type:"user_state_changed"}),instructionChanges=_.where(logData,{entry_type:"instruction_changed"}),logMessages=_.filter(logData,function(entry){return"user_state_changed"!==entry.entry_type&&"instruction_changed"!==entry.entry_type}),this.userStates=this.schedulingLogService.sortUserStates(userStateChanges),this.instruction=this.schedulingLogService.formatInstructionChanges(instructionChanges),this.eventLog=this.schedulingLogService.formatLogMessages(logMessages)},SchedulingLogCtrl.prototype._redirectToThankYouPage=function(){return this.viewParams.set({showCloseButton:this.showCloseButton}),this.location.path("/"+this.tab+"/meeting/"+this.meetingId+"/scheduling/"+this.schedulingId+"/thanks/2")},SchedulingLogCtrl.prototype.openMeeting=function(){return this.location.path("/timeline/meeting/"+this.meetingId)},SchedulingLogCtrl.prototype.openDateEdit=function(){return this.location.path("/timeline/meeting/"+this.meetingId+"/edit/date").replace()},SchedulingLogCtrl.prototype.openSwipeToMeet=function(){return this.viewParams.set({menuVisible:!0}),this.location.path("/timeline/meeting/"+this.meetingId+"/scheduling/"+this.schedulingId)},SchedulingLogCtrl.prototype.openParticipant=function(participantId){var breadcrumb;return breadcrumb=encodeURIComponent(this.meeting.title_value),this.viewParams.set({breadcrumb:breadcrumb,showCloseButton:this.showCloseButton,schedulingId:this.schedulingId,meetingId:this.meetingId}),this.location.path("/"+this.tab+"/meeting/"+this.meeting.id+"/participants/"+participantId)},SchedulingLogCtrl.prototype.toggleLogSize=function(){return this.fullLog=!this.fullLog},SchedulingLogCtrl.prototype.handleError=function(){return this.error=null,this._fetchSchedulingLog()},SchedulingLogCtrl}(SchedulingBaseCtrl),schedulingApp=angular.module("schedulingApp",["ngRoute","ngAnimate","appConfig","nativeUi","mtnUtils","splashscreen","matchmakerModule","meetingModule","participantModule","schedulingModule","contactModule","suggestionModule","schedulingLogModule","pusherModule","mtnMomentModule","dateHelper","mtnContactPicker","mtnFloatLabel","mtnCheckbox","mtnRadioButtonList","ngTagsInput","mtnTagInput","partials","mtnAnimationReset","mtnCarousel","connectivity","mtnA"]),schedulingApp.controller("SchedulingIndexCtrl",SchedulingIndexCtrl),schedulingApp.controller("SchedulingTimeCtrl",SchedulingTimeCtrl),schedulingApp.controller("SchedulingEditTimeCtrl",SchedulingEditTimeCtrl),schedulingApp.controller("SchedulingLocationCtrl",SchedulingLocationCtrl),schedulingApp.controller("SchedulingEditLocationCtrl",SchedulingEditLocationCtrl),schedulingApp.controller("SchedulingDurationCtrl",SchedulingDurationCtrl),schedulingApp.controller("SchedulingEditDurationCtrl",SchedulingEditDurationCtrl),schedulingApp.controller("SchedulingParticipantsCtrl",SchedulingParticipantsCtrl),schedulingApp.controller("SchedulingEditTimespanCtrl",SchedulingEditTimespanCtrl),schedulingApp.controller("SchedulingEditSourcesCtrl",SchedulingEditSourcesCtrl),schedulingApp.controller("SchedulingReviewCtrl",SchedulingReviewCtrl),schedulingApp.controller("SchedulingStartCtrl",SchedulingStartCtrl),schedulingApp.controller("SchedulingLogCtrl",SchedulingLogCtrl);var schedulingTabApp;schedulingTabApp=angular.module("schedulingTabApp",["ngRoute","ngAnimate","SPARouteConfig","schedulingApp","meetingApp","materialApp"]);var StyleguideBaseCtrl,StyleguideIndexCtrl,styleguideApp,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;StyleguideBaseCtrl=function(){function StyleguideBaseCtrl(scope,log,appConfig,errorHandlerService){this.scope=scope,this.log=log,this.appConfig=appConfig,this.errorHandlerService=errorHandlerService}return StyleguideBaseCtrl.$inject=["$scope","$log","appConfig","errorHandlerService"],StyleguideBaseCtrl}(),StyleguideIndexCtrl=function(superClass){function StyleguideIndexCtrl(){StyleguideIndexCtrl.__super__.constructor.apply(this,arguments),this.offlineOverlayVisible=!1,this.participant={image:"https://dev.meetin.gs/networking_raw/image/0/4633/200/200/portrait.png",rsvp_string:"Presumedly attending.",rsvp_status:"yes",first_name:"Demo",last_name:"Erkki",name:"Demo Erkki",initials:"DE",email:"Demo@meetin.gs",organization_title:"Dr. Fancypants",organization:"Acme Inc",phone:"+3580123456",skype:"demoerkki",linkedin:"http://demoerkki.linkedin.com"},this.participant2={rsvp_string:"Presumedly attending.",rsvp_status:"yes",first_name:"Demo",last_name:"Erkki",name:"Demo Erkki",initials:"DE",email:"Demo@meetin.gs",organization_title:"Dr. Fancypants",organization:"Acme Inc",phone:"+3580123456",skype:"demoerkki",linkedin:"http://demoerkki.linkedin.com"},this.contacts=[{id:1,rawId:null,displayName:null,name:{givenName:"Kate",formatted:"Kate Bell",middleName:null,familyName:"Bell",honorificPrefix:null,honorificSuffix:null},nickname:null,phoneNumbers:[{type:"mobile",value:"(555) 564-8583",id:0,pref:!1},{type:"other",value:"(415) 555-3695",id:1,pref:!1}],emails:[{type:"work",value:"kate-bell@mac.com",id:0,pref:!1},{type:"work",value:"www.icloud.com",id:1,pref:!1}],addresses:[{postalCode:"94010",type:"work",id:0,locality:"Hillsborough",pref:"false",streetAddress:"165 Davis Street",region:"CA",country:null}],ims:null,organizations:[{name:"Creative Consulting",title:"Producer",type:null,pref:"false",department:null}],birthday:2541456e5,note:null,photos:null,categories:null,urls:null},{id:2,rawId:null,displayName:null,name:{givenName:"Daniel",formatted:"Daniel Higgins Jr.",middleName:null,familyName:"Higgins",honorificPrefix:null,honorificSuffix:"Jr."},nickname:null,phoneNumbers:[{type:"home",value:"555-478-7672",id:0,pref:!1},{type:"mobile",value:"(408) 555-5270",id:1,pref:!1},{type:"fax",value:"(408) 555-3514",id:2,pref:!1}],emails:[{type:"home",value:"d-higgins@mac.com",id:0,pref:!1}],addresses:[{postalCode:"94925",type:"home",id:0,locality:"Corte Madera",pref:"false",streetAddress:"332 Laguna Street",region:"CA",country:"USA"}],ims:null,organizations:null,birthday:null,note:"Sister: Emily",photos:null,categories:null,urls:null},{id:3,rawId:null,displayName:null,name:{givenName:"John",formatted:"John Appleseed",middleName:null,familyName:"Appleseed",honorificPrefix:null,honorificSuffix:null},nickname:null,phoneNumbers:[{type:"mobile",value:"888-555-5512",id:0,pref:!1},{type:"home",value:"888-555-1212",id:1,pref:!1}],emails:[{type:"work",value:"John-Appleseed@mac.com",id:0,pref:!1}],addresses:[{postalCode:"30303",type:"work",id:0,locality:"Atlanta",pref:"false",streetAddress:"3494 Kuhl Avenue",region:"GA",country:"USA"},{postalCode:"30303",type:"home",id:1,locality:"Atlanta",pref:"false",streetAddress:"1234 Laurel Street",region:"GA",country:"USA"}],ims:null,organizations:null,birthday:3305232e5,note:"College roommate",photos:null,categories:null,urls:null},{id:4,rawId:null,displayName:null,name:{givenName:"Anna",formatted:"Anna Haro",middleName:null,familyName:"Haro",honorificPrefix:null,honorificSuffix:null},nickname:"Annie",phoneNumbers:[{type:"home",value:"555-522-8243",id:0,pref:!1}],emails:[{type:"home",value:"anna-haro@mac.com",id:0,pref:!1}],addresses:[{postalCode:"94965",type:"home",id:0,locality:"Sausalito",pref:"false",streetAddress:"1001  Leavenworth Street",region:"CA",country:"USA"}],ims:null,organizations:null,birthday:4941648e5,note:null,photos:null,categories:null,urls:null},{id:5,rawId:null,displayName:null,name:{givenName:"Hank",formatted:"Hank M. Zakroff",middleName:"M.",familyName:"Zakroff",honorificPrefix:null,honorificSuffix:null},nickname:null,phoneNumbers:[{type:"work",value:"(555) 766-4823",id:0,pref:!1},{type:"other",value:"(707) 555-1854",id:1,pref:!1}],emails:[{type:"work",value:"hank-zakroff@mac.com",id:0,pref:!1}],addresses:[{postalCode:"94901",type:"work",id:0,locality:"San Rafael",pref:"false",streetAddress:"1741 Kearny Street",region:"CA",country:null}],ims:null,organizations:[{name:"Financial Services Inc.",title:"Portfolio Manager",type:null,pref:"false",department:null}],birthday:null,note:null,photos:null,categories:null,urls:null},{id:6,rawId:null,displayName:null,name:{givenName:"David",formatted:"David Taylor",middleName:null,familyName:"Taylor",honorificPrefix:null,honorificSuffix:null},nickname:null,phoneNumbers:[{type:"home",value:"555-610-6679",id:0,pref:!1}],emails:null,addresses:[{postalCode:"94920",type:"home",id:0,locality:"Tiburon",pref:"false",streetAddress:"1747 Steuart Street",region:"CA",country:"USA"}],ims:null,organizations:null,birthday:897912e6,note:"Plays on Cole's Little League Baseball Team\n",photos:null,categories:null,urls:null},{id:7,rawId:null,displayName:null,name:{givenName:"David",formatted:"David Taylor2",middleName:null,familyName:"Taylor2",honorificPrefix:null,honorificSuffix:null},nickname:null,phoneNumbers:[{type:"home",value:"555-610-6679",id:0,pref:!1}],emails:null,addresses:[{postalCode:"94920",type:"home",id:0,locality:"Tiburon",pref:"false",streetAddress:"1747 Steuart Street",region:"CA",country:"USA"}],ims:null,organizations:null,birthday:897912e6,note:"Plays on Cole's Little League Baseball Team\n",photos:null,categories:null,urls:null}],this.contacts=_(this.contacts).groupBy(function(i){return i.name.formatted.substr(0,1)
}).map(function(value,key){return{key:key,value:value}}).value(),this.contactFilter="",this.searchFocus=!1}return extend(StyleguideIndexCtrl,superClass),StyleguideIndexCtrl.prototype.togglePhoneNumbers=function(contact){return contact.phoneNumbersVisible=!contact.phoneNumbersVisible},StyleguideIndexCtrl.prototype.toggleUpload=function(){return this.uploadProgress={total:100,loaded:69},setTimeout(function(_this){return function(){return _this.scope.$apply(function(){return _this.uploadProgress=null})}}(this),1e3)},StyleguideIndexCtrl.prototype.btnClick=function(btn){return this.btnWorking=btn,setTimeout(function(_this){return function(){return _this.scope.$apply(function(){return _this.btnWorking=null})}}(this),1e3)},StyleguideIndexCtrl.prototype.openShowView=function(){},StyleguideIndexCtrl.prototype.openSinglePageView=function(){return window.location="/views/styleguide/singlePage.html"},StyleguideIndexCtrl.prototype.toggleObtrusiveOverlayVisibility=function(){return this.obtrusiveOverlayVisible=!this.obtrusiveOverlayVisible},StyleguideIndexCtrl.prototype.toggleError=function(msg){return this.error=msg?this.errorHandlerService.msg(msg,{title:"Example title"}):null},StyleguideIndexCtrl.prototype.handleError=function(){return this.error=null},StyleguideIndexCtrl}(StyleguideBaseCtrl),styleguideApp=angular.module("styleguideApp",["appConfig","mtnFloatLabel","mtnProgress"]),styleguideApp.controller("StyleguideIndexCtrl",StyleguideIndexCtrl);var SwipeToMeetAppDownloadGuideCtrl,SwipeToMeetBaseCtrl,SwipeToMeetConfirmLeaveCtrl,SwipeToMeetConfirmPhoneCtrl,SwipeToMeetCountryCodeCtrl,SwipeToMeetInfoCtrl,SwipeToMeetInviteSubsituteCtrl,SwipeToMeetLandingCtrl,SwipeToMeetLeaveCtrl,SwipeToMeetShowCtrl,SwipeToMeetThanksCtrl,swipeToMeetApp,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};SwipeToMeetBaseCtrl=function(){function SwipeToMeetBaseCtrl(scope,rootScope,log,location,window,q1,http,filter,analytics,appConfig,msgChannel,SessionRestangular,errorHandlerService,sessionService,dateHelper,schedulingService,matchmakerService,meetingService,currentUserService,participantService,navigationBarService,pusherService,viewParams,deviceUtils,contactService,LocalDataRestangular){this.scope=scope,this.rootScope=rootScope,this.log=log,this.location=location,this.window=window,this.q=q1,this.http=http,this.filter=filter,this.analytics=analytics,this.appConfig=appConfig,this.msgChannel=msgChannel,this.SessionRestangular=SessionRestangular,this.errorHandlerService=errorHandlerService,this.sessionService=sessionService,this.dateHelper=dateHelper,this.schedulingService=schedulingService,this.matchmakerService=matchmakerService,this.meetingService=meetingService,this.currentUserService=currentUserService,this.participantService=participantService,this.navigationBarService=navigationBarService,this.pusherService=pusherService,this.viewParams=viewParams,this.deviceUtils=deviceUtils,this.contactService=contactService,this.LocalDataRestangular=LocalDataRestangular,this.location.search("utm_source",null).replace(),this.tab=this.viewParams.get("tab"),this.meetingId=this.viewParams.get("meetingId"),this.schedulingId=this.viewParams.get("schedulingId"),this.participantMaxCountBeforeSummary=this.appConfig.meeting.participants.maxCountBeforeSummary,this.userRoute=this.currentUserService.getRoute()}return SwipeToMeetBaseCtrl.$inject=["$scope","$rootScope","$log","$location","$window","$q","$http","$filter","$analytics","appConfig","jsonMsgChannel","SessionRestangular","errorHandlerService","sessionService","dateHelper","schedulingService","matchmakerService","meetingService","currentUserService","participantService","navigationBarService","pusherService","viewParams","deviceUtils","contactService","LocalDataRestangular"],SwipeToMeetBaseCtrl.prototype._redirectToThankYouPage=function(msgId){return this.location.path("/"+this.tab+"/meeting/"+this.meetingId+"/scheduling/"+this.schedulingId+"/thanks/"+msgId)},SwipeToMeetBaseCtrl.prototype._fetchMeeting=function(meetingId){return this.meetingService.fetchMeeting(meetingId,{image_size:this.appConfig.thumbnail.medium}).then(function(_this){return function(data){return _this.meeting=data,_this.meetingService.setMeeting(_this.meeting),_this.participants=_.where(_this.meeting.participants,{is_manager:"0"}),_this.participant=_.find(_this.meeting.participants,{user_id:_this.sessionService.getUserId()}),_this.participant=_this.participantService.restangularizeElement(_this.participant),_this.hasLeftScheduling=_this.participantService.hasLeftScheduling(_this.participant)}}(this),function(_this){return function(failure){return _this.log.error("Failed to load meeting",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SwipeToMeetBaseCtrl.prototype._fetchScheduling=function(meetingId,schedulingId){return this.schedulingService.fetchScheduling(meetingId,schedulingId).then(function(_this){return function(data){return _this.scheduling=data,_this.schedulingService.setScheduling(_this.scheduling)}}(this),function(_this){return function(failure){return _this.log.error("Failed to load scheduling",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SwipeToMeetBaseCtrl.prototype._fetchOption=function(meetingId,schedulingId,optionId){return this.schedulingService.fetchOption(meetingId,schedulingId,optionId).then(function(_this){return function(data){return _this.option=data}}(this),function(_this){return function(failure){return _this.log.error("Failed to load scheduling",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SwipeToMeetBaseCtrl.prototype._reloadUser=function(){return this.currentUserService.reload({image_size:this.appConfig.thumbnail.medium}).then(function(_this){return function(user){return _this.user=user}}(this),function(_this){return function(failure){return _this.log.error("Failed to load user data"),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SwipeToMeetBaseCtrl.prototype._initParticipants=function(){var participant;return this.manager=this.participantService.getManager(this.meeting.participants),this.isManager=this.sessionService.getUserId()===this.manager.id,participant=this.participantService.getParticipant(this.userRoute.id,this.meeting.participants),this.isReSwipe=1===participant.has_answered_current_scheduling},SwipeToMeetBaseCtrl.prototype.openMeeting=function(){return this.location.path("/"+this.tab+"/meeting/"+this.meetingId)},SwipeToMeetBaseCtrl.prototype.replaceWithMeeting=function(){return this.location.path("/"+this.tab+"/meeting/"+this.meetingId).replace()},SwipeToMeetBaseCtrl}(),SwipeToMeetLandingCtrl=function(superClass){function SwipeToMeetLandingCtrl(){SwipeToMeetLandingCtrl.__super__.constructor.apply(this,arguments),this.isReSwipe=!1,this.listClosed=!0,this._initLandingPage(),this._setLayout()}return extend(SwipeToMeetLandingCtrl,superClass),SwipeToMeetLandingCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"Meeting request",buttons:{left:"web"!==this.deviceUtils.platform()?this.navigationBarService.defaultBackButton():null}}),"true"!==this.viewParams.get("menuVisible")?this.navigationBarService.hideMenu():void 0},SwipeToMeetLandingCtrl.prototype._initLandingPage=function(){return this.loading=!0,this.q.all([this._fetchMeeting(this.meetingId),this._fetchScheduling(this.meetingId,this.schedulingId),this._reloadUser()]).then(function(_this){return function(){return 0!==parseInt(_this.meeting.removed_epoch)?void _this.replaceWithMeeting():0!==_this.meeting.current_scheduling_id&&_this.meeting.current_scheduling_id!==_this.schedulingId?void _this._redirectToThankYouPage(4).replace():_this.meetingService.isSchedulingCompleted(_this.meeting,_this.scheduling)?void _this._redirectToThankYouPage(2).replace():_this.meetingService.isSchedulingCanceled(_this.meeting,_this.scheduling)?void _this._redirectToThankYouPage(5).replace():_this.meetingService.isSchedulingFailed(_this.meeting,_this.scheduling)?void _this._redirectToThankYouPage(3).replace():_this._fetchSchedulingOptions(_this.meetingId,_this.schedulingId)}}(this))["finally"](function(_this){return function(){return _this._initParticipants(),_this.loading=!1}}(this))},SwipeToMeetLandingCtrl.prototype._fetchSchedulingOptions=function(meetingId,schedulingId){return this.schedulingService.fetchNextOption(meetingId,schedulingId).then(function(_this){return function(data){return 1===data.option.no_suggestions_left?void _this._redirectToThankYouPage(3).replace():_this.options=data}}(this),function(_this){return function(failure){return _this.log.error("Failed to fetch options",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SwipeToMeetLandingCtrl.prototype.getBackgroundImageUrl=function(meeting){return this.meetingService.getBackgroundImageUrl(meeting)},SwipeToMeetLandingCtrl.prototype.openSwipe=function(){return this.viewParams.add("options",this.options),this.location.path("/"+this.tab+"/meeting/"+this.meeting.id+"/scheduling/"+this.schedulingId+"/suggestions")},SwipeToMeetLandingCtrl.prototype.leaveScheduling=function(){return this.location.path("/"+this.tab+"/meeting/"+this.meetingId+"/scheduling/"+this.schedulingId+"/leave/confirm")},SwipeToMeetLandingCtrl.prototype.handleError=function(){return this.error=null,this._initLandingPage()},SwipeToMeetLandingCtrl}(SwipeToMeetBaseCtrl),SwipeToMeetShowCtrl=function(superClass){function SwipeToMeetShowCtrl(){this.showFirstSwipeDialog=bind(this.showFirstSwipeDialog,this),SwipeToMeetShowCtrl.__super__.constructor.apply(this,arguments),this.redirectToSchedulingThanks=!1,this.isFirstSwipeAction=null==localStorage.getItem("isFirstSwipeAction"),localStorage.setItem("isFirstSwipeAction",!1),this.DEBUG_MODE="debug"===this.schedulingId,this.DEBUG_MODE?this._initDebugCards():(this.thankyouCardShown=!1,this.meeting=this.meetingService.getMeeting(),this.meeting.meetingDataNotAvailable&&this._fetchMeeting(this.meetingId),this._initPusher(),this._initSchedulingOptions()),this._setLayout()}return extend(SwipeToMeetShowCtrl,superClass),SwipeToMeetShowCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"Is this time suitable?",buttons:{left:this.navigationBarService.defaultBackButton()}}),this.viewParams.get("menuVisible")?void 0:this.navigationBarService.hideMenu()},SwipeToMeetShowCtrl.prototype._setDoneButton=function(){var doneButton;return doneButton={title:"Done",onClick:function(_this){return function(){return _this._redirectToThankYouPage(1)}}(this)},this.navigationBarService.update({buttons:{left:this.navigationBarService.defaultBackButton(),right:doneButton}})},SwipeToMeetShowCtrl.prototype._initPusher=function(){var channelName,eventName,pusherCallback;return channelName=this.appConfig.pusher.channelName+this.sessionService.getUserId(),eventName="scheduling_time_found",pusherCallback=function(_this){return function(data){return _this.log.debug("schedulingId",_this.schedulingId),_this.log.debug("scheduling_time_found",data),_this.log.debug("data.scheduling_id == @schedulingId =",parseInt(data.scheduling_id)===parseInt(_this.schedulingId)),parseInt(data.scheduling_id)===parseInt(_this.schedulingId)?(_this.redirectToSchedulingThanks=!0,_this.error=_this.errorHandlerService.msg("Time was found just now.",{title:"Awesome!"}),_this.scope.$apply()):void 0}}(this),this.pusherService.subscribeAndBind(channelName,eventName,pusherCallback),this.scope.$on("$destroy",function(_this){return function(){return _this.pusherService.unbind(channelName,eventName,pusherCallback)}}(this))},SwipeToMeetShowCtrl.prototype._initSchedulingOptions=function(){var options;return this.nextOptionQueryList=[],this.activeOption="yes_option",this.lastSelectedOption="yes_option",options=this.viewParams.get("options"),null!=options?this.cards=this._initCards(options):(this.loading=!0,this.schedulingService.fetchNextOption(this.meetingId,this.schedulingId).then(function(_this){return function(data){return _this.cards=_this._initCards(data)}}(this),function(_this){return function(failure){var ref;return _this.log.error("Failed to fetch options",failure),1===(null!=failure&&null!=(ref=failure.error)?ref.code:void 0)?_this._redirectToThankYouPage(4):_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this)))},SwipeToMeetShowCtrl.prototype._refreshSchedulingOptions=function(selectedOption){var answer,currentCard,nextCard,ref,ref1;return this.lastSelectedOption=selectedOption,currentCard=this.cards[0],nextCard=this.cards[1],answer="yes_option"===selectedOption?"yes":"no",currentCard[selectedOption].optionalCardVisible&&"no"===answer?this._redirectToThankYouPage(1):(currentCard[selectedOption].optionalCardVisible&&"yes"===answer&&(this.navigationBarService.show("Is this time suitable?"),this._setDoneButton()),this._answerOption(currentCard[selectedOption].id,answer).then(function(_this){return function(){1===nextCard[selectedOption].no_suggestions_left&&_this._redirectToThankYouPage(3)}}(this)),null==(null!=(ref=nextCard[selectedOption])?ref.id:void 0)?this.nextOptionQueryList.push({parent:currentCard,answer:answer,selectedOption:selectedOption}):this._nextSchedulingOption(currentCard,nextCard,answer,selectedOption)),null!=(null!=(ref1=nextCard[selectedOption])?ref1.optionalCardVisible:void 0)&&this.navigationBarService.show("Continue swiping?"),this.cards.push({}),this.cards.shift(),this.scope.$$phase?void 0:this.scope.$apply()},SwipeToMeetShowCtrl.prototype._nextSchedulingOption=function(currentCard,nextCard,answer,selectedOption){return this._fetchNextSchedulingOption(nextCard,nextCard[selectedOption].id,currentCard[selectedOption].id,answer,selectedOption).then(function(_this){return function(data){var emptyCardIndex,q;return data.yes_option=_this._initSurroundingCalendarEntries(data.yes_option),data.no_option=_this._initSurroundingCalendarEntries(data.no_option),!data.yes_option.optional&&!data.no_option.optional||_this.thankyouCardShown||(data=_this._replaceNextWithThankYouCard(data)),emptyCardIndex=_this._findNextEmptyCard(),_.extend(_this.cards[emptyCardIndex],data),_this.nextOptionQueryList.length>0?(q=_this.nextOptionQueryList.shift(),_this._nextSchedulingOption(q.parent,data,q.answer,q.selectedOption)):void 0}}(this),function(_this){return function(failure){return _this.log.error("Failed to fetch next options",failure),1!==failure.error.code?_this.error=_this.errorHandlerService.handle(failure):void 0}}(this))},SwipeToMeetShowCtrl.prototype._answerOption=function(optionId,answer){return this.schedulingService.answerOption(this.meetingId,this.schedulingId,optionId,answer)},SwipeToMeetShowCtrl.prototype._fetchNextSchedulingOption=function(nextCard,optionId,parentOptionId,parentAnswer,selectedOption){var deferred;return nextCard[selectedOption].optionalCardVisible?(deferred=this.q.defer(),deferred.resolve(this.tempCard),deferred.promise):this.schedulingService.fetchNextOptions(this.meetingId,this.schedulingId,optionId,parentOptionId,parentAnswer)},SwipeToMeetShowCtrl.prototype._findNextEmptyCard=function(){var index;return index=_.findIndex(this.cards,function(card){return null==card.yes_option&&null==card.no_option})},SwipeToMeetShowCtrl.prototype._replaceNextWithThankYouCard=function(data){return this.tempCard=angular.copy(data),this.thankyouCardShown=!0,data.yes_option.optional&&(data.yes_option.optionalCardVisible=!0),data.no_option.optional&&(data.no_option.optionalCardVisible=!0),data},SwipeToMeetShowCtrl.prototype._initCards=function(cards){return 1===cards.option.no_suggestions_left?void this._redirectToThankYouPage(3):(cards.option=this._initSurroundingCalendarEntries(cards.option),cards.yes_option=this._initSurroundingCalendarEntries(cards.yes_option),cards.no_option=this._initSurroundingCalendarEntries(cards.no_option),[{yes_option:cards.option,no_option:cards.option},{yes_option:cards.yes_option,no_option:cards.no_option},{}])},SwipeToMeetShowCtrl.prototype._initSurroundingCalendarEntries=function(option){return null!=option&&null!=option.user_calendar_entries&&(option.previousCalendarEntry=this._getPreviousCalendarEntry(option.user_calendar_entries.before),option.nextCalendarEntry=this._getPreviousCalendarEntry(option.user_calendar_entries.after)),option},SwipeToMeetShowCtrl.prototype._getPreviousCalendarEntry=function(previousEntries){return _.last(previousEntries)},SwipeToMeetShowCtrl.prototype._getNextCalendarEntry=function(){return _.first(previousEntries)},SwipeToMeetShowCtrl.prototype._initDebugCards=function(){return this.meeting={title_value:"Company Board meeting"},this.activeOption="yes_option",this.lastSelectedOption="yes_option",this.http.get("/data/swipesuggestions.json").then(function(_this){return function(res){return _.each(res.data,function(option){return option.yes_option=_this._initSurroundingCalendarEntries(option.yes_option),option.no_option=_this._initSurroundingCalendarEntries(option.no_option)}),_this.allDebugCards=res.data,_this.cards=_this.allDebugCards.splice(0,3)}}(this))},SwipeToMeetShowCtrl.prototype._refreshDebugSchedulingOptions=function(){var oldCard;return oldCard=this.cards.shift(),this.cards.push(this.allDebugCards.shift()),this.allDebugCards.push(oldCard),this.scope.$$phase?void 0:this.scope.$apply()},SwipeToMeetShowCtrl.prototype.openCalendarConnect=function(){return this.viewParams.add("options",null),this.location.path("/"+this.tab+"/meeting/"+this.meetingId+"/scheduling/"+this.schedulingId+"/suggestions/selectsources")},SwipeToMeetShowCtrl.prototype.openInfo=function(){var currentCard;return currentCard=this.cards[0][this.lastSelectedOption],this.viewParams.add("option",currentCard),this.location.path("/"+this.tab+"/meeting/"+this.meetingId+"/scheduling/"+this.schedulingId+"/suggestions/info/"+currentCard.id)},SwipeToMeetShowCtrl.prototype.setActiveOption=function(option){return this.activeOption=option,this.scope.$apply()},SwipeToMeetShowCtrl.prototype.firstSwipeDialogConfirm=function(yesAnswer){return this.confirmDialog=null,yesAnswer?this.acceptBtn():this.rejectBtn()},SwipeToMeetShowCtrl.prototype.firstSwipeDialogCancel=function(){return this.confirmDialog=null,this.cancelSwipe()},SwipeToMeetShowCtrl.prototype.showFirstSwipeDialog=function(yesAnswer,fromSwipe){var confirmBtn,message,title;this.isFirstSwipeAction=!1,title=yesAnswer?"Accept suggestion?":"Decline suggestion?",confirmBtn=yesAnswer?"Accept":"Decline",message="",yesAnswer&&fromSwipe&&(message="Swiping right marks this suggestion suitable for you. Answers are permanent."),yesAnswer&&!fromSwipe&&(message="Tapping yes marks this suggestion suitable for you. Answers are permanent."),!yesAnswer&&fromSwipe&&(message="Swiping left marks this suggestion unsuitable for you. Answers are permanent."),yesAnswer||fromSwipe||(message="Tapping no marks this suggestion unsuitable for you. Answers are permanent."),this.confirmDialog={title:title,message:message,buttonConfirmCallback:function(_this){return function(){return _this.firstSwipeDialogConfirm(yesAnswer)}}(this),buttonConfirmCaption:confirmBtn,buttonCancelCallback:function(_this){return function(){return _this.firstSwipeDialogCancel()}}(this),buttonCancelCaption:"Cancel"}},SwipeToMeetShowCtrl.prototype.cancelSwipe=function(){return this.msgChannel.publish(JSON.stringify({event:"cancelSwipe"}))},SwipeToMeetShowCtrl.prototype.acceptBtn=function(){return this.isFirstSwipeAction?this.showFirstSwipeDialog(!0,!1):(this.msgChannel.publish(JSON.stringify({event:"swipeYes",optionId:this.cards[0].yes_option.id})),this.accept())},SwipeToMeetShowCtrl.prototype.rejectBtn=function(){return this.isFirstSwipeAction?this.showFirstSwipeDialog(!1,!1):(this.msgChannel.publish(JSON.stringify({event:"swipeNo",optionId:this.cards[0].yes_option.id})),this.reject())},SwipeToMeetShowCtrl.prototype.accept=function(){return this.analytics.eventTrack("Suggestion accepted",{Category:"SwipeToMeet"}),this.DEBUG_MODE?this._refreshDebugSchedulingOptions("yes_option"):this._refreshSchedulingOptions("yes_option")},SwipeToMeetShowCtrl.prototype.reject=function(){return this.analytics.eventTrack("Suggestion rejected",{Category:"SwipeToMeet"}),this.DEBUG_MODE?this._refreshDebugSchedulingOptions("no_option"):this._refreshSchedulingOptions("no_option")},SwipeToMeetShowCtrl.prototype.isCalendarEntryTooLong=function(calendarEntry){return null==calendarEntry?!1:this.dateHelper.isDurationOverADay(calendarEntry.begin_epoch,calendarEntry.end_epoch)},SwipeToMeetShowCtrl.prototype.handleError=function(){return this.error=null,this.redirectToSchedulingThanks?this._redirectToThankYouPage(2):this._initSchedulingOptions()},SwipeToMeetShowCtrl}(SwipeToMeetBaseCtrl),SwipeToMeetInfoCtrl=function(superClass){function SwipeToMeetInfoCtrl(){SwipeToMeetInfoCtrl.__super__.constructor.apply(this,arguments),this.optionId=this.viewParams.get("optionId"),this.user=this.currentUserService.get(),this._initInfoPageData(),this._setLayout()}return extend(SwipeToMeetInfoCtrl,superClass),SwipeToMeetInfoCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"Suggestion details",buttons:{left:this.navigationBarService.defaultBackButton()}}),this.viewParams.get("menuVisible")?void 0:this.navigationBarService.hideMenu()},SwipeToMeetInfoCtrl.prototype._initInfoPageData=function(){return this.meeting=this.meetingService.getMeeting(),this.scheduling=this.schedulingService.getScheduling(),this.option=this.viewParams.get("option"),this.meeting.meetingDataNotAvailable||_.isEmpty(this.scheduling)||null==this.option?(this.loading=!0,this.q.all([this._fetchMeeting(this.meetingId),this._fetchScheduling(this.meetingId,this.schedulingId),this._fetchOption(this.meetingId,this.schedulingId,this.optionId),this._reloadUser()])["finally"](function(_this){return function(){return _this.userTimezone=jstz.determine().name(),_this.organizerTimezone=_this.scheduling.time_zone,_this._initCalendarCount(),_this._initTimespan(),_this._initParticipantsAndAgenda(),_this.loading=!1}}(this))):(this.userTimezone=jstz.determine().name(),this.organizerTimezone=this.scheduling.time_zone,this._initCalendarCount(),this._initTimespan(),this._initParticipantsAndAgenda())},SwipeToMeetInfoCtrl.prototype._initParticipantsAndAgenda=function(){return this._initParticipants(),this.agenda=_.find(this.meeting.materials,function(material){return"agenda"===material.material_class})},SwipeToMeetInfoCtrl.prototype._initTimespan=function(){return null!=this.scheduling.available_timespans[0].end&&(this.timespanEnd=this.scheduling.available_timespans[0].end-this.dateHelper.oneDayInSeconds),this.oneDaySpan=this.scheduling.available_timespans[0].start===this.timespanEnd},SwipeToMeetInfoCtrl.prototype._initCalendarCount=function(){return this.enabledCalendarsCount=_.keys(this.user.source_settings.enabled).length,this.totalCalendarsCount=_.keys(this.user.source_settings.disabled).length+this.enabledCalendarsCount},SwipeToMeetInfoCtrl.prototype.openParticipants=function(){var breadcrumb;return breadcrumb=encodeURIComponent(this.meeting.title_value),this.viewParams.set({isDraft:!1,breadcrumb:breadcrumb,isManager:!1,overrideBackButton:!0}),this.location.path("/"+this.tab+"/meeting/"+this.meetingId+"/participants")},SwipeToMeetInfoCtrl.prototype.openMaterial=function(material){var breadcrumb;return breadcrumb=encodeURIComponent(this.meeting.title_value),this.viewParams.set({breadcrumb:breadcrumb,isManager:!1,overrideBackButton:!0,materialClass:material.material_class}),this.location.path("/"+this.tab+"/meeting/"+this.meeting.id+"/material/"+material.id)},SwipeToMeetInfoCtrl.prototype.openCalendarSetting=function(){return this.location.path("/"+this.tab+"/meeting/"+this.meetingId+"/scheduling/"+this.schedulingId+"/suggestions/selectsources")},SwipeToMeetInfoCtrl.prototype.formatTimezone=function(timezone){return null!=timezone?this.dateHelper.formatTimezone(timezone):void 0},SwipeToMeetInfoCtrl.prototype.handleError=function(){return this.error=null,this._initInfoPageData()},SwipeToMeetInfoCtrl}(SwipeToMeetBaseCtrl),SwipeToMeetThanksCtrl=function(superClass){function SwipeToMeetThanksCtrl(){this.showNotification=bind(this.showNotification,this),SwipeToMeetThanksCtrl.__super__.constructor.apply(this,arguments),this.thanksMsg=this.viewParams.get("thanksMsg"),this.user=this.currentUserService.get(),this.newUser=this.currentUserService.isNewUser(this.user),this.emailParticipant=""===this.user.phone,this.loading=!0,this._fetchMeeting(this.meetingId).then(function(_this){return function(){var participant;return participant=_this.participantService.getParticipant(_this.user.id,_this.meeting.participants),_this.isManager=_this.participantService.isManager(participant)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this)),this._setLayout()}return extend(SwipeToMeetThanksCtrl,superClass),SwipeToMeetThanksCtrl.prototype._setLayout=function(){var closeButton;return"true"===this.viewParams.get("showCloseButton")&&(closeButton={title:"Close",onClick:function(_this){return function(){return _this.location.path("/scheduling")}}(this)}),this.navigationBarService.update({title:"SwipeToMeet",buttons:{left:null==closeButton?this.navigationBarService.buttonToPath("/"+this.tab+"/meeting/"+this.meetingId):null,right:closeButton}}),this.viewParams.get("menuVisible")?void 0:this.navigationBarService.hideMenu()},SwipeToMeetThanksCtrl.prototype._confirmPhone=function(phone){return this.currentUserService.confirmPhone(phone).then(function(_this){return function(data){return _this.log.debug("Confirm phone success",data)}}(this),function(_this){return function(failure){var ref;return 1===(null!=failure&&null!=(ref=failure.error)?ref.code:void 0)?(_this.log.debug("Existing phone given, PIN code sent to number",failure),_this.viewParams.set({phone:_this.user.primary_phone}),_this.location.path("/"+_this.tab+"/meeting/"+_this.meetingId+"/scheduling/"+_this.schedulingId+"/confirmPhone")):(_this.log.warn("Failed email confirm: ",failure),_this.error=_this.errorHandlerService.handle(failure))}}(this))},SwipeToMeetThanksCtrl.prototype.openSchedulingLog=function(){return this.viewParams.set({showCloseButton:!1,showProvideAvailabilityButton:!1}),this.location.path("/"+this.tab+"/meeting/"+this.meetingId+"/scheduling/"+this.schedulingId+"/log")},SwipeToMeetThanksCtrl.prototype.showNotification=function(notification){return 1===notification.message.indexOf(this.meeting.title_value)},SwipeToMeetThanksCtrl.prototype.continueSwiping=function(){return this.window.history.back()},SwipeToMeetThanksCtrl.prototype.signUp=function(){return this.location.search({meetingId:this.meetingId,schedulingId:this.schedulingId,msgId:this.thanksMsg}).path("/signup")},SwipeToMeetThanksCtrl.prototype.checkPhone=function(){return this.formattedPhone=this.contactService.formatPhone(this.user.primary_phone,"null"),this.formattedPhone.valid?this.submitPhone():(this.viewParams.set({phone:this.formattedPhone.e164}),this.location.path("/"+this.tab+"/meeting/"+this.meetingId+"/scheduling/"+this.schedulingId+"/countryCode"))},SwipeToMeetThanksCtrl.prototype.submitPhone=function(){return this.btnWorking="sending",this.user.primary_phone=this.formattedPhone.e164,this.currentUserService.update(this.user).then(function(_this){return function(data){return _this.log.debug("Saved user data",data),_this.viewParams.set({phone:_this.user.primary_phone}),_this.location.path("/"+_this.tab+"/meeting/"+_this.meetingId+"/scheduling/"+_this.schedulingId+"/appDownloadGuide")}}(this),function(_this){return function(failure){var ref;return 504===(null!=failure&&null!=(ref=failure.error)?ref.code:void 0)?(_this.log.warn("User already exists: ",failure),_this._confirmPhone(_this.user.primary_phone)):(_this.log.error("Failed to update user",failure),_this.error=_this.errorHandlerService.handle(failure))}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},SwipeToMeetThanksCtrl.prototype.handleError=function(){return this.error=null,this.loading=!0,this._fetchMeeting(this.meetingId)["finally"](function(_this){return function(){return _this.loading=!1}}(this))},SwipeToMeetThanksCtrl}(SwipeToMeetBaseCtrl),SwipeToMeetCountryCodeCtrl=function(superClass){function SwipeToMeetCountryCodeCtrl(){SwipeToMeetCountryCodeCtrl.__super__.constructor.apply(this,arguments),this.phone=this.viewParams.get("phone"),null==this.phone&&this.window.history.back(),this.formattedPhone=this.contactService.formatPhone(this.phone,"null"),this._fetchCountryCodes(),this._setLayout()}return extend(SwipeToMeetCountryCodeCtrl,superClass),SwipeToMeetCountryCodeCtrl.prototype._setLayout=function(){return this.navigationBarService.show(),this.navigationBarService.update({title:"Check your number",buttons:{left:this.navigationBarService.defaultBackButton()}}),this.navigationBarService.hideMenu()},SwipeToMeetCountryCodeCtrl.prototype._fetchCountryCodes=function(){return this.LocalDataRestangular.all("countrycodes").getList().then(function(_this){return function(data){return _this.countryCodes=data}}(this))},SwipeToMeetCountryCodeCtrl.prototype.validatePhone=function(){return this.formattedPhone=this.contactService.formatPhone(this.phone,this.countryCode.id)},SwipeToMeetCountryCodeCtrl}(SwipeToMeetThanksCtrl),SwipeToMeetConfirmPhoneCtrl=function(superClass){function SwipeToMeetConfirmPhoneCtrl(){SwipeToMeetConfirmPhoneCtrl.__super__.constructor.apply(this,arguments),this.phone=this.viewParams.get("phone")}return extend(SwipeToMeetConfirmPhoneCtrl,superClass),SwipeToMeetConfirmPhoneCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"SwipeToMeet",buttons:{left:this.navigationBarService.defaultBackButton(),right:null}}),this.viewParams.get("menuVisible")?void 0:this.navigationBarService.hideMenu()},SwipeToMeetConfirmPhoneCtrl.prototype.verifyPin=function(){return this.btnWorking="signUp",this.sessionService.signInWithPhonenumber(this.phone,this.pin).then(function(_this){return function(){return _this.SessionRestangular.refreshDefaultHeaders(),_this.currentUserService.reload()}}(this),function(_this){return function(failure){return _this.log.warn("Error signing in: ",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this)).then(function(_this){return function(){return _this.viewParams.set({phone:_this.phone}),_this.location.path("/"+_this.tab+"/meeting/"+_this.meetingId+"/scheduling/"+_this.schedulingId+"/appDownloadGuide")}}(this),function(_this){return function(failure){return _this.log.warn("Failed to reload user ",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},SwipeToMeetConfirmPhoneCtrl.prototype.resendPin=function(){return this.currentUserService.confirmPhone(this.phone).then(function(_this){return function(){return _this.log.debug("No existing user found")}}(this),function(_this){return function(failure){var ref;return 1===(null!=failure&&null!=(ref=failure.error)?ref.code:void 0)?(_this.log.debug("Existing email given, PIN code sent to email",failure),_this.pinReRequested=!0):void 0}}(this))},SwipeToMeetConfirmPhoneCtrl}(SwipeToMeetBaseCtrl),SwipeToMeetAppDownloadGuideCtrl=function(superClass){function SwipeToMeetAppDownloadGuideCtrl(){SwipeToMeetAppDownloadGuideCtrl.__super__.constructor.apply(this,arguments),this.phone=this.viewParams.get("phone"),null!=this.phone&&this._sendAppSms(),this._setLayout()}return extend(SwipeToMeetAppDownloadGuideCtrl,superClass),SwipeToMeetAppDownloadGuideCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"App download",buttons:{left:null,right:null}}),this.viewParams.get("menuVisible")?void 0:this.navigationBarService.hideMenu()
},SwipeToMeetAppDownloadGuideCtrl.prototype._sendAppSms=function(){return this.currentUserService.getRoute().post("send_app_sms").then(function(_this){return function(){return _this.log.debug("App download link sent successfully")}}(this),function(_this){return function(failure){return _this.log.debug("Failed to send app download sms",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SwipeToMeetAppDownloadGuideCtrl.prototype.resendSms=function(){return this._sendAppSms().then(function(_this){return function(){return _this.log.debug("App download link sent successfully"),_this.smsReRequested=!0}}(this),function(_this){return function(failure){return _this.log.debug("Failed to send app download sms",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SwipeToMeetAppDownloadGuideCtrl}(SwipeToMeetBaseCtrl),SwipeToMeetConfirmLeaveCtrl=function(superClass){function SwipeToMeetConfirmLeaveCtrl(){SwipeToMeetConfirmLeaveCtrl.__super__.constructor.apply(this,arguments),this.user=this.currentUserService.get(),this.meeting=this.meetingService.getMeeting(),this.meeting.meetingDataNotAvailable?this._fetchMeeting():this._setMeeting(this.meeting),this._setLayout()}return extend(SwipeToMeetConfirmLeaveCtrl,superClass),SwipeToMeetConfirmLeaveCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"Delegate meeting?",buttons:{left:"web"!==this.deviceUtils.platform()?this.navigationBarService.defaultBackButton():null,right:null}}),this.viewParams.get("menuVisible")?void 0:this.navigationBarService.hideMenu()},SwipeToMeetConfirmLeaveCtrl.prototype._fetchMeeting=function(){return this.loading=!0,this.meetingService.fetchMeeting(this.meetingId,{image_size:this.appConfig.thumbnail.small}).then(function(_this){return function(data){return _this._setMeeting(data)}}(this),function(_this){return function(failure){return _this.log.error("[meeting#show] Load error:",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},SwipeToMeetConfirmLeaveCtrl.prototype._setMeeting=function(meeting){return this.meeting=meeting,this.participant=this.participantService.restangularizeElement(this.participantService.getParticipant(this.user.id,meeting.participants)),this.hasLeftScheduling=this.participantService.hasLeftScheduling(this.participant)},SwipeToMeetConfirmLeaveCtrl.prototype._disableScheduling=function(){return this.btnWorking="disableScheduling",this.participantService.disableScheduling(this.participant).then(function(_this){return function(data){return _this.log.debug("Participant removed from scheduling",data),_this.location.path("/"+_this.tab+"/meeting/"+_this.meetingId+"/scheduling/"+_this.schedulingId+"/leave")}}(this),function(_this){return function(failure){return _this.log.error("Failed to remove participant from scheduling",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},SwipeToMeetConfirmLeaveCtrl.prototype.buttonYes=function(){return this.location.path("/"+this.tab+"/meeting/"+this.meetingId+"/scheduling/"+this.schedulingId+"/leave/invitesubstitute")},SwipeToMeetConfirmLeaveCtrl.prototype.buttonNo=function(){return this._disableScheduling()},SwipeToMeetConfirmLeaveCtrl}(SwipeToMeetBaseCtrl),SwipeToMeetInviteSubsituteCtrl=function(superClass){function SwipeToMeetInviteSubsituteCtrl(){SwipeToMeetInviteSubsituteCtrl.__super__.constructor.apply(this,arguments),this.participants=[],this.user=this.currentUserService.get(),this.userCountryId=this.currentUserService.getUserPhoneCountryId(this.user),this.meeting=this.meetingService.getMeeting(),this.contactPermissionTextVisible=!this.contactService.getPermissionAsked(),this.meeting.meetingDataNotAvailable?this._fetchMeeting():this._setMeeting(this.meeting),this._getLatestContacts(),this._initParticipantListWatcher(),this._setLayout()}return extend(SwipeToMeetInviteSubsituteCtrl,superClass),SwipeToMeetInviteSubsituteCtrl.prototype._setLayout=function(){var doneButton;return doneButton={title:"Done",disabled:!this.participants.length,onClick:function(_this){return function(){return _this._participantSelectDone()}}(this)},this.navigationBarService.update({title:"Choose contacts",buttons:{left:"web"!==this.deviceUtils.platform()?this.navigationBarService.defaultBackButton():null,right:doneButton}}),this.viewParams.get("menuVisible")?void 0:this.navigationBarService.hideMenu()},SwipeToMeetInviteSubsituteCtrl.prototype._initParticipantListWatcher=function(){return this.scope.$watch(function(_this){return function(){return _this.participants}}(this),function(_this){return function(){return _this._participantListChanged()}}(this),!0)},SwipeToMeetInviteSubsituteCtrl.prototype._fetchMeeting=function(){return this.loading=!0,this.meetingService.fetchMeeting(this.meetingId,{image_size:this.appConfig.thumbnail.small}).then(function(_this){return function(data){return _this._setMeeting(data)}}(this),function(_this){return function(failure){return _this.log.error("[meeting#show] Load error:",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},SwipeToMeetInviteSubsituteCtrl.prototype._setMeeting=function(meeting){return this.meeting=meeting,this.participant=this.participantService.restangularizeElement(this.participantService.getParticipant(this.user.id,meeting.participants)),this.hasLeftScheduling=this.participantService.hasLeftScheduling(this.participant)},SwipeToMeetInviteSubsituteCtrl.prototype._participantListChanged=function(){return this._setLayout()},SwipeToMeetInviteSubsituteCtrl.prototype._saveLatestContacts=function(){return this.contactService.setLatestContactsForUser(this.user.id,this.participants)},SwipeToMeetInviteSubsituteCtrl.prototype._getLatestContacts=function(){var ref;return this.latestContacts=null!=(ref=this.contactService.getLatestContacts())?ref[this.user.id]:void 0},SwipeToMeetInviteSubsituteCtrl.prototype._participantSelectDone=function(){return 0===this.participants.length?void(this.error=this.errorHandlerService.handleAppError(this.errorHandlerService.EMPTY_CONTACT_LIST)):(this._saveLatestContacts(),this._addParticipantAndLeaveScheduling())},SwipeToMeetInviteSubsituteCtrl.prototype._addParticipantAndLeaveScheduling=function(){var addParticipantPromises;return addParticipantPromises=[],_.each(this.participants,function(_this){return function(participant){return addParticipantPromises.push(_this.participantService.addParticipant(_this.meetingId,participant))}}(this)),this.q.all(addParticipantPromises).then(function(_this){return function(data){return _this.log.debug("Participants added successfully",data),_this._disableScheduling()}}(this),function(_this){return function(failure){return _this.log.error("Participant adding failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SwipeToMeetInviteSubsituteCtrl.prototype._disableScheduling=function(){return this.btnWorking="disableScheduling",this.participantService.disableScheduling(this.participant).then(function(_this){return function(data){return _this.log.debug("Participant removed from scheduling",data),_this.location.path("/"+_this.tab+"/meeting/"+_this.meetingId+"/scheduling/"+_this.schedulingId+"/leave")}}(this),function(_this){return function(failure){return _this.log.error("Failed to remove participant from scheduling",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},SwipeToMeetInviteSubsituteCtrl.prototype.onAddParticipant=function(participant,type){var validatedParticipant;return this.log.debug(type+" participant added",participant),validatedParticipant=this.contactService.isValidParticipant(this.meeting.participants,participant,type,this.user,this.userCountryId),null!=(null!=validatedParticipant?validatedParticipant.existingParticipant:void 0)?this.error=this.errorHandlerService.handleAppError(this.errorHandlerService.PHONENUMBER_EXISTS):null!=(null!=validatedParticipant?validatedParticipant.error:void 0)?this.error=validatedParticipant.error:(this.meeting.participants.push(participant),this.participants.push(participant))},SwipeToMeetInviteSubsituteCtrl.prototype.onRemoveParticipant=function(participant){return this.log.debug("participant removed",participant),_.remove(this.meeting.participants,participant),_.remove(this.participants,participant)},SwipeToMeetInviteSubsituteCtrl.prototype.initContactPlugin=function(){return this.contactService.init().then(function(_this){return function(){return _this.contactService.setPermissionAsked(!0),_this.contactPermissionTextVisible=!1,_this._setLayout()}}(this),function(_this){return function(failure){return _this.log.error("Failed to initialize contact plugin",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))},SwipeToMeetInviteSubsituteCtrl.prototype.handleError=function(){return this.error=null},SwipeToMeetInviteSubsituteCtrl}(SwipeToMeetBaseCtrl),SwipeToMeetLeaveCtrl=function(superClass){function SwipeToMeetLeaveCtrl(){SwipeToMeetLeaveCtrl.__super__.constructor.apply(this,arguments),this.user=this.currentUserService.get(),this.meeting=this.meetingService.getMeeting(),this.meeting.meetingDataNotAvailable?this._fetchMeeting():this._setMeeting(this.meeting),this._setLayout()}return extend(SwipeToMeetLeaveCtrl,superClass),SwipeToMeetLeaveCtrl.prototype._setLayout=function(){return this.navigationBarService.update({title:"You left the scheduling",buttons:{left:"web"!==this.deviceUtils.platform()?this.navigationBarService.defaultBackButton():null,right:null}}),this.viewParams.get("menuVisible")?void 0:this.navigationBarService.hideMenu()},SwipeToMeetLeaveCtrl.prototype._fetchMeeting=function(){return this.loading=!0,this.meetingService.fetchMeeting(this.meetingId,{image_size:this.appConfig.thumbnail.small}).then(function(_this){return function(data){return _this._setMeeting(data)}}(this),function(_this){return function(failure){return _this.log.error("[meeting#show] Load error:",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},SwipeToMeetLeaveCtrl.prototype._setMeeting=function(meeting){return this.meeting=meeting,this.participant=this.participantService.restangularizeElement(this.participantService.getParticipant(this.user.id,meeting.participants))},SwipeToMeetLeaveCtrl.prototype._leaveMeeting=function(){return this.confirmDialog=null,this.btnWorking="removingParticipant",this.participantService.removeParticipant(this.participant.id).then(function(_this){return function(data){return _this.log.debug("Participant removed successfully",data),_this.location.path("/"+_this.tab)}}(this),function(_this){return function(failure){return _this.log.error("Participant remove failed",failure),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.btnWorking=null}}(this))},SwipeToMeetLeaveCtrl.prototype.confirmLeaveMeeting=function(){return this.confirmDialog={title:"Leave meeting?",message:"Are you sure you want to remove yourself from this meeting? You need to be invited to access it again.",buttonConfirmCallback:function(_this){return function(){return _this._leaveMeeting()}}(this),buttonConfirmCaption:"Ok",buttonCancelCallback:function(_this){return function(){return _this.confirmDialog=null}}(this),buttonCancelCaption:"Cancel"}},SwipeToMeetLeaveCtrl.prototype.handleError=function(){return this.error=null},SwipeToMeetLeaveCtrl}(SwipeToMeetBaseCtrl),swipeToMeetApp=angular.module("swipeToMeetApp",["ngAnimate","appConfig","SessionModel","nativeUi","dateHelper","matchmakerModule","meetingModule","participantModule","schedulingModule","pusherModule","mtnSwipeCard","mtnFloatLabel","mtnMomentModule","partials","mtnUtils","contactModule","mtnContactPicker"]),swipeToMeetApp.controller("SwipeToMeetLandingCtrl",SwipeToMeetLandingCtrl),swipeToMeetApp.controller("SwipeToMeetShowCtrl",SwipeToMeetShowCtrl),swipeToMeetApp.controller("SwipeToMeetInfoCtrl",SwipeToMeetInfoCtrl),swipeToMeetApp.controller("SwipeToMeetThanksCtrl",SwipeToMeetThanksCtrl),swipeToMeetApp.controller("SwipeToMeetCountryCodeCtrl",SwipeToMeetCountryCodeCtrl),swipeToMeetApp.controller("SwipeToMeetConfirmPhoneCtrl",SwipeToMeetConfirmPhoneCtrl),swipeToMeetApp.controller("SwipeToMeetAppDownloadGuideCtrl",SwipeToMeetAppDownloadGuideCtrl),swipeToMeetApp.controller("SwipeToMeetConfirmLeaveCtrl",SwipeToMeetConfirmLeaveCtrl),swipeToMeetApp.controller("SwipeToMeetInviteSubsituteCtrl",SwipeToMeetInviteSubsituteCtrl),swipeToMeetApp.controller("SwipeToMeetLeaveCtrl",SwipeToMeetLeaveCtrl);var TrialBaseCtrl,TrialIndexCtrl,trialApp,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;TrialBaseCtrl=function(){function TrialBaseCtrl(window,appConfig,currentUserService,errorHandlerService,navigationBarService,msgChannel,viewParams){this.window=window,this.appConfig=appConfig,this.currentUserService=currentUserService,this.errorHandlerService=errorHandlerService,this.navigationBarService=navigationBarService,this.msgChannel=msgChannel,this.viewParams=viewParams}return TrialBaseCtrl.$inject=["$window","appConfig","currentUserService","errorHandlerService","navigationBarService","jsonMsgChannel","viewParams"],TrialBaseCtrl}(),TrialIndexCtrl=function(superClass){function TrialIndexCtrl(){TrialIndexCtrl.__super__.constructor.apply(this,arguments),this._reloadUser(),this._setLayout()}return extend(TrialIndexCtrl,superClass),TrialIndexCtrl.prototype._reloadUser=function(){return this.loading=!0,this.delayedSpinner=!0,this.currentUserService.reload({image_size:this.appConfig.thumbnail.small}).then(function(_this){return function(user){return _this.user=user,_this.isTrialExpired=_this.currentUserService.isTrialExpired(user)}}(this),function(_this){return function(failure){return _this.log.error("Failed to load user data"),_this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},TrialIndexCtrl.prototype._setLayout=function(){var title;return title=this.isTrialExpired?"Trial expired":"Start trial",this.navigationBarService.update({title:title})},TrialIndexCtrl.prototype.startTrial=function(){return this.loading=!0,this.currentUserService.startTrial().then(function(_this){return function(){var user;return user=_this.currentUserService.get(),user.is_trial_pro=1,_this.msgChannel.publish(JSON.stringify({event:"updateUser",user:user})),_this.window.history.back()}}(this),function(_this){return function(failure){return _this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},TrialIndexCtrl.prototype.sendProFeaturesEmail=function(){return this.loading=!0,this.currentUserService.sendProFeaturesEmail().then(function(_this){return function(){return _this.window.history.back()}}(this),function(_this){return function(failure){return _this.error=_this.errorHandlerService.handle(failure)}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},TrialIndexCtrl.prototype.cancel=function(){return this.window.history.back()},TrialIndexCtrl.prototype.handleError=function(){return this.error=null,this._reloadUser()},TrialIndexCtrl}(TrialBaseCtrl),trialApp=angular.module("trialApp",["appConfig"]),trialApp.controller("TrialIndexCtrl",TrialIndexCtrl);